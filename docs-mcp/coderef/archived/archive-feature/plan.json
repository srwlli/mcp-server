{
  "META_DOCUMENTATION": {
    "feature_name": "archive-feature",
    "version": "1.0.0",
    "created_at": "2025-10-18T06:30:00Z",
    "status": "planning",
    "generated_by": "Claude Code AI",
    "workorder_id": "WO-ARCHIVE-FEATURE-001"
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "foundation_docs": {
        "available": ["README.md", "CLAUDE.md", "user-guide.md"],
        "missing": []
      },
      "coding_standards": {
        "available": ["handler_decorators.py patterns", "handler_helpers.py patterns"],
        "patterns": [
          "Use @log_invocation and @mcp_error_handler decorators",
          "Use format_success_response() for responses",
          "Use validate_project_path_input() and validate_feature_name_input()",
          "Follow handler registry pattern (QUA-002)"
        ]
      },
      "technology_stack": {
        "language": "Python 3.11+",
        "framework": "MCP (Model Context Protocol)",
        "libraries": ["pathlib", "json", "shutil"],
        "patterns": ["Decorator pattern", "Factory pattern", "Registry pattern"]
      }
    },
    "1_executive_summary": {
      "overview": "Create an MCP tool to automate archiving completed features from coderef/working/ to coderef/archived/. The tool will move entire feature folders, maintain an archive index, and provide a slash command interface.",
      "goal": "Reduce manual archive workflow from 5 minutes to <30 seconds while maintaining complete history and searchability.",
      "scope": {
        "in_scope": [
          "MCP tool for archiving features",
          "Archive index (index.json) with feature metadata",
          "Slash command /archive-feature",
          "DELIVERABLES.md status checking",
          "User confirmation prompts"
        ],
        "out_of_scope": [
          "Bulk archiving multiple features",
          "Archive search/query tools",
          "Archive restoration tools",
          "Archive compression/optimization"
        ]
      },
      "success_metrics": {
        "performance": "Archive operation completes in <30 seconds",
        "usability": "Single command archives entire feature",
        "reliability": "100% of files moved without data loss",
        "maintainability": "Uses existing handler patterns"
      }
    },
    "2_risk_assessment": {
      "complexity": "LOW",
      "estimated_effort": "4-6 hours",
      "risks": [
        {
          "risk": "Data loss during folder move",
          "probability": "LOW",
          "impact": "HIGH",
          "mitigation": "Use shutil.move() with error handling, verify files after move"
        },
        {
          "risk": "Index.json corruption",
          "probability": "LOW",
          "impact": "MEDIUM",
          "mitigation": "Validate JSON before writing, create backup before update"
        },
        {
          "risk": "Race condition if multiple agents archive simultaneously",
          "probability": "LOW",
          "impact": "MEDIUM",
          "mitigation": "Document single-agent usage pattern, add future file locking"
        }
      ],
      "dependencies": [
        "Existing handler patterns (decorators, helpers)",
        "File system access (shutil, pathlib)",
        "JSON schema validation"
      ]
    },
    "3_current_state_analysis": {
      "existing_files": [
        "server.py - Add new tool definition",
        "tool_handlers.py - Add handler function",
        "handler_helpers.py - Add update_archive_index() helper",
        ".claude/commands.json - Register new command"
      ],
      "files_to_create": [
        ".claude/commands/archive-feature.md - Slash command",
        "tests/unit/test_archive_helpers.py - Unit tests",
        "tests/integration/test_archive_workflow.py - Integration test",
        "coderef/archived/index.json - Archive index (if doesn't exist)"
      ],
      "files_to_modify": [
        "server.py - Add archive_feature Tool",
        "tool_handlers.py - Add handle_archive_feature()",
        "handler_helpers.py - Add update_archive_index()",
        ".claude/commands.json - Add archive-feature command"
      ]
    },
    "4_key_features": {
      "feature_1": {
        "name": "Archive Feature Tool",
        "description": "MCP tool that moves completed features from working to archive",
        "requirements": [
          "Accept project_path and feature_name parameters",
          "Check if feature exists in coderef/working/",
          "Check DELIVERABLES.md status",
          "Prompt user for confirmation if status != Complete",
          "Move entire folder using shutil.move()",
          "Update archive index.json",
          "Return success message with archived location"
        ],
        "user_stories": [
          "As a developer, I want to archive completed features with a single command",
          "As an agent, I want confirmation before archiving incomplete features",
          "As a project manager, I want a searchable index of archived features"
        ]
      },
      "feature_2": {
        "name": "Archive Index Management",
        "description": "JSON index tracking all archived features with metadata",
        "requirements": [
          "Create index.json if it doesn't exist",
          "Append new entries when archiving",
          "Include: feature_name, folder_name, archived_at timestamp",
          "Update total_archived and last_updated fields",
          "Validate JSON schema before writing"
        ],
        "schema": {
          "archived_features": "Array of archived feature objects",
          "total_archived": "Integer count",
          "last_updated": "ISO 8601 timestamp"
        }
      },
      "feature_3": {
        "name": "Status Checking",
        "description": "Check DELIVERABLES.md status before archiving",
        "requirements": [
          "Read DELIVERABLES.md if it exists",
          "Parse status line (e.g., 'Status: ✅ Complete')",
          "If status != Complete and force=false, prompt user",
          "If status = Complete, proceed automatically",
          "If DELIVERABLES.md missing, prompt user"
        ]
      }
    },
    "5_task_id_system": {
      "workorder": {
        "id": "WO-ARCHIVE-FEATURE-001",
        "name": "Archive Feature Tool",
        "feature_dir": "coderef/working/archive-feature"
      },
      "tasks": [
        {
          "id": "ARCHIVE-001",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "foundation",
          "description": "Create update_archive_index() helper in handler_helpers.py",
          "type": "implementation",
          "estimated_time": "30 min",
          "dependencies": []
        },
        {
          "id": "ARCHIVE-002",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "foundation",
          "description": "Create parse_deliverables_status() helper to check completion",
          "type": "implementation",
          "estimated_time": "20 min",
          "dependencies": []
        },
        {
          "id": "ARCHIVE-003",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "tool",
          "description": "Implement handle_archive_feature() in tool_handlers.py",
          "type": "implementation",
          "estimated_time": "60 min",
          "dependencies": ["ARCHIVE-001", "ARCHIVE-002"]
        },
        {
          "id": "ARCHIVE-004",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "tool",
          "description": "Add archive_feature Tool definition to server.py",
          "type": "implementation",
          "estimated_time": "15 min",
          "dependencies": ["ARCHIVE-003"]
        },
        {
          "id": "ARCHIVE-005",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "tool",
          "description": "Register handler in TOOL_HANDLERS dict",
          "type": "implementation",
          "estimated_time": "5 min",
          "dependencies": ["ARCHIVE-004"]
        },
        {
          "id": "ARCHIVE-006",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "slash-command",
          "description": "Create .claude/commands/archive-feature.md",
          "type": "documentation",
          "estimated_time": "15 min",
          "dependencies": ["ARCHIVE-005"]
        },
        {
          "id": "ARCHIVE-007",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "slash-command",
          "description": "Update .claude/commands.json registry",
          "type": "documentation",
          "estimated_time": "5 min",
          "dependencies": ["ARCHIVE-006"]
        },
        {
          "id": "ARCHIVE-008",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "testing",
          "description": "Create unit tests for archive helpers",
          "type": "testing",
          "estimated_time": "45 min",
          "dependencies": ["ARCHIVE-001", "ARCHIVE-002"]
        },
        {
          "id": "ARCHIVE-009",
          "workorder_id": "WO-ARCHIVE-FEATURE-001",
          "phase": "testing",
          "description": "Create integration test for full archive workflow",
          "type": "testing",
          "estimated_time": "60 min",
          "dependencies": ["ARCHIVE-007"]
        }
      ]
    },
    "6_implementation_phases": {
      "phase_0": {
        "name": "Foundation - Helper Functions",
        "duration": "50 minutes",
        "tasks": ["ARCHIVE-001", "ARCHIVE-002"],
        "deliverables": [
          "update_archive_index() helper function",
          "parse_deliverables_status() helper function"
        ],
        "validation": [
          "Helpers handle edge cases (missing files, invalid JSON)",
          "Status parsing works with various formats"
        ]
      },
      "phase_1": {
        "name": "Tool Implementation",
        "duration": "80 minutes",
        "tasks": ["ARCHIVE-003", "ARCHIVE-004", "ARCHIVE-005"],
        "deliverables": [
          "handle_archive_feature() handler function",
          "archive_feature Tool definition in server.py",
          "Handler registered in TOOL_HANDLERS"
        ],
        "validation": [
          "Tool moves folder successfully",
          "Index.json is created/updated",
          "User is prompted when appropriate"
        ]
      },
      "phase_2": {
        "name": "Slash Command",
        "duration": "20 minutes",
        "tasks": ["ARCHIVE-006", "ARCHIVE-007"],
        "deliverables": [
          "archive-feature.md slash command",
          "Updated commands.json registry"
        ],
        "validation": [
          "/archive-feature command works",
          "Command appears in autocomplete"
        ]
      },
      "phase_3": {
        "name": "Testing",
        "duration": "105 minutes",
        "tasks": ["ARCHIVE-008", "ARCHIVE-009"],
        "deliverables": [
          "test_archive_helpers.py with unit tests",
          "test_archive_workflow.py with integration test"
        ],
        "validation": [
          "All unit tests passing",
          "Integration test covers full workflow",
          "Edge cases tested (missing files, already archived)"
        ]
      }
    },
    "7_testing_strategy": {
      "unit_tests": [
        "test_update_archive_index() - Test index creation and updates",
        "test_parse_deliverables_status() - Test status parsing",
        "test_archive_index_validation() - Test JSON schema validation"
      ],
      "integration_tests": [
        "test_archive_complete_feature() - Archive feature with Complete status",
        "test_archive_incomplete_feature() - Archive with confirmation prompt",
        "test_archive_missing_deliverables() - Archive without DELIVERABLES.md",
        "test_archive_already_exists() - Handle duplicate archive attempts"
      ],
      "edge_cases": [
        "Feature doesn't exist in working/",
        "Archive folder already contains feature",
        "index.json is corrupted",
        "DELIVERABLES.md has unexpected format",
        "File permissions prevent move"
      ]
    },
    "8_success_criteria": {
      "functional": [
        "✅ Tool archives feature from working to archive",
        "✅ Index.json is created or updated with new entry",
        "✅ User is prompted if status != Complete",
        "✅ Entire folder is moved (all files preserved)",
        "✅ Slash command /archive-feature works"
      ],
      "quality": [
        "✅ All unit tests passing",
        "✅ Integration test passes",
        "✅ Uses @log_invocation and @mcp_error_handler decorators",
        "✅ Follows existing handler patterns",
        "✅ No data loss during move operation"
      ],
      "performance": [
        "✅ Archive operation completes in <30 seconds",
        "✅ Index update completes in <100ms"
      ],
      "documentation": [
        "✅ Slash command has clear description",
        "✅ Tool docstring explains parameters",
        "✅ README.md updated with new tool"
      ]
    },
    "9_implementation_checklist": {
      "phase_0_checklist": [
        "[ ] Create update_archive_index() in handler_helpers.py",
        "[ ] Create parse_deliverables_status() in handler_helpers.py",
        "[ ] Test helpers with mock data",
        "[ ] Handle edge cases (missing files, invalid JSON)"
      ],
      "phase_1_checklist": [
        "[ ] Implement handle_archive_feature() in tool_handlers.py",
        "[ ] Add validation for project_path and feature_name",
        "[ ] Check if feature exists in working/",
        "[ ] Check DELIVERABLES.md status",
        "[ ] Prompt user if needed",
        "[ ] Move folder using shutil.move()",
        "[ ] Update index.json",
        "[ ] Add Tool definition to server.py",
        "[ ] Register in TOOL_HANDLERS dict"
      ],
      "phase_2_checklist": [
        "[ ] Create .claude/commands/archive-feature.md",
        "[ ] Update .claude/commands.json",
        "[ ] Test slash command"
      ],
      "phase_3_checklist": [
        "[ ] Write unit tests for helpers",
        "[ ] Write integration test for full workflow",
        "[ ] Test edge cases",
        "[ ] Verify all tests passing"
      ],
      "final_checklist": [
        "[ ] Update README.md with new tool",
        "[ ] Update CLAUDE.md tool catalog",
        "[ ] Deploy slash command globally",
        "[ ] Commit and push changes",
        "[ ] Archive this plan using the new tool!"
      ]
    }
  }
}
