# Papertrail Integration - Context v2.0 (Draft for Refinement)

**Workorder:** WO-ENHANCE-GENERATORS-WITH-PAPERTRAIL-001
**Status:** Refinement in progress
**Architecture Decision:** Python package integrated into coderef-docs

---

## Core Architecture

**What:** Python package for universal documentation standards
**Where:** Integrated into coderef-docs only
**How:** Direct import (not CLI, not subprocess)

---

## Structure

```
papertrail/                     # NEW: Python package
├── papertrail/
│   ├── engine.py              # Template inheritance
│   ├── uds.py                 # Headers/footers/validation
│   ├── health.py              # Health scoring
│   └── schemas/
│       └── uds_schema.json

coderef-docs/                   # MODIFIED: Imports papertrail
└── generators/
    └── foundation_generator.py

Other 4 servers                 # UNCHANGED
```

---

## Integration Pattern (Like coderef-context)

```
papertrail → coderef-docs → Other servers
(package)    (importer)      (consumers)
```

**Example:**
- coderef-workflow needs docs → calls coderef-docs MCP tools
- coderef-docs uses papertrail internally → returns UDS-compliant docs
- Other servers get standardized output without knowing about papertrail

---

## What Papertrail Provides

1. **UDS Headers/Footers** - workorder_id, generated_by, timestamp, status
2. **Template Engine** - Inheritance, conditionals, includes
3. **Schema Validation** - Enforce documentation standards
4. **Health Scoring** - 0-100 completeness/freshness score
5. **AI Enhancement** - Optional polish layer

---

## UDS Standard (Every Doc)

**Header:**
```yaml
---
title: Authentication System Architecture
version: 2.1.0
generated_by: coderef-docs v1.2.0
workorder_id: WO-AUTH-SYSTEM-001
feature_id: auth-system
status: APPROVED
timestamp: 2025-12-28T10:15:00Z
classification: INTERNAL
---
```

**Footer:**
```yaml
---
Copyright © 2025 | CodeRef Ecosystem
Generated by: coderef-docs v1.2.0
Workorder: WO-AUTH-SYSTEM-001
Feature: auth-system
Last Updated: 2025-12-28
AI Assistance: true
Status: APPROVED
Next Review: 2026-01-28
---
```

---

## Implementation Phases

**Phase 1 (2-3 weeks):** Build `papertrail/` standalone
**Phase 2 (1 week):** Integrate into `coderef-docs`
**Phase 3 (1 week):** Test all 5 servers
**Phase 4 (1-2 weeks):** Feature flag rollout

**Total: 5-7 weeks, 1 server modified**

---

## Key Decisions

✅ Python package (not CLI) - same language, direct import
✅ coderef-docs only - documentation authority
✅ Feature flags - safe rollout with instant rollback
✅ Zero changes to other 4 servers - already consume coderef-docs

---

## Questions for Refinement

1. What specific template features do we need from the TypeScript version?
2. Which POWER framework sections should be required vs optional?
3. Should AI enhancement be Phase 1 or separate future enhancement?
4. Health scoring algorithm - what weights for completeness/freshness/validation?
5. Schema validation - strict (fail on errors) or permissive (warnings)?

---

**Next:** Refine requirements, finalize scope, update plan.json
