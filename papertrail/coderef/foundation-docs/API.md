---
agent: coderef-docs v1.2.0
date: '2026-01-10'
task: DOCUMENT
workorder_id: WO-PAPERTRAIL-FOUNDATION-DOCS-001
generated_by: coderef-docs v1.2.0
feature_id: foundation-docs
timestamp: '2025-12-30T00:00:00Z'
title: Papertrail API Reference
version: 1.0.0
status: APPROVED
doc_type: api
---

# Papertrail API Reference

## Purpose

This document provides the complete API reference for Papertrail, the Universal Documentation Standards (UDS) package for the CodeRef ecosystem. It covers all public classes, functions, and integrations for implementing UDS headers/footers, schema validation, health scoring, and template rendering.

## Overview

Papertrail exposes four main API surfaces:

1. **UDS Data Structures** - `UDSHeader`, `UDSFooter`, enums for document types and statuses
2. **Validation API** - Schema validation and metadata checking
3. **Health Scoring API** - Document quality metrics (0-100 scoring)
4. **Template Engine API** - Jinja2-based templating with CodeRef extensions

All APIs are designed for programmatic access by MCP servers (coderef-docs, coderef-workflow) and standalone Python applications.

## API Endpoints

### 1. UDS Data Structures API

#### Module: `papertrail.uds`

**Classes:**

##### `UDSHeader`

Represents a UDS header (YAML frontmatter) for complete document traceability.

```python
from papertrail import UDSHeader, DocumentType, DocumentStatus

header = UDSHeader(
    workorder_id="WO-AUTH-SYSTEM-001",
    generated_by="coderef-docs v1.2.0",
    feature_id="auth-system",
    timestamp="2025-12-30T10:15:00Z",
    title="Authentication System Architecture",
    version="2.1.0",
    status=DocumentStatus.APPROVED,
    classification="INTERNAL",
    doc_type=DocumentType.ARCHITECTURE
)

# Generate YAML frontmatter
yaml_output = header.to_yaml()
print(yaml_output)
```

**Fields:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `workorder_id` | `str` | Yes | Workorder ID (format: `WO-{FEATURE}-{CATEGORY}-###`) |
| `generated_by` | `str` | Yes | MCP server attribution (format: `coderef-{server} v{version}`) |
| `feature_id` | `str` | Yes | Feature name (alphanumeric, hyphens, underscores) |
| `timestamp` | `str` | Yes | ISO 8601 timestamp (format: `YYYY-MM-DDTHH:MM:SSZ`) |
| `title` | `str` | No | Document title |
| `version` | `str` | No | Document version |
| `status` | `DocumentStatus` | No | Document lifecycle status |
| `classification` | `str` | No | Security classification (INTERNAL, PUBLIC, CONFIDENTIAL) |
| `doc_type` | `DocumentType` | No | Document type |

**Methods:**

- `to_yaml() -> str` - Generate YAML frontmatter with `---` delimiters
- `from_dict(data: dict) -> UDSHeader` - Create UDSHeader from dictionary

**Example Output:**

```yaml
---
workorder_id: WO-AUTH-SYSTEM-001
generated_by: coderef-docs v1.2.0
feature_id: auth-system
timestamp: '2025-12-30T10:15:00Z'
title: Authentication System Architecture
version: 2.1.0
status: APPROVED
classification: INTERNAL
doc_type: architecture
---
```

##### `UDSFooter`

Represents a UDS footer for attribution and tracking.

```python
from papertrail import UDSFooter, DocumentStatus

footer = UDSFooter(
    copyright_year=2025,
    organization="CodeRef Ecosystem",
    generated_by="coderef-docs v1.2.0",
    workorder_id="WO-AUTH-SYSTEM-001",
    feature_id="auth-system",
    last_updated="2025-12-30",
    ai_assistance=True,
    status=DocumentStatus.APPROVED,
    next_review="2026-12-30",
    contributors=["Agent1", "Agent2"]
)

# Generate YAML footer
yaml_output = footer.to_yaml()
print(yaml_output)
```

**Fields:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `copyright_year` | `int` | Yes | Copyright year |
| `organization` | `str` | Yes | Organization name |
| `generated_by` | `str` | Yes | MCP server attribution |
| `workorder_id` | `str` | Yes | Workorder ID |
| `feature_id` | `str` | Yes | Feature name |
| `last_updated` | `str` | Yes | Last update date (format: `YYYY-MM-DD`) |
| `ai_assistance` | `bool` | No | AI assistance used (default: `True`) |
| `status` | `DocumentStatus` | No | Document status |
| `next_review` | `str` | No | Next review date (format: `YYYY-MM-DD`) |
| `contributors` | `list[str]` | No | List of contributors |

**Methods:**

- `to_yaml() -> str` - Generate YAML footer with `---` delimiters
- `from_dict(data: dict) -> UDSFooter` - Create UDSFooter from dictionary

**Example Output:**

```yaml
---
Copyright © 2025 | CodeRef Ecosystem
Generated by: coderef-docs v1.2.0
Workorder: WO-AUTH-SYSTEM-001
Feature: auth-system
Last Updated: 2025-12-30
AI Assistance: true
Status: APPROVED
Next Review: 2026-12-30
Contributors:
  - Agent1
  - Agent2
---
```

##### Enums

**`DocumentType`**

```python
class DocumentType(Enum):
    PLAN = "plan"
    DELIVERABLES = "deliverables"
    ARCHITECTURE = "architecture"
    README = "readme"
    API = "api"
    CHANGELOG = "changelog"
```

**`DocumentStatus`**

```python
class DocumentStatus(Enum):
    DRAFT = "DRAFT"
    REVIEW = "REVIEW"
    APPROVED = "APPROVED"
    DEPRECATED = "DEPRECATED"
```

#### Convenience Functions

**`create_uds_header()`**

Auto-generate UDS header with current timestamp.

```python
from papertrail import create_uds_header, DocumentStatus, DocumentType

header = create_uds_header(
    workorder_id="WO-AUTH-SYSTEM-001",
    generated_by="coderef-docs v1.2.0",
    feature_id="auth-system",
    title="Authentication System Architecture",
    version="2.1.0",
    status=DocumentStatus.APPROVED,
    doc_type=DocumentType.ARCHITECTURE
)

print(header.timestamp)  # Auto-generated: 2025-12-30T10:15:23Z
```

**Parameters:**

- `workorder_id: str` - Workorder ID
- `generated_by: str` - MCP server attribution
- `feature_id: str` - Feature name
- `title: Optional[str]` - Document title
- `version: Optional[str]` - Document version
- `status: DocumentStatus` - Document status (default: `DRAFT`)
- `doc_type: Optional[DocumentType]` - Document type

**Returns:** `UDSHeader`

**`create_uds_footer()`**

Auto-generate UDS footer with current dates.

```python
from papertrail import create_uds_footer, DocumentStatus

footer = create_uds_footer(
    workorder_id="WO-AUTH-SYSTEM-001",
    generated_by="coderef-docs v1.2.0",
    feature_id="auth-system",
    organization="CodeRef Ecosystem",
    status=DocumentStatus.APPROVED,
    contributors=["Agent1", "Agent2"]
)

print(footer.last_updated)  # Auto-generated: 2025-12-30
print(footer.next_review)   # Auto-generated: 2026-12-30
```

**Parameters:**

- `workorder_id: str` - Workorder ID
- `generated_by: str` - MCP server attribution
- `feature_id: str` - Feature name
- `organization: str` - Organization name (default: `"CodeRef Ecosystem"`)
- `status: Optional[DocumentStatus]` - Document status
- `contributors: Optional[list[str]]` - List of contributors

**Returns:** `UDSFooter`

---

### 2. Validation API

#### Module: `papertrail.validator`

**Classes:**

##### `ValidationResult`

Represents the result of UDS validation.

```python
@dataclass
class ValidationResult:
    valid: bool                    # True if passes all CRITICAL checks
    errors: list[ValidationError]  # All validation errors
    warnings: list[str]            # Warning messages
    score: int                     # Validation score (0-100)
```

##### `ValidationError`

Represents a single validation error.

```python
@dataclass
class ValidationError:
    severity: ValidationSeverity  # CRITICAL, MAJOR, MINOR, WARNING
    message: str                  # Error message
    section: Optional[str]        # Section name (if applicable)
    field: Optional[str]          # Field name (if applicable)
```

##### `ValidationSeverity`

```python
class ValidationSeverity(Enum):
    CRITICAL = "CRITICAL"  # -50 points
    MAJOR = "MAJOR"        # -20 points
    MINOR = "MINOR"        # -10 points
    WARNING = "WARNING"    # -5 points
```

##### `UDSValidator`

Schema-based document validator.

```python
from papertrail.validator import UDSValidator

validator = UDSValidator()  # Auto-loads schemas from package

# Validate document
doc_content = """
---
workorder_id: WO-AUTH-SYSTEM-001
generated_by: coderef-docs v1.2.0
feature_id: auth-system
timestamp: '2025-12-30T10:15:00Z'
---

# Architecture

## Purpose
...
"""

result = validator.validate(doc_content, "architecture")
print(f"Valid: {result.valid}")
print(f"Score: {result.score}/100")

for error in result.errors:
    print(f"[{error.severity.value}] {error.message}")
```

**Methods:**

- `validate(document: str, doc_type: str) -> ValidationResult` - Validate document against schema

**Supported Document Types:**

- `plan` - Implementation plans (plan.json)
- `deliverables` - Execution tracking (DELIVERABLES.md)
- `architecture` - Architecture docs (ARCHITECTURE.md)
- `readme` - Project overview (README.md)
- `api` - API documentation (API.md)

#### Convenience Functions

**`validate_uds()`**

Quick validation without creating validator instance.

```python
from papertrail import validate_uds

result = validate_uds(doc_content, "architecture")
print(f"Valid: {result.valid}, Score: {result.score}")
```

**Parameters:**

- `document: str` - Document content (markdown or JSON)
- `doc_type: str` - Document type (`plan`, `deliverables`, `architecture`, `readme`, `api`)

**Returns:** `ValidationResult`

**`validate_workorder_id()`**

Validate workorder ID format.

```python
from papertrail.validator import validate_workorder_id

valid = validate_workorder_id("WO-AUTH-SYSTEM-001")  # True
valid = validate_workorder_id("WO-AUTH-001")         # False (missing category)
valid = validate_workorder_id("invalid")             # False
```

**Format:** `WO-{SEGMENT}(-{SEGMENT})+-{3 DIGITS}` (requires at least 2 segments before final 3 digits)

**Parameters:**

- `workorder_id: str` - Workorder ID to validate

**Returns:** `bool`

**`validate_feature_id()`**

Validate feature ID format.

```python
from papertrail.validator import validate_feature_id

valid = validate_feature_id("auth-system")    # True
valid = validate_feature_id("Auth System!")   # False
```

**Format:** Alphanumeric, hyphens, underscores only (`^[a-z0-9_-]+$`)

**Parameters:**

- `feature_id: str` - Feature ID to validate

**Returns:** `bool`

---

### 3. Health Scoring API

#### Module: `papertrail.health`

**Classes:**

##### `HealthScore`

Represents document health score breakdown.

```python
@dataclass
class HealthScore:
    score: int                   # Overall health score (0-100)
    traceability: int            # Traceability score (0-40)
    completeness: int            # Completeness score (0-30)
    freshness: int               # Freshness score (0-20)
    validation: int              # Validation score (0-10)
    has_workorder_id: bool       # Has workorder ID
    has_feature_id: bool         # Has feature ID
    has_mcp_attribution: bool    # Has MCP attribution
    age_days: int                # Age of document in days
    passes_validation: bool      # Passes schema validation
```

**Health Score Formula:**

| Component | Weight | Scoring Logic |
|-----------|--------|---------------|
| **Traceability** | 40% | Has workorder_id (20pt) + Has feature_id (10pt) + Has MCP attribution (10pt) |
| **Completeness** | 30% | All required sections (20pt) + Has examples (10pt) |
| **Freshness** | 20% | <7 days (20pt), 7-30 days (10pt), 30-90 days (5pt), >90 days (0pt) |
| **Validation** | 10% | Passes schema validation (10pt) |

##### `HealthScorer`

Document health scorer.

```python
from papertrail.health import HealthScorer

scorer = HealthScorer()

health = scorer.calculate_health(doc_content, "architecture")
print(f"Health Score: {health.score}/100")
print(f"  Traceability: {health.traceability}/40")
print(f"  Completeness: {health.completeness}/30")
print(f"  Freshness: {health.freshness}/20")
print(f"  Validation: {health.validation}/10")
print(f"  Age: {health.age_days} days")
```

**Methods:**

- `calculate_health(document: str, doc_type: str) -> HealthScore` - Calculate health score

#### Convenience Functions

**`calculate_health()`**

Quick health calculation without creating scorer instance.

```python
from papertrail import calculate_health

health = calculate_health(doc_content, "architecture")
print(f"Health Score: {health.score}/100")
```

**Parameters:**

- `document: str` - Document content
- `doc_type: str` - Document type

**Returns:** `HealthScore`

---

### 4. Template Engine API

#### Module: `papertrail.engine`

**Classes:**

##### `TemplateEngine`

Jinja2-based template engine with UDS injection and CodeRef extensions.

```python
from papertrail import TemplateEngine, create_uds_header, create_uds_footer
from pathlib import Path

# Initialize engine
engine = TemplateEngine(template_dir=Path("templates/"))

# Register extension
from papertrail.extensions import GitExtension
engine.register_extension("git", GitExtension())

# Render template
template = """
# {{ title }}

Last commit: {{ git.last_commit() }}
"""

result = engine.render(template, {"title": "My Doc"})
print(result)
```

**Methods:**

- `register_extension(name: str, extension: Any)` - Register CodeRef extension
- `render(template_content: str, context: Dict[str, Any]) -> str` - Render template string
- `render_file(template_path: str, context: Dict[str, Any]) -> str` - Render template from file
- `inject_uds(content: str, header: UDSHeader, footer: Optional[UDSFooter]) -> str` - Inject UDS header/footer
- `render_with_uds(template_content: str, context: Dict[str, Any], header: UDSHeader, footer: Optional[UDSFooter]) -> str` - Render and inject UDS in one step

**Example: Render with UDS**

```python
from papertrail import TemplateEngine, create_uds_header, create_uds_footer

engine = TemplateEngine()

header = create_uds_header(
    workorder_id="WO-FEATURE-001",
    generated_by="coderef-docs v1.2.0",
    feature_id="my-feature"
)

footer = create_uds_footer(
    workorder_id="WO-FEATURE-001",
    generated_by="coderef-docs v1.2.0",
    feature_id="my-feature"
)

template = "# {{ title }}\n\nContent here."
context = {"title": "Architecture"}

doc = engine.render_with_uds(template, context, header, footer)
print(doc)
```

**Output:**

```markdown
---
workorder_id: WO-FEATURE-001
generated_by: coderef-docs v1.2.0
feature_id: my-feature
timestamp: '2025-12-30T10:15:23Z'
---

# Architecture

Content here.

---
Copyright © 2025 | CodeRef Ecosystem
Generated by: coderef-docs v1.2.0
Workorder: WO-FEATURE-001
Feature: my-feature
Last Updated: 2025-12-30
AI Assistance: true
Next Review: 2026-12-30
---
```

#### Convenience Functions

**`create_template_engine()`**

Create engine with pre-registered extensions.

```python
from papertrail import create_template_engine
from papertrail.extensions import GitExtension, CodeRefContextExtension

engine = create_template_engine(
    template_dir=Path("templates/"),
    extensions={
        'git': GitExtension(),
        'coderef': CodeRefContextExtension()
    }
)

# Now can use: {{ git.stats() }} and {{ coderef.scan() }} in templates
```

**Parameters:**

- `template_dir: Optional[Path]` - Directory containing template files
- `extensions: Optional[Dict[str, Any]]` - Dictionary of {name: extension_object}

**Returns:** `TemplateEngine`

---

### 5. CodeRef Extensions API

#### Module: `papertrail.extensions`

**Available Extensions:**

| Extension | Purpose | Example Usage |
|-----------|---------|---------------|
| `CodeRefContextExtension` | Code intelligence (scan, query, impact) | `{{ coderef.scan(project_path) }}` |
| `GitExtension` | Git statistics (stats, files, contributors) | `{{ git.stats(feature_name) }}` |
| `WorkflowExtension` | Workflow data (plan, tasks, progress) | `{{ workflow.plan(feature_name) }}` |

**Example:**

```python
from papertrail import create_template_engine
from papertrail.extensions import GitExtension

engine = create_template_engine(
    extensions={'git': GitExtension()}
)

template = """
# Feature Report

Files changed: {{ git.files_changed('my-feature') }}
Contributors: {{ git.contributors('my-feature') }}
"""

result = engine.render(template, {})
print(result)
```

---

## Authentication

**Not Applicable** - Papertrail is a Python library, not a web service. All APIs are local function calls.

## Rate Limiting

**Not Applicable** - No rate limiting for local library usage.

## Error Handling

**Standard Python Exceptions:**

- `ValueError` - Invalid input parameters (e.g., malformed workorder ID, invalid doc type)
- `FileNotFoundError` - Template file not found (when using `render_file()`)
- `yaml.YAMLError` - Invalid YAML in document frontmatter

**Example:**

```python
from papertrail import validate_uds

try:
    result = validate_uds(doc_content, "unknown_type")
except ValueError as e:
    print(f"Error: {e}")  # Unknown document type: unknown_type
```

**Validation Errors:**

Validation errors are returned as structured `ValidationError` objects, not exceptions:

```python
result = validate_uds(doc_content, "architecture")

if not result.valid:
    for error in result.errors:
        if error.severity == ValidationSeverity.CRITICAL:
            print(f"CRITICAL: {error.message}")
```

---

## Versioning

**Current Version:** 1.0.0

**Versioning Scheme:** Semantic Versioning (SemVer)

- **Major** (1.x.x) - Breaking changes to public API
- **Minor** (x.1.x) - New features, backward compatible
- **Patch** (x.x.1) - Bug fixes, backward compatible

**Version Check:**

```python
import papertrail
print(papertrail.__version__)  # 1.0.0
```

---

## Integration with coderef-docs

**Automatic UDS Injection (Phase 4):**

When `PAPERTRAIL_ENABLED=true`, coderef-docs MCP server automatically injects UDS headers/footers into all generated documents.

**MCP Tool Example:**

```python
# Generate document with UDS using MCP tool
{
  "tool": "generate_individual_doc",
  "arguments": {
    "project_path": "/path/to/project",
    "template_name": "readme",
    "workorder_id": "WO-FEATURE-001",  # Optional: enables UDS
    "feature_id": "my-feature",        # Optional: defaults to template_name
    "version": "1.0.0"                 # Optional: defaults to 1.0.0
  }
}
```

**Result:** Complete document with UDS headers/footers automatically injected.

**Supported Document Types:** README, ARCHITECTURE, API, SCHEMA, COMPONENTS

**Feature Flag:** Set `PAPERTRAIL_ENABLED=false` to use legacy generation (backward compatible).

---

## Code Examples

### Complete Workflow Example

```python
from papertrail import (
    create_uds_header,
    create_uds_footer,
    TemplateEngine,
    validate_uds,
    calculate_health,
    DocumentStatus,
    DocumentType
)

# 1. Create UDS header
header = create_uds_header(
    workorder_id="WO-AUTH-SYSTEM-001",
    generated_by="coderef-docs v1.2.0",
    feature_id="auth-system",
    title="Authentication System Architecture",
    version="2.1.0",
    status=DocumentStatus.APPROVED,
    doc_type=DocumentType.ARCHITECTURE
)

# 2. Create UDS footer
footer = create_uds_footer(
    workorder_id="WO-AUTH-SYSTEM-001",
    generated_by="coderef-docs v1.2.0",
    feature_id="auth-system",
    status=DocumentStatus.APPROVED,
    contributors=["Agent1", "Agent2"]
)

# 3. Render template with UDS
engine = TemplateEngine()

template = """
# {{ title }}

## Purpose
This document describes the authentication system architecture.

## Overview
- JWT-based authentication
- OAuth 2.0 integration
- Role-based access control
"""

context = {"title": "Authentication System Architecture"}
doc = engine.render_with_uds(template, context, header, footer)

# 4. Validate document
result = validate_uds(doc, "architecture")
print(f"Valid: {result.valid}, Score: {result.score}/100")

# 5. Calculate health score
health = calculate_health(doc, "architecture")
print(f"Health Score: {health.score}/100")
print(f"  Traceability: {health.traceability}/40")
print(f"  Completeness: {health.completeness}/30")
print(f"  Freshness: {health.freshness}/20")
print(f"  Validation: {health.validation}/10")

# 6. Save document
with open("ARCHITECTURE.md", "w") as f:
    f.write(doc)
```

---

## References

- [Papertrail README](../../README.md) - Project overview and installation
- [CodeRef Workflow Architecture](../../../coderef-workflow/CLAUDE.md) - Planning & orchestration
- [CodeRef Docs Architecture](../../../coderef-docs/CLAUDE.md) - Documentation system
- [UDS Schemas](../../papertrail/schemas/) - JSON schemas for validation

---

Copyright © 2025 | CodeRef Ecosystem
Generated by: coderef-docs v1.2.0
Workorder: WO-PAPERTRAIL-FOUNDATION-DOCS-001
Feature: foundation-docs
Last Updated: 2025-12-30
AI Assistance: true
Status: APPROVED
