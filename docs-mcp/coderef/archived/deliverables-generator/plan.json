{
  "META_DOCUMENTATION": {
    "feature_name": "deliverables-generator",
    "version": "1.0.0",
    "status": "complete",
    "generated_by": "AI Assistant",
    "generated_date": "2025-10-18",
    "has_context": true,
    "has_analysis": false,
    "template_version": "2.0.0"
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "foundation_documents": {
        "readme": {
          "path": "README.md",
          "exists": true,
          "relevance": "High - describes docs-mcp server purpose and tool ecosystem"
        },
        "architecture": {
          "path": "ARCHITECTURE.md",
          "exists": true,
          "relevance": "High - describes MCP server architecture patterns"
        },
        "claude_md": {
          "path": "CLAUDE.md",
          "exists": true,
          "relevance": "High - AI context for tool implementation patterns"
        }
      },
      "coding_standards": {
        "python_style": {
          "source": "Inferred from existing codebase",
          "key_patterns": [
            "Async function signatures for MCP tools",
            "@log_invocation and @mcp_error_handler decorators",
            "Type hints with pathlib.Path for file paths",
            "JSON response formatting with format_success_response()"
          ]
        },
        "error_handling": {
          "pattern": "Raise ValueError/FileNotFoundError with descriptive messages",
          "validation": "Use validate_project_path_input() and validate_feature_name_input()"
        }
      },
      "reference_implementations": {
        "similar_tools": [
          {
            "name": "gather_context",
            "file": "tool_handlers.py:1201",
            "relevance": "Similar workflow tool - creates context.json in working directory"
          },
          {
            "name": "create_plan",
            "file": "tool_handlers.py:~600",
            "relevance": "Planning tool that loads context/analysis and generates plan.json"
          },
          {
            "name": "update_changelog",
            "file": "tool_handlers.py:~1400",
            "relevance": "Git history parsing example"
          }
        ],
        "key_patterns_to_follow": [
          "Use feature_dir pattern: project_path / 'coderef' / 'working' / feature_name",
          "Load plan.json from feature_dir / 'plan.json'",
          "Use git commands via subprocess for history parsing",
          "Return formatted success response with file paths"
        ]
      },
      "technical_constraints": [
        "Must work with existing MCP server architecture",
        "Must follow async/await patterns for MCP tools",
        "Must handle Windows and Unix file paths",
        "Git repository must exist for history parsing",
        "Plan.json must exist in feature working directory"
      ]
    },
    "1_executive_summary": {
      "feature_overview": "Implement automatic deliverables report generation integrated into the /create-plan workflow. Generate DELIVERABLES.md templates during planning with phase structure and task checklists, then update with actual metrics post-implementation.",
      "business_value": "Automates project documentation by tracking what was built, how much code was written, and how long it took. Provides clear visibility into feature delivery and enables better project retrospectives.",
      "key_objectives": [
        "Generate DELIVERABLES.md template automatically when /create-plan runs",
        "Parse git history to calculate implementation metrics (LOC, commits, time)",
        "Update deliverables report with actual metrics after feature completion",
        "Integrate seamlessly with existing planning workflow (gather â†’ analyze â†’ create â†’ validate)"
      ],
      "success_metrics": {
        "functional": "DELIVERABLES.md generated automatically with plan structure and updated with git metrics",
        "performance": "Template generation < 1 second, metrics update < 5 seconds",
        "adoption": "Every feature using /create-plan gets deliverables tracking"
      }
    },
    "2_risk_assessment": {
      "complexity_estimate": {
        "overall": "Medium",
        "justification": "Requires git parsing logic and template generation, but follows existing tool patterns. Integration with /create-plan slash command adds minor complexity."
      },
      "technical_risks": [
        {
          "risk": "Git history parsing may be unreliable if commit messages don't follow conventions",
          "likelihood": "Medium",
          "impact": "Medium",
          "mitigation": "Use fuzzy matching on feature name, support manual metric override"
        },
        {
          "risk": "Slash command modification may break existing /create-plan workflow",
          "likelihood": "Low",
          "impact": "High",
          "mitigation": "Make deliverables generation optional with flag, test both code paths"
        },
        {
          "risk": "LOC counting may be inaccurate for complex diffs (renames, large refactors)",
          "likelihood": "Medium",
          "impact": "Low",
          "mitigation": "Use git diff --stat and --numstat, document limitations"
        }
      ],
      "dependencies": [
        {
          "type": "External",
          "name": "Git",
          "risk": "Git must be available in system PATH",
          "mitigation": "Check git availability on tool initialization, provide clear error"
        },
        {
          "type": "Internal",
          "name": "plan.json structure",
          "risk": "Template depends on plan.json phase structure being stable",
          "mitigation": "Use defensive JSON parsing with fallbacks"
        }
      ],
      "rollback_strategy": "Feature is additive - if issues arise, can disable deliverables generation in /create-plan without affecting core planning workflow"
    },
    "3_current_state_analysis": {
      "existing_components": {
        "slash_commands": {
          "create_plan": {
            "path": ".claude/commands/create-plan.md",
            "current_behavior": "Calls mcp__docs-mcp__create_plan tool to generate plan.json",
            "modification_needed": "Add call to mcp__docs-mcp__generate_deliverables_template after plan generation"
          }
        },
        "mcp_tools": {
          "create_plan": {
            "file": "tool_handlers.py:~600",
            "current_behavior": "Loads context/analysis, synthesizes plan.json",
            "integration_point": "After successful plan.json creation, trigger deliverables template generation"
          }
        },
        "helper_functions": {
          "git_utils": {
            "exists": false,
            "needed": "Git history parsing, commit discovery, LOC calculation"
          },
          "template_renderer": {
            "exists": false,
            "needed": "Markdown template generation from plan.json structure"
          }
        }
      },
      "files_to_create": [
        {
          "path": "tool_handlers.py",
          "purpose": "Add handle_generate_deliverables_template() and handle_update_deliverables() functions",
          "estimated_loc": 200
        },
        {
          "path": "templates/DELIVERABLES_template.md",
          "purpose": "Markdown template for deliverables report structure",
          "estimated_loc": 100
        }
      ],
      "files_to_modify": [
        {
          "path": "server.py",
          "changes": "Add Tool definitions for generate_deliverables_template and update_deliverables",
          "estimated_loc": 40
        },
        {
          "path": "tool_handlers.py",
          "changes": "Register new handlers in TOOL_HANDLERS dict",
          "estimated_loc": 10
        },
        {
          "path": ".claude/commands/create-plan.md",
          "changes": "Add automatic deliverables template generation step",
          "estimated_loc": 20
        }
      ]
    },
    "4_key_features": {
      "F1": {
        "id": "F1",
        "name": "Automatic Deliverables Template Generation",
        "description": "Generate DELIVERABLES.md template during /create-plan with phase structure, task checklists, and metric placeholders",
        "priority": "Critical",
        "user_story": "As a developer, when I run /create-plan, I want a DELIVERABLES.md template automatically created so I can track what I'm building without manual setup",
        "acceptance_criteria": [
          "DELIVERABLES.md created in coderef/working/{feature-name}/ when /create-plan runs",
          "Template includes all implementation phases from plan.json",
          "Each phase has task checklist with [ ] checkboxes",
          "Metrics section has TBD placeholders for LOC, commits, time",
          "Status shows ðŸš§ Not Started initially"
        ]
      },
      "F2": {
        "id": "F2",
        "name": "Git History Parsing for Metrics",
        "description": "Parse git commit history to calculate actual implementation metrics (LOC, commits, time spent)",
        "priority": "Critical",
        "user_story": "As a developer, after implementing a feature, I want metrics automatically calculated from git history so I don't manually count lines of code",
        "acceptance_criteria": [
          "Discovers commits related to feature by searching commit messages",
          "Calculates total LOC added/modified using git diff --stat",
          "Counts number of commits related to feature",
          "Calculates time spent from first to last commit timestamp",
          "Handles case where no commits found (returns 0 metrics)"
        ]
      },
      "F3": {
        "id": "F3",
        "name": "Update Deliverables with Actual Metrics",
        "description": "Update DELIVERABLES.md template with real metrics after feature implementation",
        "priority": "Critical",
        "user_story": "As a developer, when I finish implementing, I want to run /update-deliverables to automatically fill in real metrics from git history",
        "acceptance_criteria": [
          "Loads existing DELIVERABLES.md template",
          "Replaces TBD placeholders with actual calculated metrics",
          "Updates status from ðŸš§ Not Started to âœ… Complete",
          "Marks task checkboxes as [x] completed based on git history",
          "Preserves manual edits to deliverables file"
        ]
      },
      "F4": {
        "id": "F4",
        "name": "Integration with /create-plan Workflow",
        "description": "Seamlessly integrate deliverables generation into existing planning workflow",
        "priority": "High",
        "user_story": "As a developer, I want deliverables tracking to happen automatically as part of my normal planning workflow",
        "acceptance_criteria": [
          "/create-plan calls both create_plan and generate_deliverables_template",
          "Returns both plan.json and DELIVERABLES.md paths to user",
          "Failure in deliverables generation doesn't break plan creation",
          "User sees confirmation that both files were created"
        ]
      }
    },
    "5_task_id_system": {
      "task_breakdown": {
        "F1_tasks": [
          {
            "id": "F1.1",
            "description": "Create DELIVERABLES_template.md markdown template file",
            "estimated_effort": "Small",
            "dependencies": []
          },
          {
            "id": "F1.2",
            "description": "Implement handle_generate_deliverables_template() function",
            "estimated_effort": "Medium",
            "dependencies": ["F1.1"]
          },
          {
            "id": "F1.3",
            "description": "Add generate_deliverables_template Tool definition to server.py",
            "estimated_effort": "Small",
            "dependencies": ["F1.2"]
          },
          {
            "id": "F1.4",
            "description": "Register handler in TOOL_HANDLERS dict",
            "estimated_effort": "Small",
            "dependencies": ["F1.2"]
          }
        ],
        "F2_tasks": [
          {
            "id": "F2.1",
            "description": "Create git_parse_history() helper function to discover commits",
            "estimated_effort": "Medium",
            "dependencies": []
          },
          {
            "id": "F2.2",
            "description": "Create git_calculate_loc() helper to count lines of code changes",
            "estimated_effort": "Medium",
            "dependencies": []
          },
          {
            "id": "F2.3",
            "description": "Create git_calculate_time_spent() helper to compute duration",
            "estimated_effort": "Small",
            "dependencies": ["F2.1"]
          },
          {
            "id": "F2.4",
            "description": "Add error handling for missing git or non-git repositories",
            "estimated_effort": "Small",
            "dependencies": ["F2.1", "F2.2", "F2.3"]
          }
        ],
        "F3_tasks": [
          {
            "id": "F3.1",
            "description": "Implement handle_update_deliverables() function",
            "estimated_effort": "Medium",
            "dependencies": ["F2.1", "F2.2", "F2.3"]
          },
          {
            "id": "F3.2",
            "description": "Add update_deliverables Tool definition to server.py",
            "estimated_effort": "Small",
            "dependencies": ["F3.1"]
          },
          {
            "id": "F3.3",
            "description": "Register handler in TOOL_HANDLERS dict",
            "estimated_effort": "Small",
            "dependencies": ["F3.1"]
          },
          {
            "id": "F3.4",
            "description": "Implement smart placeholder replacement preserving manual edits",
            "estimated_effort": "Medium",
            "dependencies": ["F3.1"]
          }
        ],
        "F4_tasks": [
          {
            "id": "F4.1",
            "description": "Modify .claude/commands/create-plan.md to call deliverables template generation",
            "estimated_effort": "Small",
            "dependencies": ["F1.3"]
          },
          {
            "id": "F4.2",
            "description": "Add error handling to gracefully handle deliverables generation failures",
            "estimated_effort": "Small",
            "dependencies": ["F4.1"]
          },
          {
            "id": "F4.3",
            "description": "Update /create-plan output message to mention both files created",
            "estimated_effort": "Small",
            "dependencies": ["F4.1"]
          }
        ]
      },
      "total_tasks": 15,
      "estimated_total_effort": "Medium (12-16 hours)"
    },
    "6_implementation_phases": {
      "phase_1": {
        "name": "Core Git Utilities and Template Infrastructure",
        "description": "Build foundation: git parsing helpers and deliverables template structure",
        "tasks": ["F2.1", "F2.2", "F2.3", "F2.4", "F1.1"],
        "deliverables": [
          "Git utility functions for history parsing and metrics",
          "DELIVERABLES_template.md template file"
        ],
        "estimated_duration": "4-6 hours",
        "dependencies": []
      },
      "phase_2": {
        "name": "MCP Tool Implementation",
        "description": "Implement generate_deliverables_template and update_deliverables MCP tools",
        "tasks": ["F1.2", "F1.3", "F1.4", "F3.1", "F3.2", "F3.3", "F3.4"],
        "deliverables": [
          "handle_generate_deliverables_template() function in tool_handlers.py",
          "handle_update_deliverables() function in tool_handlers.py",
          "Tool definitions registered in server.py"
        ],
        "estimated_duration": "6-8 hours",
        "dependencies": ["phase_1"]
      },
      "phase_3": {
        "name": "Workflow Integration and Testing",
        "description": "Integrate with /create-plan slash command and validate end-to-end workflow",
        "tasks": ["F4.1", "F4.2", "F4.3"],
        "deliverables": [
          "Modified .claude/commands/create-plan.md",
          "Integration testing with real feature planning workflow",
          "Updated documentation"
        ],
        "estimated_duration": "2-3 hours",
        "dependencies": ["phase_2"]
      }
    },
    "7_testing_strategy": {
      "unit_tests": {
        "scope": "Individual git utility functions and template rendering",
        "test_cases": [
          {
            "test_id": "UT-1",
            "description": "Test git_parse_history() discovers commits with feature name in message",
            "inputs": "Mock git log output with various commit messages",
            "expected_output": "Returns only commits matching feature name pattern"
          },
          {
            "test_id": "UT-2",
            "description": "Test git_calculate_loc() correctly parses git diff --stat output",
            "inputs": "Mock git diff output: '2 files changed, 150 insertions(+), 20 deletions(-)'",
            "expected_output": "Returns {added: 150, deleted: 20, net: 130}"
          },
          {
            "test_id": "UT-3",
            "description": "Test git_calculate_time_spent() handles single commit",
            "inputs": "Single commit timestamp",
            "expected_output": "Returns 0 hours (minimum threshold)"
          },
          {
            "test_id": "UT-4",
            "description": "Test template generation with minimal plan.json",
            "inputs": "Plan with 2 phases, 3 tasks total",
            "expected_output": "DELIVERABLES.md with correct phase structure and checkboxes"
          }
        ]
      },
      "integration_tests": {
        "scope": "Full workflow from /create-plan to /update-deliverables",
        "test_scenarios": [
          {
            "test_id": "IT-1",
            "description": "Test /create-plan generates both plan.json and DELIVERABLES.md",
            "steps": [
              "Run /gather-context for test feature",
              "Run /create-plan",
              "Verify plan.json exists",
              "Verify DELIVERABLES.md exists with template content"
            ],
            "expected_outcome": "Both files created, deliverables has TBD metrics"
          },
          {
            "test_id": "IT-2",
            "description": "Test /update-deliverables calculates real metrics from git",
            "steps": [
              "Create test feature with 3 commits",
              "Commits include feature name in message",
              "Run /update-deliverables",
              "Verify metrics updated in DELIVERABLES.md"
            ],
            "expected_outcome": "LOC, commits, time calculated correctly from git history"
          },
          {
            "test_id": "IT-3",
            "description": "Test graceful handling when no git history exists",
            "steps": [
              "Create feature planning files without commits",
              "Run /update-deliverables",
              "Verify graceful handling"
            ],
            "expected_outcome": "Returns message indicating no commits found, metrics remain TBD"
          }
        ]
      },
      "manual_testing": {
        "critical_paths": [
          "Test on real feature (e.g., fixing-gather-context) with actual git history",
          "Test on Windows and verify file path handling",
          "Test with complex git history (merge commits, rebases)",
          "Test with non-English commit messages",
          "Test manual edits to DELIVERABLES.md are preserved during update"
        ]
      }
    },
    "8_success_criteria": {
      "functional_requirements": [
        {
          "criterion": "Template generation works automatically with /create-plan",
          "measurement": "Running /create-plan creates DELIVERABLES.md in working directory",
          "target": "100% success rate"
        },
        {
          "criterion": "Git metrics calculated accurately",
          "measurement": "Manual verification of LOC, commits, time against git log",
          "target": "Â±10% accuracy for LOC, exact for commits and time"
        },
        {
          "criterion": "Update preserves manual edits",
          "measurement": "Add custom notes to DELIVERABLES.md, run update, verify notes remain",
          "target": "All manual content preserved"
        }
      ],
      "non_functional_requirements": [
        {
          "criterion": "Performance",
          "measurement": "Time to generate template and update metrics",
          "target": "Template < 1s, update < 5s for typical feature"
        },
        {
          "criterion": "Error handling",
          "measurement": "Test with missing git, invalid feature name, corrupted plan.json",
          "target": "Clear error messages, no crashes"
        },
        {
          "criterion": "Documentation",
          "measurement": "Tool descriptions, CLAUDE.md updates, example workflows",
          "target": "Complete documentation with examples"
        }
      ],
      "acceptance_gates": [
        "All unit tests pass",
        "Integration test with real feature shows accurate metrics",
        "/create-plan workflow produces both plan.json and DELIVERABLES.md",
        "/update-deliverables successfully updates metrics from git history",
        "Code review confirms follows existing patterns (decorators, error handling, validation)",
        "Documentation updated in CLAUDE.md with new tools and workflow"
      ]
    },
    "9_implementation_checklist": {
      "phase_1_checklist": [
        "[ ] Create git_parse_history() function with commit discovery logic",
        "[ ] Create git_calculate_loc() function using git diff --stat",
        "[ ] Create git_calculate_time_spent() function from commit timestamps",
        "[ ] Add error handling for git command failures",
        "[ ] Create templates/DELIVERABLES_template.md with phase/task structure",
        "[ ] Test git utilities with mock data",
        "[ ] Verify template renders correctly with sample plan.json"
      ],
      "phase_2_checklist": [
        "[ ] Implement handle_generate_deliverables_template() in tool_handlers.py",
        "[ ] Add @log_invocation and @mcp_error_handler decorators",
        "[ ] Implement template rendering from plan.json phases",
        "[ ] Add Tool definition for generate_deliverables_template to server.py",
        "[ ] Register handler in TOOL_HANDLERS dict",
        "[ ] Implement handle_update_deliverables() in tool_handlers.py",
        "[ ] Implement metric placeholder replacement logic",
        "[ ] Add Tool definition for update_deliverables to server.py",
        "[ ] Register handler in TOOL_HANDLERS dict",
        "[ ] Test both tools independently via MCP"
      ],
      "phase_3_checklist": [
        "[ ] Modify .claude/commands/create-plan.md to call generate_deliverables_template",
        "[ ] Add error handling for deliverables generation failures",
        "[ ] Update output message to confirm both files created",
        "[ ] Test /create-plan end-to-end workflow",
        "[ ] Test /update-deliverables with real git history",
        "[ ] Verify manual edits preservation",
        "[ ] Update CLAUDE.md with new tools and workflow",
        "[ ] Create DELIVERABLES.md for this feature (dogfooding!)",
        "[ ] Code review and final testing",
        "[ ] Commit and tag release"
      ]
    }
  }
}
