{
  "agent_id": "coderef-context",
  "review_date": "2026-01-12",
  "current_implementation": {
    "tools_provided": [
      "coderef_scan - Read .coderef/index.json",
      "coderef_query - Read .coderef/graph.json for relationships",
      "coderef_impact - Analyze dependents from graph.json",
      "coderef_complexity - Estimate from index.json element data",
      "coderef_patterns - Read .coderef/reports/patterns.json",
      "coderef_coverage - Read .coderef/reports/coverage.json",
      "coderef_context - Read .coderef/context.json or context.md",
      "coderef_validate - Read .coderef/reports/validation.json",
      "coderef_drift - Read .coderef/reports/drift.json",
      "coderef_diagram - Read .coderef/diagrams/*.mmd or *.dot",
      "coderef_tag - Error (requires CLI, not read-only)",
      "coderef_export - Read .coderef/exports/graph.json|jsonld|diagram-wrapped.md"
    ],
    "data_sources": [
      ".coderef/index.json - Primary element inventory (ALL tools depend on this)",
      ".coderef/graph.json - Dependency relationships",
      ".coderef/context.json|md - Project overview",
      ".coderef/reports/ - patterns, coverage, validation, drift",
      ".coderef/diagrams/ - Visual dependency graphs (mermaid/dot)",
      ".coderef/exports/ - Multi-format exports"
    ],
    "generation_approach": "code-driven (read pre-scanned .coderef/ files directly)",
    "strengths": [
      "117x faster than CLI subprocess (3ms vs 350ms average) - v2.0 file reader refactor",
      "Zero external dependencies - no Node.js required post-scan",
      "Read-only safety - all operations except tag are non-destructive",
      "Comprehensive data access - 12 tools cover all .coderef/ outputs",
      "Rich relationship queries - graph.json enables dependency tracing",
      "Pattern discovery - reports/patterns.json provides auto-detected patterns",
      "Drift detection - reports/drift.json shows staleness",
      "Visual diagrams - Mermaid/DOT exports for documentation embedding"
    ],
    "weaknesses": [
      "Requires .coderef/ pre-scan - tools fail if index.json missing",
      "No auto-refresh - stale data if codebase changes after scan",
      "Limited complexity metrics - only parameter count estimation (not cyclomatic complexity)",
      "Graph data may be incomplete - depends on scan quality",
      "No incremental updates - must re-scan entire project for changes",
      "Empty index.json for coderef-context itself (0 elements) - Python not scanned by TypeScript CLI"
      "Coverage/patterns require full populate-coderef.py - not available from quick scan"
    ]
  },
  "output_quality_assessment": {
    "foundation_docs": {
      "README": "Not generated by coderef-context - no foundation doc generation tools",
      "ARCHITECTURE": "High quality - manually written, 625 lines, comprehensive system design with data flow diagrams",
      "API": "High quality - manually written, 625 lines, all 11 tools documented with schemas and examples",
      "SCHEMA": "Medium quality - generated, but lacks detailed type definitions for .coderef/ file formats",
      "COMPONENTS": "High quality - manually written, 661 lines, detailed handler catalog with code examples"
    },
    "user_docs": {
      "user_guide": "Not applicable - coderef-context is MCP server (no user-facing guide needed)",
      "my_guide": "Not applicable - coderef-context is MCP server",
      "quickref": "Not applicable - coderef-context is MCP server"
    },
    "standards_docs": {
      "ui_patterns": "Not applicable - Python MCP server (no UI)",
      "behavior_patterns": "Not applicable - handler pattern documented in COMPONENTS.md",
      "ux_patterns": "Not applicable - MCP server (no UX)",
      "testing_patterns": "Missing - no formal testing standards documented"
    },
    "overall_quality": "High (for API/ARCHITECTURE/COMPONENTS), Medium (for SCHEMA)",
    "key_issues": [
      "SCHEMA.md lacks detailed .coderef/ file format definitions (index.json, graph.json structure)",
      "No automated foundation doc generation - all docs manually written",
      "Cannot scan itself (Python code, not TypeScript) - index.json is empty",
      "No integration with coderef-docs for doc generation - docs server doesn't call coderef-context tools yet",
      "Coverage/patterns tools documented but require full scan (not quick scan) - may confuse users"
    ]
  },
  "integration_analysis": {
    "current_integration": "Minimal - coderef-context tools are available to other MCP servers via protocol, but no documented consumption patterns. coderef-workflow planning analyzer has integration code (call_coderef_tool), but unclear if actively used.",
    "missing_integration": "coderef-docs does NOT call coderef-context tools when generating foundation docs - this is the critical gap. Docs are template-driven, not code-driven.",
    "ideal_dependency_chain": "User runs populate-coderef.py (generates .coderef/) → coderef-docs calls coderef_scan/query/patterns → populates POWER templates → outputs foundation docs with real data",
    "coderef_tools_to_leverage": {
      "coderef_scan": "Extract real API endpoints (filter elements by type='function' + name pattern), schema entities (type='class'), UI components (type='component') for API.md, SCHEMA.md, COMPONENTS.md population",
      "coderef_query": "Trace dependencies for ARCHITECTURE.md (what-calls-me shows usage patterns), find component hierarchies (depends-on shows composition)",
      "coderef_patterns": "Auto-discover patterns for standards docs (ui-patterns from React patterns, api-patterns from endpoint patterns, testing-patterns from test file patterns)",
      "coderef_complexity": "Prioritize documentation for high-complexity elements (complexity > threshold goes in detailed docs first)",
      "coderef_coverage": "Highlight untested areas in foundation docs (show coverage gaps in SCHEMA.md, API.md)",
      "coderef_impact": "Identify critical components for ARCHITECTURE.md (high dependents = architectural keystone)"
    }
  },
  "improvement_suggestions": [
    {
      "category": "foundation",
      "priority": "high",
      "suggestion": "Enhance SCHEMA.md with complete .coderef/ file format definitions",
      "rationale": "Current SCHEMA.md is incomplete - doesn't document index.json, graph.json, context.json structures. Agents and users need this reference.",
      "implementation_approach": "Generate SCHEMA.md section for each .coderef/ file type with JSON schema, example data, field descriptions. Source from CodeRefReader class and actual .coderef/ samples.",
      "impact": "Clearer developer onboarding, easier debugging, reference documentation for coderef-docs integration"
    },
    {
      "category": "integration",
      "priority": "high",
      "suggestion": "Create coderef-context + coderef-docs integration examples and documentation",
      "rationale": "No documented pattern for how coderef-docs should call coderef-context tools. This is blocking consolidation.",
      "implementation_approach": "Add INTEGRATION.md with code examples: (1) coderef-docs calls coderef_scan, (2) filters elements by type, (3) populates POWER templates. Include error handling for missing .coderef/.",
      "impact": "Enables consolidation workflow, provides reference implementation, reduces integration friction"
    },
    {
      "category": "foundation",
      "priority": "medium",
      "suggestion": "Add auto-generated foundation doc tool: generate_foundation_docs",
      "rationale": "coderef-context has all data needed (API endpoints, schemas, components from index.json) but no doc generation capability. Currently docs are manually written.",
      "implementation_approach": "New MCP tool: generate_foundation_docs(project_path, docs=['readme','api','schema','components']). Reads .coderef/index.json, groups by type, populates templates, writes to coderef/foundation-docs/.",
      "impact": "Automated foundation doc updates, consistency across projects, leverages existing .coderef/ data"
    },
    {
      "category": "architecture",
      "priority": "medium",
      "suggestion": "Add incremental scan support via drift detection",
      "rationale": "Current workflow: full re-scan on every change (slow for large projects). Drift detection exists but not actionable.",
      "implementation_approach": "Enhance coderef_drift to return changed elements only. New tool: coderef_incremental_scan(project_path) - scans only drifted files, merges with index.json. Faster for incremental updates.",
      "impact": "10-100x faster refresh for active development, reduces latency for agents calling scan during implementation"
    },
    {
      "category": "standards",
      "priority": "medium",
      "suggestion": "Generate testing-patterns.md from .coderef/reports/patterns.json",
      "rationale": "patterns.json contains test patterns (describe/it structure, mocking patterns, etc.) but not surfaced in docs.",
      "implementation_approach": "New tool or doc section: read patterns.json, extract test-related patterns (files matching **/*.test.*, **/*.spec.*), format as markdown with usage examples.",
      "impact": "Discoverable testing standards, promotes consistency, auto-updates as patterns evolve"
    },
    {
      "category": "integration",
      "priority": "high",
      "suggestion": "Validate .coderef/ outputs against schemas in Papertrail",
      "rationale": "No validation of .coderef/ file formats - malformed data causes silent failures in consuming tools.",
      "implementation_approach": "Add JSON schemas for index.json, graph.json, context.json to Papertrail. New tool: validate_coderef_outputs(project_path) - calls Papertrail validation, reports errors.",
      "impact": "Early error detection, better debugging, prevents downstream failures in coderef-docs/workflow"
    },
    {
      "category": "foundation",
      "priority": "low",
      "suggestion": "Support Python code scanning (not just TypeScript)",
      "rationale": "coderef-context is Python but CLI only scans TypeScript - index.json empty for itself. Limits self-documentation.",
      "implementation_approach": "Add Python AST scanner (use ast module) or integrate with external tool (pylint, mypy). Populate index.json with Python elements (functions, classes, methods).",
      "impact": "Self-documenting server, complete coverage, enables Python project analysis"
    },
    {
      "category": "user",
      "priority": "low",
      "suggestion": "Add quickref.md for coderef-context tools (cheat sheet)",
      "rationale": "11 tools with different schemas - hard to remember. Quickref would help agents and users.",
      "implementation_approach": "Generate quickref.md with 1-line description + example call for each tool. Format: Tool | Purpose | Example Args. Auto-generate from tool schemas in server.py.",
      "impact": "Faster tool discovery, reduced cognitive load, easier onboarding"
    }
  ]
}
