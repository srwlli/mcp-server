{
  "META_DOCUMENTATION": {
    "feature_name": "agent-completion-workflow",
    "schema_version": "1.0.0",
    "version": "1.0.0",
    "status": "complete",
    "generated_by": "AI Assistant",
    "generated_at": "2025-12-20T10:52:00Z",
    "has_context": true,
    "has_analysis": true
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "purpose": "Documentation update to clarify agent vs orchestrator responsibilities in feature completion workflow",
      "foundation_docs_reviewed": [
        "ARCHITECTURE.md",
        "API.md",
        "COMPONENTS.md",
        "SCHEMA.md",
        "README.md",
        "USER-GUIDE.md"
      ],
      "coding_standards_available": false,
      "similar_features": [],
      "technical_stack": {
        "language": "Python",
        "framework": "Flask",
        "testing": "pytest",
        "documentation": "Markdown"
      },
      "key_risks_identified": [
        "Breaking existing orchestrator behavior if documentation changes are misunderstood",
        "Agents will continue old behavior if handoff templates are not updated",
        "Backward compatibility with existing workorders"
      ]
    },
    "1_executive_summary": {
      "feature_name": "Agent Completion Workflow Documentation",
      "workorder_id": "WO-AGENT-COMPLETION-WORKFLOW-001",
      "stub_id": "STUB-049",
      "primary_goal": "Document and enforce the workflow where agents complete ALL tasks (including /update-deliverables and /archive-feature) before marking work complete, and orchestrator ONLY verifies and updates tracking",
      "problem_statement": "Agent and orchestrator roles are not clearly defined for feature completion. Agents complete implementation work but leave deliverables unpopulated and features unarchived. Orchestrator steps in and does the archival work (incorrect role). This violates the orchestrator principle: identify, delegate, collect (not execute).",
      "target_users": [
        "AI agents executing workorders",
        "Orchestrator persona (Archer)",
        "Future developers using the workflow"
      ],
      "success_definition": "All agents understand and complete the full workflow (implement → update-deliverables → archive-feature → update communication.json) without orchestrator intervention in target project files",
      "estimated_complexity": "Low (documentation-only changes)",
      "estimated_duration": "1-2 hours"
    },
    "2_risk_assessment": {
      "complexity_rating": "Low",
      "technical_risks": [
        {
          "risk": "Agents will not see updated documentation if templates are not regenerated",
          "probability": "Medium",
          "impact": "Medium",
          "mitigation": "Update all handoff templates to include completion checklist prominently, regenerate existing templates"
        },
        {
          "risk": "Backward compatibility with existing in-flight workorders",
          "probability": "Low",
          "impact": "Low",
          "mitigation": "Changes are additive to documentation, existing behavior still works"
        }
      ],
      "dependencies": [
        "CLAUDE.md file in orchestrator project (C:\\Users\\willh\\Desktop\\assistant\\CLAUDE.md)",
        "Handoff template structure",
        "docs-mcp workflow documentation"
      ],
      "assumptions": [
        "Agents read and follow HANDOFF.md instructions",
        "Orchestrator follows CLAUDE.md workflow phases",
        "Communication.json schema supports 'archived' field"
      ]
    },
    "3_current_state_analysis": {
      "current_behavior": {
        "agent_stops_after": "Implementing plan tasks",
        "agent_does_not": [
          "Run /update-deliverables",
          "Run /archive-feature",
          "Update communication.json to 'complete'",
          "Update communication.json archived field"
        ],
        "orchestrator_currently_does": [
          "Archives features (wrong role)",
          "Touches files in target projects (wrong role)",
          "Populates DELIVERABLES.md metrics"
        ]
      },
      "example_failure": "WO-PERSONA-MANAGEMENT-001",
      "files_to_modify": [
        {
          "path": "C:\\Users\\willh\\Desktop\\assistant\\CLAUDE.md",
          "purpose": "Update Workorder Handoff Protocol section to clarify agent completion tasks and orchestrator verification-only role",
          "current_state": "Unclear about who archives features",
          "changes_needed": "Add Phase 3 completion tasks for agents, clarify Phase 4 verification for orchestrator"
        },
        {
          "path": "Handoff template (HANDOFF.md)",
          "purpose": "Add explicit completion checklist for agents",
          "current_state": "Missing completion steps",
          "changes_needed": "Add section with /update-deliverables, /archive-feature commands and validation checklist"
        }
      ],
      "files_to_create": [
        {
          "path": "docs-mcp/WORKFLOW-SEPARATION.md",
          "purpose": "Dedicated workflow documentation showing agent vs orchestrator responsibilities with diagrams"
        }
      ],
      "documentation_gaps": [
        "No explicit agent completion checklist",
        "No diagram showing workflow separation",
        "No validation criteria for agents before handoff"
      ]
    },
    "4_key_features": {
      "features": [
        {
          "id": "DOC-001",
          "name": "Orchestrator CLAUDE.md Updates",
          "description": "Update orchestrator's CLAUDE.md Workorder Handoff Protocol section to clarify Phase 3 (agent completion) and Phase 4 (orchestrator verification)",
          "priority": "Critical",
          "technical_approach": "Edit CLAUDE.md sections with explicit task lists and role boundaries",
          "acceptance_criteria": [
            "Phase 3 explicitly includes /update-deliverables and /archive-feature as agent responsibilities",
            "Phase 4 explicitly states orchestrator ONLY verifies, does not execute",
            "Completion checklist clearly visible in agent workflow section"
          ]
        },
        {
          "id": "DOC-002",
          "name": "Handoff Template Updates",
          "description": "Update HANDOFF.md template to include completion section with explicit commands and validation checklist",
          "priority": "Critical",
          "technical_approach": "Add new 'Completion Phase' section to HANDOFF.md template with step-by-step instructions",
          "acceptance_criteria": [
            "Template includes /update-deliverables command with explanation",
            "Template includes /archive-feature command with explanation",
            "Template includes communication.json update instructions",
            "Validation checklist present before marking work complete"
          ]
        },
        {
          "id": "DOC-003",
          "name": "Workflow Separation Documentation",
          "description": "Create dedicated WORKFLOW-SEPARATION.md document with diagrams showing agent vs orchestrator responsibilities",
          "priority": "High",
          "technical_approach": "Create new markdown doc with Mermaid diagrams illustrating workflow phases and role boundaries",
          "acceptance_criteria": [
            "Diagram shows agent phase: implement → update-deliverables → archive-feature",
            "Diagram shows orchestrator phase: verify → update tracking (no file touching)",
            "Clear separation principles documented",
            "Examples of correct and incorrect behavior"
          ]
        },
        {
          "id": "DOC-004",
          "name": "Validation Criteria Documentation",
          "description": "Document success indicators and workflow enforcement mechanisms",
          "priority": "Medium",
          "technical_approach": "Add validation criteria section to workflow docs showing what good completion looks like",
          "acceptance_criteria": [
            "Success indicators list present (all metrics populated in DELIVERABLES.md)",
            "Workflow enforcement mechanisms documented",
            "Benefits of correct workflow clearly explained"
          ]
        }
      ]
    },
    "5_task_id_system": {
      "workorder": {
        "id": "WO-AGENT-COMPLETION-WORKFLOW-001",
        "name": "Agent Completion Workflow",
        "feature_dir": "coderef/working/agent-completion-workflow"
      },
      "prefix_mapping": {
        "DOC": "Documentation updates",
        "REVIEW": "Review and validation"
      },
      "tasks": [
        {
          "id": "DOC-001",
          "workorder_id": "WO-AGENT-COMPLETION-WORKFLOW-001",
          "description": "Update orchestrator CLAUDE.md Workorder Handoff Protocol",
          "feature": "DOC-001",
          "files": ["C:\\Users\\willh\\Desktop\\assistant\\CLAUDE.md"],
          "estimated_effort": "30 min",
          "dependencies": [],
          "validation": "Phase 3 and Phase 4 clearly document agent completion and orchestrator verification"
        },
        {
          "id": "DOC-002",
          "workorder_id": "WO-AGENT-COMPLETION-WORKFLOW-001",
          "description": "Update HANDOFF.md template with completion checklist",
          "feature": "DOC-002",
          "files": ["HANDOFF.md template"],
          "estimated_effort": "20 min",
          "dependencies": [],
          "validation": "Completion section includes /update-deliverables, /archive-feature, and validation checklist"
        },
        {
          "id": "DOC-003",
          "workorder_id": "WO-AGENT-COMPLETION-WORKFLOW-001",
          "description": "Create WORKFLOW-SEPARATION.md with diagrams",
          "feature": "DOC-003",
          "files": ["docs-mcp/WORKFLOW-SEPARATION.md"],
          "estimated_effort": "45 min",
          "dependencies": [],
          "validation": "Mermaid diagrams clearly show agent vs orchestrator phases"
        },
        {
          "id": "DOC-004",
          "workorder_id": "WO-AGENT-COMPLETION-WORKFLOW-001",
          "description": "Document validation criteria and success indicators",
          "feature": "DOC-004",
          "files": ["docs-mcp/WORKFLOW-SEPARATION.md"],
          "estimated_effort": "15 min",
          "dependencies": ["DOC-003"],
          "validation": "Success indicators and enforcement mechanisms clearly documented"
        },
        {
          "id": "REVIEW-001",
          "workorder_id": "WO-AGENT-COMPLETION-WORKFLOW-001",
          "description": "Review all documentation updates for clarity and completeness",
          "feature": null,
          "files": [],
          "estimated_effort": "20 min",
          "dependencies": ["DOC-001", "DOC-002", "DOC-003", "DOC-004"],
          "validation": "All documentation is clear, unambiguous, and enforceable"
        }
      ]
    },
    "6_implementation_phases": {
      "phases": [
        {
          "phase": 1,
          "name": "Orchestrator Documentation Updates",
          "description": "Update orchestrator CLAUDE.md with clarified workflow phases",
          "tasks": ["DOC-001"],
          "deliverables": [
            "Updated CLAUDE.md with Phase 3 agent completion tasks",
            "Updated CLAUDE.md with Phase 4 orchestrator verification-only role"
          ],
          "validation": "Orchestrator understands to verify only, not execute"
        },
        {
          "phase": 2,
          "name": "Template and Workflow Documentation",
          "description": "Update HANDOFF.md template and create WORKFLOW-SEPARATION.md",
          "tasks": ["DOC-002", "DOC-003", "DOC-004"],
          "deliverables": [
            "Updated HANDOFF.md with completion checklist",
            "New WORKFLOW-SEPARATION.md with diagrams",
            "Documented validation criteria"
          ],
          "validation": "Agents have clear instructions for completion workflow"
        },
        {
          "phase": 3,
          "name": "Review and Validation",
          "description": "Review all updates for clarity and completeness",
          "tasks": ["REVIEW-001"],
          "deliverables": [
            "Reviewed documentation",
            "Confirmed no ambiguities"
          ],
          "validation": "All documentation is production-ready"
        }
      ]
    },
    "7_testing_strategy": {
      "test_approach": "Documentation validation through review and example scenarios",
      "unit_tests": "N/A (documentation-only changes)",
      "integration_tests": [
        {
          "scenario": "Agent follows updated HANDOFF.md template",
          "expected_outcome": "Agent runs /update-deliverables, /archive-feature, updates communication.json before completion"
        },
        {
          "scenario": "Orchestrator follows updated CLAUDE.md workflow",
          "expected_outcome": "Orchestrator verifies completion without touching target project files"
        },
        {
          "scenario": "Agent forgets to run /update-deliverables",
          "expected_outcome": "Orchestrator catches missing metrics during verification phase and rejects completion"
        },
        {
          "scenario": "Agent runs /archive-feature without /update-deliverables first",
          "expected_outcome": "Feature archived with placeholder metrics, orchestrator detects and flags issue"
        },
        {
          "scenario": "Multiple agents working on same feature",
          "expected_outcome": "Only assigned agent archives feature, orchestrator verifies single archive operation"
        },
        {
          "scenario": "Agent completes work but communication.json not updated",
          "expected_outcome": "Orchestrator detects missing status update and requests agent to complete workflow"
        },
        {
          "scenario": "Backward compatibility - existing workorder in progress",
          "expected_outcome": "Old workflow continues to function, new workflow optional until adoption"
        },
        {
          "scenario": "Agent misinterprets documentation and archives too early",
          "expected_outcome": "Orchestrator detects incomplete implementation via plan.json task status"
        }
      ],
      "manual_testing": [
        "Walk through agent workflow with updated documentation",
        "Walk through orchestrator verification with updated documentation",
        "Validate no ambiguous instructions remain",
        "Test edge case: Agent skips completion steps",
        "Test edge case: Orchestrator attempts to execute instead of verify",
        "Test edge case: Partial completion with some steps missing"
      ],
      "test_coverage_target": "100% documentation coverage (all workflow phases documented)"
    },
    "8_success_criteria": {
      "functional_requirements": [
        {
          "requirement": "Agent completion checklist is clear and complete",
          "measurement": "Checklist includes /update-deliverables, /archive-feature, communication.json update",
          "target": "3/3 commands documented"
        },
        {
          "requirement": "Orchestrator role is clearly verification-only",
          "measurement": "CLAUDE.md Phase 4 explicitly states 'ONLY verifies, does not execute'",
          "target": "Clear role boundary statement present"
        },
        {
          "requirement": "Workflow separation is documented with diagrams",
          "measurement": "WORKFLOW-SEPARATION.md includes Mermaid diagrams showing agent and orchestrator phases",
          "target": "Diagrams present and accurate"
        }
      ],
      "non_functional_requirements": [
        {
          "requirement": "Documentation is unambiguous",
          "measurement": "No conflicting or vague instructions",
          "target": "Zero ambiguities found in review"
        },
        {
          "requirement": "Backward compatibility maintained",
          "measurement": "Existing workorders continue to work",
          "target": "No breaking changes introduced"
        }
      ],
      "acceptance_checklist": [
        "✓ Orchestrator CLAUDE.md updated with Phase 3 and Phase 4 clarifications",
        "✓ HANDOFF.md template includes completion checklist",
        "✓ WORKFLOW-SEPARATION.md created with diagrams",
        "✓ Validation criteria documented",
        "✓ All documentation reviewed for clarity",
        "✓ No ambiguous instructions remain"
      ]
    },
    "9_implementation_checklist": {
      "phase_1_orchestrator_documentation": {
        "tasks": [
          "☐ Open C:\\Users\\willh\\Desktop\\assistant\\CLAUDE.md",
          "☐ Locate 'Workorder Handoff Protocol' section",
          "☐ Update Phase 3 (Implementation) to include agent completion tasks",
          "☐ Add explicit completion checklist: /update-deliverables → /archive-feature → update communication.json",
          "☐ Update Phase 4 (Verification) to state orchestrator ONLY verifies, does not execute",
          "☐ Add note: 'Orchestrator never touches files in target projects'",
          "☐ Save and validate changes"
        ],
        "validation": "Phase 3 and Phase 4 clearly document agent completion and orchestrator verification"
      },
      "phase_2_template_and_workflow_docs": {
        "tasks": [
          "☐ Open HANDOFF.md template (locate current template file)",
          "☐ Add 'Completion Phase' section",
          "☐ Document /update-deliverables command with explanation",
          "☐ Document /archive-feature command with explanation",
          "☐ Add communication.json update instructions",
          "☐ Add validation checklist before marking complete",
          "☐ Create docs-mcp/WORKFLOW-SEPARATION.md",
          "☐ Add introduction explaining workflow separation",
          "☐ Create Mermaid diagram for agent workflow phase",
          "☐ Create Mermaid diagram for orchestrator verification phase",
          "☐ Add 'Correct vs Incorrect Behavior' examples",
          "☐ Document validation criteria and success indicators",
          "☐ Save all changes"
        ],
        "validation": "HANDOFF.md includes completion checklist, WORKFLOW-SEPARATION.md includes diagrams and validation criteria"
      },
      "phase_3_review_and_validation": {
        "tasks": [
          "☐ Review orchestrator CLAUDE.md changes",
          "☐ Review HANDOFF.md template changes",
          "☐ Review WORKFLOW-SEPARATION.md content",
          "☐ Verify no ambiguous instructions",
          "☐ Verify backward compatibility maintained",
          "☐ Verify all requirements from context.json addressed",
          "☐ Mark workorder complete"
        ],
        "validation": "All documentation is clear, complete, and production-ready"
      }
    }
  }
}
