{
  "META_DOCUMENTATION": {
    "workorder_id": "WO-COMPONENT-HISTORY-001",
    "feature_name": "component-history-system",
    "status": "PLANNED",
    "created": "2025-12-15",
    "description": "Bidirectional tracking between workorders and components for agent context"
  },

  "1_executive_summary": {
    "goal": "Create bidirectional index linking workorders to components they create/modify",
    "problem": "When agents revisit code, no history of why components were created or which workorders modified them",
    "solution": "Auto-extract component changes during archive and maintain reverse index",
    "key_benefit": "Instant context when revisiting code - see 'Created in WO-X, modified in WO-Y'"
  },

  "2_data_structures": {
    "component_history_json": {
      "location": "coderef/component-history.json",
      "purpose": "Reverse index - lookup component to see workorder history",
      "schema": {
        "version": "1.0.0",
        "last_updated": "ISO timestamp",
        "components": {
          "<component_name>": {
            "file": "path/to/file.py",
            "line": 245,
            "type": "function|class|module",
            "created_by": "WO-XXX-001",
            "modified_by": ["WO-XXX-002", "WO-XXX-003"],
            "last_workorder": "WO-XXX-003",
            "last_modified": "YYYY-MM-DD"
          }
        },
        "stats": {
          "total_components": 0,
          "total_workorders": 0,
          "most_modified": ""
        }
      }
    },
    "enhanced_archive_index": {
      "location": "coderef/archived/index.json",
      "enhancement": "Add components field to each archived feature",
      "new_fields": {
        "components": {
          "created": ["list of created components"],
          "modified": ["list of modified components"],
          "deleted": ["list of deleted components"]
        },
        "files_changed": 0,
        "loc_added": 0,
        "loc_removed": 0
      }
    },
    "plan_section_10": {
      "location": "templates/power/plan-template.json",
      "new_section": "10_component_tracking",
      "fields": {
        "components_to_create": [{"name": "", "file": "", "purpose": ""}],
        "components_to_modify": [{"name": "", "file": "", "changes": ""}],
        "components_to_delete": [{"name": "", "file": "", "reason": ""}]
      }
    }
  },

  "3_mcp_tools": {
    "get_component_history": {
      "description": "Lookup workorder history for a component",
      "input": {"project_path": "string", "component_name": "string"},
      "output": {
        "component": "name",
        "file": "path",
        "created_by": "WO-XXX",
        "modified_by": ["list"],
        "workorder_count": 0,
        "plan_links": ["paths to archived plans"]
      }
    },
    "get_workorder_components": {
      "description": "Lookup what components a workorder touched",
      "input": {"project_path": "string", "workorder_id": "string"},
      "output": {
        "workorder_id": "WO-XXX",
        "feature_name": "name",
        "components_created": ["list"],
        "components_modified": ["list"],
        "components_deleted": ["list"],
        "plan_path": "path"
      }
    }
  },

  "4_implementation_phases": [
    {
      "phase": 1,
      "name": "Data Structures",
      "tasks": [
        "STRUCT-001: Create coderef/component-history.json with empty schema",
        "STRUCT-002: Add components field to archived/index.json schema",
        "STRUCT-003: Add section 10 to plan-template.json"
      ]
    },
    {
      "phase": 2,
      "name": "Archive Integration",
      "tasks": [
        "ARCHIVE-001: Enhance handle_archive_feature to parse plan.json section 10",
        "ARCHIVE-002: Add git diff parsing for component detection",
        "ARCHIVE-003: Update component-history.json on archive"
      ]
    },
    {
      "phase": 3,
      "name": "Query Tools",
      "tasks": [
        "TOOL-001: Implement handle_get_component_history",
        "TOOL-002: Implement handle_get_workorder_components",
        "TOOL-003: Register tools in server.py"
      ]
    },
    {
      "phase": 4,
      "name": "Agent Integration",
      "tasks": [
        "AGENT-001: Surface history in /start-feature workflow",
        "AGENT-002: Add context hints for high-traffic components",
        "AGENT-003: Link to prior plans in responses"
      ]
    }
  ],

  "5_key_files": {
    "to_create": [
      "coderef/component-history.json"
    ],
    "to_modify": [
      "tool_handlers.py - add 2 new handlers",
      "server.py - register 2 new tools",
      "templates/power/plan-template.json - add section 10",
      "coderef/archived/index.json - enhance schema"
    ]
  },

  "6_success_criteria": [
    "get_component_history('handle_auth') returns full workorder lineage",
    "get_workorder_components('WO-AUTH-001') returns all touched components",
    "Archiving a feature auto-updates component-history.json",
    "Agent can see 'Created in WO-X, modified in WO-Y' for any component"
  ]
}
