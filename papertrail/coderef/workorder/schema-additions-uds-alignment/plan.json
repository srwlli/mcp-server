{
  "META_DOCUMENTATION": {
    "feature_name": "schema-additions-uds-alignment",
    "schema_version": "1.1.0",
    "version": "1.0.0",
    "status": "draft",
    "generated_by": "papertrail-agent",
    "generated_at": "2026-01-10",
    "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001"
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "project_type": "enhancement",
      "tech_stack": {
        "language": "Python 3.10+",
        "framework": "MCP Server",
        "validation": "JSON Schema Draft-07",
        "dependencies": ["jsonschema", "pydantic"]
      },
      "key_dependencies": [
        "papertrail/validators/base.py (BaseUDSValidator)",
        "papertrail/validators/factory.py (ValidatorFactory)",
        "papertrail/schemas/documentation/ (existing schemas)"
      ],
      "project_structure": {
        "schemas": "papertrail/schemas/workflow/ (NEW - create this directory)",
        "validators": "papertrail/validators/ (existing)",
        "tests": "papertrail/tests/ (existing)"
      }
    },
    "1_executive_summary": {
      "feature_name": "Schema Additions for UDS Alignment",
      "description": "Create 2 new JSON schemas (analysis.json, execution-log.json) and corresponding validators to enable coderef-workflow to achieve 100% validation coverage. Addresses missing schemas identified in WO-PAPERTRAIL-UDS-ALIGNMENT-002 Phase 2 gap analysis.",
      "goal": "Enable validation of workflow-critical artifacts (project analysis data and task execution logs) to prevent data corruption and ensure workflow reliability",
      "estimated_complexity": "medium",
      "estimated_tasks": 15,
      "key_deliverables": [
        "analysis-json-schema.json (project analysis structure)",
        "execution-log-json-schema.json (task execution tracking)",
        "AnalysisValidator (validates project analysis files)",
        "ExecutionLogValidator (validates execution logs with cross-validation)",
        "ValidatorFactory pattern updates (auto-detect new file types)",
        "Updated UDS documentation"
      ]
    },
    "2_risk_assessment": {
      "technical_risks": [
        {
          "risk": "Schema structure mismatch - actual coderef-workflow files may differ from assumptions",
          "severity": "high",
          "mitigation": "CRITICAL: Obtain sample analysis.json and execution-log.json files from coderef-workflow BEFORE creating schemas. Validate schema against real data."
        },
        {
          "risk": "Cross-validation complexity - linking execution-log task_id to plan.json tasks may have edge cases",
          "severity": "medium",
          "mitigation": "Implement graceful fallback if plan.json not found. Log warnings instead of errors for missing cross-references."
        }
      ],
      "scope_risks": [
        {
          "risk": "Scope creep - temptation to add features-inventory.json schema and INFO severity level",
          "severity": "low",
          "mitigation": "Strictly adhere to P1+P2 priorities only. Defer P3 improvements to future workorder."
        }
      ],
      "dependency_risks": [
        {
          "risk": "Blocker - coderef-workflow must provide sample files before schema design can proceed",
          "severity": "high",
          "mitigation": "Coordinate on Week 1 Day 1. If samples not provided, cannot complete P1 (execution-log) on time."
        }
      ]
    },
    "3_current_state_analysis": {
      "existing_files": [
        "papertrail/schemas/documentation/base-frontmatter-schema.json",
        "papertrail/schemas/documentation/foundation-doc-frontmatter-schema.json",
        "papertrail/schemas/documentation/workorder-doc-frontmatter-schema.json",
        "papertrail/schemas/planning/plan.schema.json",
        "papertrail/validators/base.py",
        "papertrail/validators/factory.py",
        "papertrail/validators/foundation.py",
        "papertrail/validators/workorder.py",
        "papertrail/validators/plan.py"
      ],
      "files_to_create": [
        {
          "path": "papertrail/schemas/workflow/",
          "purpose": "New directory for workflow-specific JSON schemas (not markdown frontmatter)"
        },
        {
          "path": "papertrail/schemas/workflow/analysis-json-schema.json",
          "purpose": "Validates project analysis files generated by coderef-workflow analyze_project_for_planning"
        },
        {
          "path": "papertrail/schemas/workflow/execution-log-json-schema.json",
          "purpose": "Validates task execution logs with cross-validation to plan.json"
        },
        {
          "path": "papertrail/validators/analysis.py",
          "purpose": "AnalysisValidator class for analysis.json validation"
        },
        {
          "path": "papertrail/validators/execution_log.py",
          "purpose": "ExecutionLogValidator class with cross-validation logic"
        }
      ],
      "files_to_modify": [
        {
          "path": "papertrail/validators/factory.py",
          "changes": "Add 2 new path patterns for analysis.json and execution-log.json auto-detection"
        },
        {
          "path": "docs/UDS-IMPLEMENTATION-GUIDE.md",
          "changes": "Document new validators (optional - can defer to Phase 4)"
        }
      ],
      "dependencies_to_add": []
    },
    "4_key_features": {
      "features": [
        {
          "id": "F1",
          "name": "analysis.json Schema & Validator",
          "description": "Create JSON schema for project analysis files with required fields: project_path, analyzed_at, project_type, tech_stack, file_inventory, patterns_detected. Create AnalysisValidator to enforce structure.",
          "priority": "high",
          "tasks": ["SCHEMA-001", "VALIDATOR-001", "FACTORY-001", "TEST-001"]
        },
        {
          "id": "F2",
          "name": "execution-log.json Schema & Validator",
          "description": "Create JSON schema for execution logs with workorder_id, feature_id, started_at, tasks array, status. Create ExecutionLogValidator with cross-validation to verify task_id references exist in plan.json.",
          "priority": "critical",
          "tasks": ["SCHEMA-002", "VALIDATOR-002", "XVAL-001", "FACTORY-002", "TEST-002"]
        },
        {
          "id": "F3",
          "name": "ValidatorFactory Integration",
          "description": "Update ValidatorFactory path patterns to auto-detect new file types: r'.*/coderef/workorder/.*/analysis\\.json$' → 'analysis' and r'.*/coderef/workorder/.*/execution-log\\.json$' → 'execution_log'",
          "priority": "high",
          "tasks": ["FACTORY-003", "TEST-003"]
        }
      ]
    },
    "5_task_id_system": {
      "workorder": {
        "id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
        "name": "Schema Additions for UDS Alignment",
        "feature_dir": "coderef/workorder/schema-additions-uds-alignment"
      },
      "tasks": [
        {
          "id": "PREP-001",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Request sample analysis.json files (2-3 examples) from coderef-workflow agent",
          "type": "setup",
          "files": [],
          "status": "pending",
          "verify_step": "Confirm receipt of sample files via communication"
        },
        {
          "id": "PREP-002",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Request sample execution-log.json files (2-3 examples) from coderef-workflow agent",
          "type": "setup",
          "files": [],
          "status": "pending",
          "verify_step": "Confirm receipt of sample files via communication"
        },
        {
          "id": "PREP-003",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Create papertrail/schemas/workflow/ directory for workflow-specific schemas",
          "type": "setup",
          "files": ["papertrail/schemas/workflow/"],
          "estimated_loc": 0,
          "status": "pending",
          "verify_step": "Directory exists: ls papertrail/schemas/workflow/"
        },
        {
          "id": "SCHEMA-001",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Create analysis-json-schema.json based on sample files from coderef-workflow",
          "type": "feature",
          "files": ["papertrail/schemas/workflow/analysis-json-schema.json"],
          "estimated_loc": 80,
          "dependencies": ["PREP-001", "PREP-003"],
          "status": "pending",
          "verify_step": "Schema validates sample analysis.json files without errors"
        },
        {
          "id": "SCHEMA-002",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Create execution-log-json-schema.json based on sample files from coderef-workflow",
          "type": "feature",
          "files": ["papertrail/schemas/workflow/execution-log-json-schema.json"],
          "estimated_loc": 100,
          "dependencies": ["PREP-002", "PREP-003"],
          "status": "pending",
          "verify_step": "Schema validates sample execution-log.json files without errors"
        },
        {
          "id": "VALIDATOR-001",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Create AnalysisValidator class in papertrail/validators/analysis.py",
          "type": "feature",
          "files": ["papertrail/validators/analysis.py"],
          "estimated_loc": 60,
          "dependencies": ["SCHEMA-001"],
          "status": "pending",
          "verify_step": "Validator loads schema and validates sample files with score >= 90"
        },
        {
          "id": "VALIDATOR-002",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Create ExecutionLogValidator class in papertrail/validators/execution_log.py",
          "type": "feature",
          "files": ["papertrail/validators/execution_log.py"],
          "estimated_loc": 80,
          "dependencies": ["SCHEMA-002"],
          "status": "pending",
          "verify_step": "Validator loads schema and validates sample files with score >= 90"
        },
        {
          "id": "XVAL-001",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Add cross-validation logic to ExecutionLogValidator: verify task_id references exist in plan.json",
          "type": "feature",
          "files": ["papertrail/validators/execution_log.py"],
          "estimated_loc": 30,
          "dependencies": ["VALIDATOR-002"],
          "status": "pending",
          "verify_step": "Cross-validation detects invalid task_id and adds MAJOR error"
        },
        {
          "id": "FACTORY-001",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Update ValidatorFactory: Add import for AnalysisValidator",
          "type": "feature",
          "files": ["papertrail/validators/factory.py"],
          "estimated_loc": 5,
          "dependencies": ["VALIDATOR-001"],
          "status": "pending",
          "verify_step": "Import statement added and no import errors"
        },
        {
          "id": "FACTORY-002",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Update ValidatorFactory: Add import for ExecutionLogValidator",
          "type": "feature",
          "files": ["papertrail/validators/factory.py"],
          "estimated_loc": 5,
          "dependencies": ["VALIDATOR-002"],
          "status": "pending",
          "verify_step": "Import statement added and no import errors"
        },
        {
          "id": "FACTORY-003",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Update ValidatorFactory PATH_PATTERNS: Add analysis.json and execution-log.json detection patterns",
          "type": "feature",
          "files": ["papertrail/validators/factory.py"],
          "estimated_loc": 10,
          "dependencies": ["FACTORY-001", "FACTORY-002"],
          "status": "pending",
          "verify_step": "ValidatorFactory.get_validator() returns correct validator for both file types"
        },
        {
          "id": "TEST-001",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Create unit tests for AnalysisValidator (valid/invalid cases)",
          "type": "test",
          "files": ["papertrail/tests/test_validators.py"],
          "estimated_loc": 40,
          "dependencies": ["VALIDATOR-001"],
          "status": "pending",
          "verify_step": "Run pytest papertrail/tests/test_validators.py::TestAnalysisValidator"
        },
        {
          "id": "TEST-002",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Create unit tests for ExecutionLogValidator (valid/invalid/cross-validation cases)",
          "type": "test",
          "files": ["papertrail/tests/test_validators.py"],
          "estimated_loc": 60,
          "dependencies": ["VALIDATOR-002", "XVAL-001"],
          "status": "pending",
          "verify_step": "Run pytest papertrail/tests/test_validators.py::TestExecutionLogValidator"
        },
        {
          "id": "TEST-003",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Create integration tests for ValidatorFactory auto-detection of new validators",
          "type": "test",
          "files": ["papertrail/tests/test_factory.py"],
          "estimated_loc": 30,
          "dependencies": ["FACTORY-003"],
          "status": "pending",
          "verify_step": "Run pytest papertrail/tests/test_factory.py::test_analysis_detection"
        },
        {
          "id": "DOC-001",
          "workorder_id": "WO-PAPERTRAIL-SCHEMA-ADDITIONS-001",
          "description": "Update UDS-IMPLEMENTATION-GUIDE.md with new validator examples (OPTIONAL - defer if time-constrained)",
          "type": "docs",
          "files": ["docs/UDS-IMPLEMENTATION-GUIDE.md"],
          "estimated_loc": 40,
          "dependencies": ["VALIDATOR-001", "VALIDATOR-002"],
          "status": "pending",
          "verify_step": "Documentation includes AnalysisValidator and ExecutionLogValidator examples"
        }
      ]
    },
    "6_implementation_phases": {
      "phases": [
        {
          "phase": 1,
          "name": "Preparation & Coordination",
          "description": "Coordinate with coderef-workflow to obtain sample files and create directory structure",
          "tasks": ["PREP-001", "PREP-002", "PREP-003"],
          "deliverables": [
            "Sample analysis.json files received",
            "Sample execution-log.json files received",
            "papertrail/schemas/workflow/ directory created"
          ]
        },
        {
          "phase": 2,
          "name": "execution-log.json (P1 - Week 1)",
          "description": "Create execution log schema and validator with cross-validation (CRITICAL for workflow resumption)",
          "tasks": ["SCHEMA-002", "VALIDATOR-002", "XVAL-001", "FACTORY-002", "TEST-002"],
          "deliverables": [
            "execution-log-json-schema.json",
            "ExecutionLogValidator with cross-validation",
            "ValidatorFactory imports ExecutionLogValidator",
            "Unit tests passing"
          ]
        },
        {
          "phase": 3,
          "name": "analysis.json (P2 - Week 2-3)",
          "description": "Create project analysis schema and validator",
          "tasks": ["SCHEMA-001", "VALIDATOR-001", "FACTORY-001", "TEST-001"],
          "deliverables": [
            "analysis-json-schema.json",
            "AnalysisValidator",
            "ValidatorFactory imports AnalysisValidator",
            "Unit tests passing"
          ]
        },
        {
          "phase": 4,
          "name": "Integration & Testing",
          "description": "Complete ValidatorFactory integration and end-to-end testing",
          "tasks": ["FACTORY-003", "TEST-003"],
          "deliverables": [
            "ValidatorFactory path patterns updated",
            "Integration tests passing",
            "Auto-detection functional for both file types"
          ]
        },
        {
          "phase": 5,
          "name": "Documentation (Optional)",
          "description": "Update implementation guide with new validators (defer if time-constrained)",
          "tasks": ["DOC-001"],
          "deliverables": [
            "UDS-IMPLEMENTATION-GUIDE.md updated with examples"
          ]
        }
      ]
    },
    "7_testing_strategy": {
      "unit_tests": [
        {
          "target": "AnalysisValidator",
          "tests": [
            "test_valid_analysis_json - Valid analysis.json scores >= 90",
            "test_invalid_analysis_missing_required - Missing project_path field fails",
            "test_invalid_analysis_wrong_type - Invalid project_type enum fails",
            "test_schema_inheritance - Schema validation works correctly"
          ]
        },
        {
          "target": "ExecutionLogValidator",
          "tests": [
            "test_valid_execution_log - Valid execution-log.json scores >= 90",
            "test_invalid_missing_workorder_id - Missing workorder_id fails",
            "test_invalid_task_status_enum - Invalid status enum fails",
            "test_cross_validation_valid - task_id exists in plan.json passes",
            "test_cross_validation_invalid - task_id not in plan.json adds MAJOR error",
            "test_cross_validation_missing_plan - Graceful fallback if plan.json missing"
          ]
        },
        {
          "target": "ValidatorFactory",
          "tests": [
            "test_analysis_json_detection - Detects analysis.json and returns AnalysisValidator",
            "test_execution_log_detection - Detects execution-log.json and returns ExecutionLogValidator",
            "test_path_pattern_matching - Patterns match correct file paths"
          ]
        }
      ],
      "integration_tests": [
        {
          "target": "ValidatorFactory auto-detection",
          "tests": [
            "test_end_to_end_analysis_validation - Load analysis.json via factory, validate, check score",
            "test_end_to_end_execution_log_validation - Load execution-log.json via factory, validate with cross-validation"
          ]
        }
      ],
      "e2e_tests": [],
      "manual_testing": [
        "Validate sample analysis.json files from coderef-workflow",
        "Validate sample execution-log.json files from coderef-workflow",
        "Verify ValidatorFactory detects file types correctly in real workorder directories"
      ]
    },
    "8_success_criteria": {
      "functional": [
        "2 new schemas created and validate sample files without errors",
        "2 new validators functional with score >= 90 threshold for valid files",
        "ValidatorFactory detects new file types automatically",
        "Cross-validation correctly verifies task_id references in plan.json",
        "All unit tests pass (6+ tests)",
        "All integration tests pass (2+ tests)"
      ],
      "performance": [
        "Schema validation completes in < 100ms for typical files",
        "Cross-validation lookup in plan.json completes in < 50ms"
      ],
      "quality": [
        "Test coverage >= 90% for new validators",
        "No breaking changes to existing validators",
        "Documentation updated (if time permits)"
      ]
    },
    "9_implementation_checklist": {
      "phase_1_preparation": [
        "Request sample files from coderef-workflow",
        "Create papertrail/schemas/workflow/ directory",
        "Receive and review sample analysis.json files",
        "Receive and review sample execution-log.json files"
      ],
      "phase_2_execution_log": [
        "Design execution-log-json-schema.json structure",
        "Create schema file with all required fields",
        "Create ExecutionLogValidator class extending BaseUDSValidator",
        "Implement cross-validation logic (task_id → plan.json)",
        "Add ExecutionLogValidator import to ValidatorFactory",
        "Write unit tests for ExecutionLogValidator",
        "Run tests and verify score >= 90 for valid files"
      ],
      "phase_3_analysis": [
        "Design analysis-json-schema.json structure",
        "Create schema file with all required fields",
        "Create AnalysisValidator class extending BaseUDSValidator",
        "Add AnalysisValidator import to ValidatorFactory",
        "Write unit tests for AnalysisValidator",
        "Run tests and verify score >= 90 for valid files"
      ],
      "phase_4_integration": [
        "Add path patterns to ValidatorFactory PATH_PATTERNS dict",
        "Write integration tests for auto-detection",
        "Run full test suite and verify all tests pass",
        "Manually test with sample files from coderef-workflow"
      ],
      "phase_5_documentation": [
        "Update UDS-IMPLEMENTATION-GUIDE.md with new validator examples (OPTIONAL)"
      ]
    }
  }
}
