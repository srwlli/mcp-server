{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://papertrail/schemas/workflow/analysis-json-schema.json",
  "title": "Project Analysis JSON Schema",
  "description": "Schema for project analysis files generated by coderef-workflow analyze_project_for_planning. Contains structured analysis data for planning decisions.",
  "type": "object",
  "required": ["foundation_docs", "inventory_data", "technology_stack", "project_structure", "_uds"],
  "properties": {
    "foundation_docs": {
      "type": "object",
      "description": "Foundation documentation inventory",
      "required": ["available", "missing"],
      "properties": {
        "available": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of existing foundation docs"
        },
        "missing": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of missing recommended docs"
        }
      }
    },
    "foundation_doc_content": {
      "type": "object",
      "description": "Content summaries of foundation docs",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "location": {"type": "string"},
          "preview": {"type": "string"},
          "headers": {
            "type": "array",
            "items": {"type": "string"}
          },
          "size": {"type": "integer"}
        }
      }
    },
    "inventory_data": {
      "type": "object",
      "description": "Code inventory from .coderef/index.json",
      "required": ["source", "total_elements", "by_type", "files"],
      "properties": {
        "source": {
          "type": "string",
          "enum": ["coderef_index", "manual_scan", "fallback"],
          "description": "Source of inventory data"
        },
        "total_elements": {
          "type": "integer",
          "minimum": 0,
          "description": "Total code elements discovered"
        },
        "by_type": {
          "type": "object",
          "description": "Element counts by type",
          "properties": {
            "function": {"type": "integer", "minimum": 0},
            "method": {"type": "integer", "minimum": 0},
            "class": {"type": "integer", "minimum": 0},
            "component": {"type": "integer", "minimum": 0}
          }
        },
        "files": {
          "type": "integer",
          "minimum": 0,
          "description": "Total files scanned"
        },
        "utilization": {
          "type": "string",
          "description": "Utilization details or data source"
        }
      }
    },
    "coding_standards": {
      "type": "object",
      "description": "Coding standards documentation",
      "properties": {
        "available": {
          "type": "array",
          "items": {"type": "string"}
        },
        "missing": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "reference_components": {
      "type": "object",
      "description": "Reference components for pattern matching",
      "properties": {
        "primary": {
          "type": ["string", "null"],
          "description": "Primary reference component"
        },
        "secondary": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Secondary reference components"
        },
        "total_found": {
          "type": "integer",
          "minimum": 0
        },
        "note": {
          "type": "string",
          "description": "Additional notes about reference components"
        }
      }
    },
    "key_patterns_identified": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Identified code patterns"
    },
    "technology_stack": {
      "type": "object",
      "description": "Detected technology stack",
      "required": ["language"],
      "properties": {
        "language": {"type": "string"},
        "framework": {"type": "string"},
        "database": {"type": "string"},
        "testing": {"type": "string"},
        "build": {"type": "string"}
      }
    },
    "project_structure": {
      "type": "object",
      "description": "Project directory structure analysis",
      "required": ["main_directories", "file_counts"],
      "properties": {
        "main_directories": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Top-level directories"
        },
        "file_counts": {
          "type": "object",
          "description": "File counts per directory",
          "additionalProperties": {"type": "integer"}
        },
        "organization_pattern": {
          "type": "string",
          "description": "Detected organization pattern (e.g., 'feature-based', 'layer-based')"
        }
      }
    },
    "gaps_and_risks": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Identified gaps and risks"
    },
    "_uds": {
      "type": "object",
      "description": "Universal Documentation Standards metadata",
      "required": ["generated_by", "document_type", "feature_id", "last_updated", "ai_assistance", "status"],
      "properties": {
        "generated_by": {
          "type": "string",
          "pattern": "^coderef-workflow v[0-9]+\\.[0-9]+\\.[0-9]+$",
          "description": "Generator identification with version"
        },
        "document_type": {
          "type": "string",
          "const": "Project Analysis",
          "description": "Document type (always 'Project Analysis' for analysis.json)"
        },
        "workorder_id": {
          "type": "string",
          "pattern": "^WO-[A-Z0-9]+-[A-Z0-9]+-\\d{3}$",
          "description": "Associated workorder ID"
        },
        "feature_id": {
          "type": "string",
          "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
          "description": "Feature ID in kebab-case"
        },
        "last_updated": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "Last update date (YYYY-MM-DD)"
        },
        "ai_assistance": {
          "type": "boolean",
          "description": "Whether AI was used in generation"
        },
        "status": {
          "type": "string",
          "enum": ["DRAFT", "REVIEW", "FINAL", "DEPRECATED"],
          "description": "Document status"
        },
        "next_review": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "Next review date (YYYY-MM-DD)"
        }
      }
    }
  }
}
