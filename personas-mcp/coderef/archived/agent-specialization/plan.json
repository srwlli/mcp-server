{
  "META_DOCUMENTATION": {
    "feature_name": "agent-specialization",
    "version": "1.0.0",
    "status": "complete",
    "generated_by": "Lloyd (AI Coordinator)",
    "generated_at": "2025-10-23",
    "has_context": true,
    "has_analysis": true,
    "workorder_id": "WO-AGENT-SPECIALIZATION-001",
    "estimated_complexity": "medium-high",
    "estimated_duration": "3-4 days"
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "foundation_docs_available": [
        "README.md - Project overview",
        "CLAUDE.md - AI context documentation",
        "my-guide.md - Quick reference"
      ],
      "foundation_docs_missing": [
        "ARCHITECTURE.md - System design",
        "API.md - API reference"
      ],
      "coding_standards_available": [],
      "coding_standards_missing": [
        "Must infer from existing persona JSON files"
      ],
      "reference_components": [
        "personas/base/agent-2.json - Current generalist persona (template)",
        "personas/base/agent-3.json - Current generalist persona (template)",
        "personas/base/agent-4.json - Current generalist persona (template)",
        "personas/base/lloyd-expert.json - Coordinator persona (assignment logic reference)",
        "personas/base/agent-generalist.json - Original generalist template"
      ],
      "technology_stack": {
        "language": "Python 3.11+",
        "framework": "MCP (Model Context Protocol)",
        "storage": "JSON files (personas/base/)",
        "testing": "Manual validation + usage testing"
      },
      "project_structure": {
        "persona_definitions": "personas/base/ (agent-2.json, agent-3.json, agent-4.json, lloyd-expert.json)",
        "documentation": "CLAUDE.md, my-guide.md, README.md",
        "slash_commands": ".claude/commands/ (agent2.md, agent3.md, agent4.md)",
        "server": "server.py (MCP server implementation)"
      },
      "key_patterns_identified": [
        "Persona JSON structure: name, parent, version, description, system_prompt, expertise, preferred_tools, use_cases, behavior",
        "System prompts are comprehensive (1000+ lines for agentic use)",
        "Expertise array defines domain knowledge areas",
        "Behavior object defines communication_style, problem_solving, tool_usage",
        "Use cases provide concrete examples of when to use persona"
      ],
      "gaps_and_risks": [
        "No existing specialization precedent - designing from scratch",
        "Lloyd's assignment logic is currently implicit (not codified)",
        "Communication.json schema not formally defined",
        "Risk of agents rejecting too many tasks if specialization is too strict",
        "Backward compatibility with existing generalist communication.json files"
      ]
    },
    "1_executive_summary": {
      "feature_name": "Agent Specialization System",
      "description": "Transform generalist execution agents (Agent 2, 3, 4) into specialized domain experts with strict boundaries. Agent 2 becomes Frontend Specialist (UI, React, styling), Agent 3 becomes Backend Specialist (API, database, server logic), and Agent 4 becomes Testing Specialist (test coverage, QA, validation). Enhance Lloyd's coordination with intelligent task-to-agent matching and add specialization validation to the assignment workflow.",
      "business_value": "Improved task quality through domain expertise, optimized workflows by matching agent strengths to task types, and effective parallel work where specialists can work on different aspects of features simultaneously without conflicts.",
      "user_story": "As Lloyd (coordinator), I want to assign tasks to specialized agents so that frontend work goes to the UI expert, backend work goes to the API expert, and testing goes to the QA expert, ensuring high-quality results and efficient parallel execution.",
      "target_audience": "Multi-agent workflows using Lloyd coordinator with Agent 2, 3, 4 execution",
      "success_metrics": [
        "Each specialist has 15+ domain-specific expertise areas",
        "Lloyd correctly matches 90%+ of tasks to appropriate specialist",
        "Specialists refuse out-of-domain tasks with clear error messages",
        "Parallel work enabled (frontend + backend + testing simultaneously)",
        "100% backward compatibility with existing communication.json"
      ]
    },
    "2_risk_assessment": {
      "complexity_score": 6,
      "complexity_explanation": "Medium-high complexity due to need for comprehensive domain knowledge in 3 different areas (frontend, backend, testing), intelligent task matching logic, strict validation, and backward compatibility requirements. Requires careful design to avoid over-specialization that blocks productivity.",
      "technical_risks": [
        {
          "risk": "Agents reject too many tasks due to over-strict specialization boundaries",
          "likelihood": "medium",
          "impact": "high",
          "mitigation": "Define clear domain boundaries with examples, allow edge cases with Lloyd permission, test with real-world task assignments"
        },
        {
          "risk": "Lloyd's assignment logic becomes too complex or error-prone",
          "likelihood": "low",
          "impact": "medium",
          "mitigation": "Use simple keyword matching + domain mapping, provide fallback to generalist mode, document assignment heuristics clearly"
        },
        {
          "risk": "Breaking existing multi-agent workflows that expect generalists",
          "likelihood": "medium",
          "impact": "high",
          "mitigation": "Maintain backward compatibility via communication.json version detection, provide migration guide, keep agent-generalist.json as reference"
        },
        {
          "risk": "Specialization knowledge becomes outdated as tech stacks evolve",
          "likelihood": "low",
          "impact": "low",
          "mitigation": "Version personas, document update process, focus on fundamental patterns vs specific libraries"
        }
      ],
      "dependencies": [
        "Existing persona JSON structure (no changes required)",
        "Multi-agent coordination tools (assign_agent_task, verify_agent_completion)",
        "Communication.json protocol (add optional specialization field)"
      ],
      "assumptions": [
        "Frontend = UI, React, styling, component development, accessibility",
        "Backend = API, database, server logic, authentication, data models",
        "Testing = Unit tests, integration tests, QA, debugging, coverage",
        "Lloyd has access to task descriptions to determine domain",
        "Agents can clearly identify if task is in their domain"
      ]
    },
    "3_current_state_analysis": {
      "files_to_create": [
        "None - all files already exist"
      ],
      "files_to_modify": [
        "personas/base/agent-2.json - Add frontend specialization",
        "personas/base/agent-3.json - Add backend specialization",
        "personas/base/agent-4.json - Add testing specialization",
        "personas/base/lloyd-expert.json - Add task matching logic",
        "CLAUDE.md - Document specialization system",
        "my-guide.md - Add specialist usage guide",
        "README.md - Update agent descriptions"
      ],
      "files_to_read": [
        "personas/base/agent-generalist.json - Reference original capabilities",
        "personas/base/mcp-expert.json - Reference for comprehensive system prompts",
        "personas/base/docs-expert.json - Reference for expertise structure"
      ],
      "integration_points": [
        "Lloyd's use_persona() calls for agents",
        "Multi-agent coordination via communication.json",
        "Slash commands (/agent2, /agent3, /agent4)",
        "Task assignment workflow (assign_agent_task)"
      ]
    },
    "4_key_features": [
      {
        "feature_id": "SPEC-001",
        "name": "Agent 2 Frontend Specialization",
        "description": "Transform Agent 2 into frontend specialist with expertise in UI, React, styling, components, accessibility",
        "priority": "critical",
        "estimated_effort": "large"
      },
      {
        "feature_id": "SPEC-002",
        "name": "Agent 3 Backend Specialization",
        "description": "Transform Agent 3 into backend specialist with expertise in API, database, server logic, authentication, data models",
        "priority": "critical",
        "estimated_effort": "large"
      },
      {
        "feature_id": "SPEC-003",
        "name": "Agent 4 Testing Specialization",
        "description": "Transform Agent 4 into testing specialist with expertise in unit tests, integration tests, QA, debugging, coverage analysis",
        "priority": "critical",
        "estimated_effort": "large"
      },
      {
        "feature_id": "LLOYD-001",
        "name": "Lloyd Task Matching Logic",
        "description": "Enhance Lloyd with intelligent task-to-agent matching based on domain keywords and task analysis",
        "priority": "critical",
        "estimated_effort": "medium"
      },
      {
        "feature_id": "VALID-001",
        "name": "Specialization Validation",
        "description": "Add validation logic for agents to detect and refuse out-of-domain tasks with clear error messages",
        "priority": "high",
        "estimated_effort": "small"
      },
      {
        "feature_id": "PROTO-001",
        "name": "Communication Protocol Enhancement",
        "description": "Add optional agent_specialization field to communication.json for explicit domain tracking",
        "priority": "medium",
        "estimated_effort": "small"
      },
      {
        "feature_id": "DOCS-001",
        "name": "Specialization Documentation",
        "description": "Comprehensive documentation of specialization system in CLAUDE.md, my-guide.md, README.md",
        "priority": "high",
        "estimated_effort": "medium"
      }
    ],
    "5_task_id_system": {
      "workorder": {
        "id": "WO-AGENT-SPECIALIZATION-001",
        "name": "Agent Specialization",
        "feature_dir": "coderef/working/agent-specialization"
      },
      "task_categories": {
        "AGENT2": "Agent 2 frontend specialization tasks",
        "AGENT3": "Agent 3 backend specialization tasks",
        "AGENT4": "Agent 4 testing specialization tasks",
        "LLOYD": "Lloyd coordinator enhancement tasks",
        "PROTO": "Communication protocol updates",
        "VALID": "Validation and boundary enforcement",
        "DOCS": "Documentation updates",
        "TEST": "Testing and validation"
      },
      "tasks": [
        {
          "id": "AGENT2-001",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Update agent-2.json with frontend specialization (name, description)",
          "category": "AGENT2",
          "estimated_time": "30 min"
        },
        {
          "id": "AGENT2-002",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Write comprehensive frontend system prompt (UI, React, styling workflows)",
          "category": "AGENT2",
          "estimated_time": "3 hours"
        },
        {
          "id": "AGENT2-003",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Define 15+ frontend expertise areas",
          "category": "AGENT2",
          "estimated_time": "1 hour"
        },
        {
          "id": "AGENT2-004",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Add frontend-specific use cases and examples",
          "category": "AGENT2",
          "estimated_time": "1 hour"
        },
        {
          "id": "AGENT3-001",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Update agent-3.json with backend specialization (name, description)",
          "category": "AGENT3",
          "estimated_time": "30 min"
        },
        {
          "id": "AGENT3-002",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Write comprehensive backend system prompt (API, database, auth workflows)",
          "category": "AGENT3",
          "estimated_time": "3 hours"
        },
        {
          "id": "AGENT3-003",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Define 15+ backend expertise areas",
          "category": "AGENT3",
          "estimated_time": "1 hour"
        },
        {
          "id": "AGENT3-004",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Add backend-specific use cases and examples",
          "category": "AGENT3",
          "estimated_time": "1 hour"
        },
        {
          "id": "AGENT4-001",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Update agent-4.json with testing specialization (name, description)",
          "category": "AGENT4",
          "estimated_time": "30 min"
        },
        {
          "id": "AGENT4-002",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Write comprehensive testing system prompt (unit/integration test workflows)",
          "category": "AGENT4",
          "estimated_time": "3 hours"
        },
        {
          "id": "AGENT4-003",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Define 15+ testing expertise areas",
          "category": "AGENT4",
          "estimated_time": "1 hour"
        },
        {
          "id": "AGENT4-004",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Add testing-specific use cases and examples",
          "category": "AGENT4",
          "estimated_time": "1 hour"
        },
        {
          "id": "LLOYD-001",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Design task-to-agent matching heuristics (keyword mapping)",
          "category": "LLOYD",
          "estimated_time": "1 hour"
        },
        {
          "id": "LLOYD-002",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Update lloyd-expert.json with assignment logic section",
          "category": "LLOYD",
          "estimated_time": "2 hours"
        },
        {
          "id": "LLOYD-003",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Add domain validation before agent assignment",
          "category": "LLOYD",
          "estimated_time": "30 min"
        },
        {
          "id": "VALID-001",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Add domain boundary detection to agent system prompts",
          "category": "VALID",
          "estimated_time": "1 hour"
        },
        {
          "id": "VALID-002",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Define clear error messages for out-of-domain task refusal",
          "category": "VALID",
          "estimated_time": "30 min"
        },
        {
          "id": "PROTO-001",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Add agent_specialization field to communication.json schema",
          "category": "PROTO",
          "estimated_time": "30 min"
        },
        {
          "id": "DOCS-001",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Update CLAUDE.md with specialization system overview",
          "category": "DOCS",
          "estimated_time": "1 hour"
        },
        {
          "id": "DOCS-002",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Update my-guide.md with when-to-use-each-specialist guide",
          "category": "DOCS",
          "estimated_time": "45 min"
        },
        {
          "id": "DOCS-003",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Update README.md with agent specialization descriptions",
          "category": "DOCS",
          "estimated_time": "30 min"
        },
        {
          "id": "TEST-001",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Test Agent 2 with frontend tasks (UI components, React, styling)",
          "category": "TEST",
          "estimated_time": "1 hour"
        },
        {
          "id": "TEST-002",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Test Agent 3 with backend tasks (API, database, auth)",
          "category": "TEST",
          "estimated_time": "1 hour"
        },
        {
          "id": "TEST-003",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Test Agent 4 with testing tasks (unit tests, integration tests)",
          "category": "TEST",
          "estimated_time": "1 hour"
        },
        {
          "id": "TEST-004",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Test out-of-domain task refusal with clear error messages",
          "category": "TEST",
          "estimated_time": "30 min"
        },
        {
          "id": "TEST-005",
          "workorder_id": "WO-AGENT-SPECIALIZATION-001",
          "description": "Test Lloyd's task matching logic with mixed task types",
          "category": "TEST",
          "estimated_time": "1 hour"
        }
      ]
    },
    "6_implementation_phases": {
      "phase_1_agent_specialization": {
        "name": "Agent Persona Specialization",
        "objective": "Transform Agent 2, 3, 4 from generalists to specialized domain experts",
        "tasks": [
          "AGENT2-001",
          "AGENT2-002",
          "AGENT2-003",
          "AGENT2-004",
          "AGENT3-001",
          "AGENT3-002",
          "AGENT3-003",
          "AGENT3-004",
          "AGENT4-001",
          "AGENT4-002",
          "AGENT4-003",
          "AGENT4-004"
        ],
        "deliverables": [
          "agent-2.json updated with comprehensive frontend specialization",
          "agent-3.json updated with comprehensive backend specialization",
          "agent-4.json updated with comprehensive testing specialization",
          "Each specialist has 15+ domain-specific expertise areas",
          "System prompts include workflows, best practices, and examples"
        ],
        "estimated_duration": "2 days"
      },
      "phase_2_coordination_logic": {
        "name": "Lloyd Coordination Enhancement",
        "objective": "Add intelligent task-to-agent matching and validation to Lloyd",
        "tasks": [
          "LLOYD-001",
          "LLOYD-002",
          "LLOYD-003",
          "VALID-001",
          "VALID-002",
          "PROTO-001"
        ],
        "deliverables": [
          "Lloyd has task matching heuristics (keyword-based domain detection)",
          "Lloyd validates agent specialization before assignment",
          "Agents detect out-of-domain tasks with clear refusal messages",
          "Communication.json schema enhanced with agent_specialization field",
          "Backward compatibility maintained"
        ],
        "estimated_duration": "1 day"
      },
      "phase_3_documentation_and_testing": {
        "name": "Documentation and Validation",
        "objective": "Complete documentation and validate specialization system",
        "tasks": [
          "DOCS-001",
          "DOCS-002",
          "DOCS-003",
          "TEST-001",
          "TEST-002",
          "TEST-003",
          "TEST-004",
          "TEST-005"
        ],
        "deliverables": [
          "CLAUDE.md updated with specialization overview",
          "my-guide.md has when-to-use-specialist guide",
          "README.md describes specialized agents",
          "All 3 specialists tested with domain tasks",
          "Out-of-domain refusal tested and working",
          "Lloyd's matching logic tested with mixed tasks"
        ],
        "estimated_duration": "1 day"
      }
    },
    "7_testing_strategy": {
      "functional_tests": [
        "Agent 2 accepts frontend tasks (UI, React, styling, components)",
        "Agent 2 refuses backend tasks (API, database)",
        "Agent 2 refuses testing tasks (unit tests, integration tests)",
        "Agent 3 accepts backend tasks (API, database, auth, data models)",
        "Agent 3 refuses frontend tasks (UI, React)",
        "Agent 3 refuses testing tasks (unit tests)",
        "Agent 4 accepts testing tasks (unit tests, integration tests, QA, debugging)",
        "Agent 4 refuses frontend tasks (UI)",
        "Agent 4 refuses backend tasks (API, database)",
        "Lloyd correctly assigns frontend task to Agent 2",
        "Lloyd correctly assigns backend task to Agent 3",
        "Lloyd correctly assigns testing task to Agent 4",
        "Lloyd detects mixed-domain tasks and flags for manual assignment"
      ],
      "integration_tests": [
        "Full workflow: Lloyd assigns frontend task → Agent 2 executes → verification",
        "Full workflow: Lloyd assigns backend task → Agent 3 executes → verification",
        "Full workflow: Lloyd assigns testing task → Agent 4 executes → verification",
        "Parallel execution: Agent 2 (frontend) + Agent 3 (backend) + Agent 4 (testing) simultaneously",
        "Backward compatibility: Existing communication.json files still work"
      ],
      "edge_cases": [
        "Task spans multiple domains (e.g., full-stack feature) - Lloyd provides guidance",
        "Agent receives ambiguous task description - requests clarification",
        "All specialists busy - Lloyd provides queue status or generalist fallback",
        "Legacy communication.json without specialization field - graceful handling"
      ],
      "validation_criteria": [
        "Each specialist has 15+ expertise areas defined",
        "System prompts are comprehensive (1500+ lines each)",
        "Error messages are clear and actionable",
        "Lloyd's matching logic achieves 90%+ accuracy on test tasks",
        "Zero breaking changes to existing multi-agent coordination tools"
      ]
    },
    "8_success_criteria": {
      "functional_requirements": [
        "Agent 2 is fully specialized in frontend (UI, React, styling, components, accessibility)",
        "Agent 3 is fully specialized in backend (API, database, server logic, authentication, data models)",
        "Agent 4 is fully specialized in testing (unit tests, integration tests, QA, debugging, coverage)",
        "Lloyd has intelligent task-to-agent matching logic (keyword-based)",
        "Lloyd validates agent specialization before assignment",
        "Agents refuse out-of-domain tasks with clear, helpful error messages",
        "Communication.json schema includes agent_specialization field (optional)",
        "100% backward compatibility with existing communication.json files"
      ],
      "quality_requirements": [
        "Each specialist has 15+ domain-specific expertise areas",
        "System prompts are comprehensive and actionable (1500+ lines)",
        "Error messages guide Lloyd to correct specialist",
        "Lloyd's matching logic is simple and maintainable (keyword mapping)",
        "Documentation clearly explains when to use each specialist",
        "All existing multi-agent coordination tools work unchanged"
      ],
      "documentation_requirements": [
        "CLAUDE.md documents specialization system architecture",
        "my-guide.md has practical when-to-use-specialist guide",
        "README.md describes all 3 specialists and their domains",
        "Communication.json schema documented with specialization field",
        "Migration guide for converting generalist workflows to specialist workflows"
      ],
      "acceptance_criteria": [
        "Lloyd correctly assigns 90%+ of tasks to appropriate specialist on first try",
        "Specialists successfully complete domain tasks with high quality",
        "Specialists correctly refuse out-of-domain tasks 100% of time",
        "Parallel work enabled: frontend + backend + testing simultaneously",
        "No regression in existing generalist workflows",
        "System can scale to future specialist additions (agent 5, 6, etc.)"
      ]
    },
    "9_implementation_checklist": {
      "phase_1_agent_specialization": [
        "☐ AGENT2-001: Update agent-2.json with frontend specialization (name, description)",
        "☐ AGENT2-002: Write comprehensive frontend system prompt (UI, React, styling workflows)",
        "☐ AGENT2-003: Define 15+ frontend expertise areas",
        "☐ AGENT2-004: Add frontend-specific use cases and examples",
        "☐ AGENT3-001: Update agent-3.json with backend specialization (name, description)",
        "☐ AGENT3-002: Write comprehensive backend system prompt (API, database, auth workflows)",
        "☐ AGENT3-003: Define 15+ backend expertise areas",
        "☐ AGENT3-004: Add backend-specific use cases and examples",
        "☐ AGENT4-001: Update agent-4.json with testing specialization (name, description)",
        "☐ AGENT4-002: Write comprehensive testing system prompt (unit/integration test workflows)",
        "☐ AGENT4-003: Define 15+ testing expertise areas",
        "☐ AGENT4-004: Add testing-specific use cases and examples"
      ],
      "phase_2_coordination_logic": [
        "☐ LLOYD-001: Design task-to-agent matching heuristics (keyword mapping)",
        "☐ LLOYD-002: Update lloyd-expert.json with assignment logic section",
        "☐ LLOYD-003: Add domain validation before agent assignment",
        "☐ VALID-001: Add domain boundary detection to agent system prompts",
        "☐ VALID-002: Define clear error messages for out-of-domain task refusal",
        "☐ PROTO-001: Add agent_specialization field to communication.json schema"
      ],
      "phase_3_documentation_and_testing": [
        "☐ DOCS-001: Update CLAUDE.md with specialization system overview",
        "☐ DOCS-002: Update my-guide.md with when-to-use-each-specialist guide",
        "☐ DOCS-003: Update README.md with agent specialization descriptions",
        "☐ TEST-001: Test Agent 2 with frontend tasks (UI components, React, styling)",
        "☐ TEST-002: Test Agent 3 with backend tasks (API, database, auth)",
        "☐ TEST-003: Test Agent 4 with testing tasks (unit tests, integration tests)",
        "☐ TEST-004: Test out-of-domain task refusal with clear error messages",
        "☐ TEST-005: Test Lloyd's task matching logic with mixed task types"
      ]
    }
  }
}
