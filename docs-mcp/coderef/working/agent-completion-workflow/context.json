{
  "workorder_id": "WO-AGENT-COMPLETION-WORKFLOW-001",
  "feature_name": "agent-completion-workflow",
  "stub_id": "STUB-049",
  "created": "2025-12-20",
  "delegated_by": "Archer (Orchestrator)",
  "target_project": "docs-mcp",
  "goal": "Document and enforce the workflow where agents complete ALL tasks (including /update-deliverables and /archive-feature) before marking work complete, and orchestrator ONLY verifies and updates tracking",
  "description": "Currently unclear who should archive features after completion. Agents complete work but leave deliverables unpopulated and features unarchived. Orchestrator steps in and does the archival (wrong role). Need to make it explicit that agent archives, orchestrator only verifies.",
  "requirements": [
    "Update workflow documentation to clarify agent vs orchestrator responsibilities",
    "Update CLAUDE.md template to include completion tasks for agents",
    "Update handoff prompt templates to include completion checklist",
    "Document the correct workflow sequence with explicit responsibilities",
    "Add validation criteria to ensure agents complete all tasks before handoff"
  ],
  "current_problem": {
    "example": "WO-PERSONA-MANAGEMENT-001",
    "what_happened": [
      "Agent completed both persona tasks (remove + create)",
      "Agent did NOT run /update-deliverables",
      "Agent did NOT run /archive-feature",
      "Agent did NOT update communication.json to 'complete'",
      "Orchestrator stepped in and archived (wrong role)"
    ],
    "why_bad": [
      "Violates orchestrator principle: identify, delegate, collect (not execute)",
      "DELIVERABLES.md left with TBD metrics",
      "Orchestrator touching files in target projects",
      "Agent doesn't have closure on their work"
    ]
  },
  "correct_workflow": {
    "agent_phase_implementation": [
      "Execute approved plan tasks",
      "Update plan.json task statuses as work progresses (using update_task_status tool)",
      "Update communication.json: status to 'implementing'"
    ],
    "agent_phase_completion": [
      "Run /update-deliverables to populate DELIVERABLES.md with git metrics",
      "Run /archive-feature to move feature from coderef/working to coderef/archived",
      "Update communication.json: status to 'complete' AND archived to true",
      "Add final entry to communication_log with completion summary",
      "Notify orchestrator that work is complete and archived"
    ],
    "orchestrator_phase_verification": [
      "Read communication.json - confirm status = 'complete' AND archived = true",
      "Read DELIVERABLES.md - confirm metrics populated (NOT TBD)",
      "Check coderef/archived/ - confirm feature folder exists and moved correctly",
      "Validate deliverables match original requirements in context.json",
      "Verify all tasks in plan.json marked complete"
    ],
    "orchestrator_phase_tracking": [
      "Update workorders.json: move workorder to completed_workorders",
      "Add summary and deliverables list to completed workorder entry",
      "Update last_updated timestamp",
      "Done - DO NOT touch any files in target project"
    ]
  },
  "documentation_updates": {
    "orchestrator_CLAUDE_md": {
      "file": "C:\\Users\\willh\\Desktop\\assistant\\CLAUDE.md",
      "section": "Workorder Handoff Protocol",
      "changes": [
        "Update Phase 3 (Implementation) to include agent completion tasks",
        "Update Phase 4 (Verification) to clarify orchestrator ONLY verifies, does not archive",
        "Add completion checklist for agents: update-deliverables → archive-feature → update communication.json"
      ]
    },
    "handoff_template": {
      "location": "HANDOFF.md template used in delegation",
      "changes": [
        "Add completion section with explicit steps",
        "Include commands to run: /update-deliverables, /archive-feature",
        "Add validation checklist for agent before marking complete"
      ]
    },
    "workflow_docs": {
      "files": [
        "docs-mcp documentation (if workflow guide exists)",
        "Any orchestrator workflow guides"
      ],
      "changes": [
        "Document agent = executor (all tasks including completion)",
        "Document orchestrator = verifier (tracking only, no execution)",
        "Add diagrams showing workflow separation"
      ]
    }
  },
  "validation_criteria": {
    "success_indicators": [
      "All agents run /update-deliverables before /archive-feature",
      "All features in coderef/archived/ have populated DELIVERABLES.md (no TBD)",
      "Orchestrator never uses archive_feature tool directly",
      "Orchestrator never modifies files in target projects",
      "communication.json always updated to 'complete' by agent before verification"
    ],
    "workflow_enforcement": [
      "HANDOFF.md templates include completion checklist",
      "CLAUDE.md explicitly states agent archives, orchestrator verifies",
      "Agents know to run /update-deliverables + /archive-feature before marking complete"
    ]
  },
  "benefits": [
    "Clear separation: agent executes ALL tasks, orchestrator only tracks",
    "Agent has full context when archiving (knows what was done)",
    "Orchestrator stays true to role: identify, delegate, collect",
    "DELIVERABLES.md always has actual metrics before archival",
    "communication.json always reflects true completion status",
    "No confusion about who does what"
  ],
  "constraints": [
    "Must maintain backward compatibility with existing workorders",
    "Documentation must be clear and unambiguous",
    "Handoff templates must be easy to follow",
    "Workflow must be enforceable (agents know what to do)"
  ],
  "deliverables": [
    "Updated CLAUDE.md (orchestrator) with clarified workflow phases",
    "Updated handoff template with completion checklist",
    "Workflow documentation showing agent vs orchestrator responsibilities",
    "Validation that all completion tasks are documented and clear"
  ]
}
