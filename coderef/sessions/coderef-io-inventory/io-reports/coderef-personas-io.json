{
  "agent_id": "coderef-personas",
  "agent_path": "C:\\Users\\willh\\.mcp-servers\\coderef-personas",
  "workorder_id": "WO-CODEREF-IO-INVENTORY-001",
  "scan_timestamp": "2026-01-01T21:45:00Z",
  "inputs": [
    {
      "file": "personas/custom/*.json",
      "type": "other",
      "frequency": "often",
      "purpose": "Load custom persona definitions (lloyd, ava, marcus, quinn, taylor, research-scout)"
    },
    {
      "file": "personas/coderef-personas/*.json",
      "type": "other",
      "frequency": "often",
      "purpose": "Load ecosystem server agent personas (coderef-mcp-lead, coderef-context-agent, coderef-docs-agent, coderef-testing-agent)"
    },
    {
      "file": "personas/base/*.json",
      "type": "other",
      "frequency": "rarely",
      "purpose": "Load base personas (deprecated directory, archived personas)"
    },
    {
      "file": "templates/persona_template.txt",
      "type": "other",
      "frequency": "sometimes",
      "purpose": "Template for custom persona system prompt generation (create_custom_persona tool)"
    },
    {
      "file": ".coderef/patterns.json",
      "type": "coderef_output",
      "frequency": "sometimes",
      "purpose": "Load code patterns for enhanced persona context (PersonaManager.load_coderef_patterns)"
    },
    {
      "file": "coderef/workorder/{feature}/plan.json",
      "type": "workflow_doc",
      "frequency": "often",
      "purpose": "Read plan for Lloyd integration (generate_todo_list, track_plan_execution, execute_plan_interactive)"
    },
    {
      "file": "CLAUDE.md",
      "type": "foundation_doc",
      "frequency": "rarely",
      "purpose": "Read as context documentation (embedded in persona system prompts, not dynamically loaded)"
    },
    {
      "file": "docs/MCP-ECOSYSTEM-REFERENCE.md",
      "type": "other",
      "frequency": "rarely",
      "purpose": "Ecosystem reference documentation (extracted from Lloyd prompt in v1.4.1 optimization)"
    },
    {
      "file": "docs/LLOYD-REFERENCE.md",
      "type": "other",
      "frequency": "rarely",
      "purpose": "Lloyd workflow reference documentation (extracted from Lloyd prompt in v1.4.1 optimization)"
    },
    {
      "file": ".claude/commands/*.md",
      "type": "other",
      "frequency": "sometimes",
      "purpose": "Slash command definitions (read during test validation)"
    },
    {
      "file": "coderef/utils/__init__.py",
      "type": "other",
      "frequency": "always",
      "purpose": "Wrapper utilities for .coderef/ data access (read_coderef_output, check_coderef_available)"
    }
  ],
  "outputs": [
    {
      "file": "personas/custom/{name}.json",
      "type": "other",
      "frequency": "sometimes",
      "purpose": "Save newly created custom personas (create_custom_persona tool)"
    },
    {
      "file": "coderef/workorder/{feature}/plan.json",
      "type": "workflow_doc",
      "frequency": "sometimes",
      "purpose": "Update plan with execution status (track_plan_execution tool updates task execution status)"
    }
  ],
  "notes": {
    "producer_vs_consumer": "coderef-personas is primarily a CONSUMER of documents, not a PRODUCER. Main outputs: (1) Custom persona JSON files when create_custom_persona is called, (2) Updated plan.json when track_plan_execution syncs todo status. All .coderef/ outputs are generated by external 'coderef scan' commands, not by this MCP server.",
    "embedded_documentation": "Persona system prompts contain EMBEDDED copies of ecosystem documentation (CLAUDE.md, workflow guides, MCP tool knowledge) totaling 500-1500 lines per persona. These are BAKED INTO persona JSON files during creation, not read dynamically at runtime.",
    "lloyd_integration": "Lloyd persona and Phase 1 tools (generate_todo_list, track_plan_execution, execute_plan_interactive) are the primary workflow doc consumers. They read/write plan.json for workorder orchestration and task tracking.",
    "pattern_loading": "PersonaManager.load_coderef_patterns() is an OPTIONAL feature that reads .coderef/patterns.json to enrich persona context with project-specific code patterns. Enabled via load_patterns=True parameter (default: True). Silently skips if patterns unavailable.",
    "custom_persona_workflow": "create_custom_persona tool: (1) Reads templates/persona_template.txt, (2) Renders template with {{placeholder}} substitution, (3) Validates via PersonaValidator (multi-stage pipeline), (4) Generates PersonaDefinition, (5) Writes to personas/custom/{name}.json",
    "file_operation_locations": "Main file I/O happens in: (1) src/persona_manager.py (load persona JSON), (2) src/persona_generator.py (template read, persona write), (3) src/generators/todo_list_generator.py (plan.json read), (4) src/trackers/plan_execution_tracker.py (plan.json read/write), (5) src/executors/interactive_plan_executor.py (plan.json read)",
    "coderef_integration": "coderef-personas uses coderef/utils/ wrapper functions to safely access .coderef/ outputs: read_coderef_output(project_path, output_type), check_coderef_available(project_path). Currently only patterns.json is consumed; index.json, complexity.json, coverage.json are NOT integrated despite being valuable for Lloyd task assignment and specialist persona workflows."
  },
  "scan_methodology": {
    "approach": "Grepped entire codebase for file operations: open(), read_text(), write_text(), json.load(), json.dump(), Path() constructors",
    "files_scanned": "server.py, src/persona_manager.py, src/persona_generator.py, src/generators/*.py, src/trackers/*.py, src/executors/*.py, tests/**/*.py",
    "false_positives_filtered": "Test fixtures, backup files (*.backup, *.old), documentation examples, migration scripts",
    "confidence": "High - comprehensive grep + manual source review"
  }
}
