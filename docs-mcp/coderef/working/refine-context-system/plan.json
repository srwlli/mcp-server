{
  "META_DOCUMENTATION": {
    "workorder_id": "WO-REFINE-CONTEXT-001",
    "feature_name": "refine-context-system",
    "status": "planned",
    "created": "2025-12-14",
    "estimated_effort": "14 hours"
  },
  "goal": "Create unified /coderef-foundation-docs command and remove all obsolete inventory/foundation doc tools not part of the new workflow",
  "changes_summary": [
    "Create new /coderef-foundation-docs command (unified workflow)",
    "Remove 7 obsolete tools (inventory tools folded into new workflow)",
    "Remove 8 obsolete commands",
    "Remove 2 obsolete templates (readme.txt, user-guide.txt)",
    "Keep COMPONENTS.md for UI/frontend projects",
    "Integrate coderef tools for code pattern detection",
    "Deep extraction from foundation docs instead of 500-char previews"
  ],
  "new_command": {
    "name": "/coderef-foundation-docs",
    "description": "Unified command that generates comprehensive foundation docs powered by coderef analysis",
    "replaces": [
      "/quick-inventory",
      "/api-inventory",
      "/database-inventory",
      "/dependency-inventory",
      "/config-inventory",
      "/test-inventory",
      "/inventory-manifest",
      "/documentation-inventory",
      "/analyze-for-planning"
    ],
    "output": {
      "files": {
        "ARCHITECTURE.md": "Patterns, decisions, constraints (deep extraction)",
        "SCHEMA.md": "Entities, relationships (deep extraction)",
        "COMPONENTS.md": "Component hierarchy, props (for UI projects)",
        "project-context.json": "Structured context for planning"
      },
      "project_context_schema": {
        "api_context": {
          "endpoints": [],
          "auth_method": "",
          "error_format": ""
        },
        "dependencies": {
          "count": 0,
          "vulns": [],
          "outdated": []
        },
        "database": {
          "tables": [],
          "relationships": [],
          "migrations": []
        },
        "activity": {
          "recent_commits": [],
          "active_files": [],
          "contributors": []
        },
        "patterns": {
          "handlers": [],
          "decorators": [],
          "error_handling": []
        },
        "similar_features": []
      }
    }
  },
  "removal_scope": {
    "tools_to_remove": {
      "count": 7,
      "list": [
        { "name": "inventory_manifest", "value": 2, "reason": "File counts not actionable" },
        { "name": "documentation_inventory", "value": 2, "reason": "Doc stats not actionable" },
        { "name": "config_inventory", "value": 4, "reason": "Not in planning workflow" },
        { "name": "test_inventory", "value": 5, "reason": "Not in planning workflow" },
        { "name": "api_inventory", "value": 9, "reason": "Logic folded into /coderef-foundation-docs" },
        { "name": "database_inventory", "value": 9, "reason": "Logic folded into /coderef-foundation-docs" },
        { "name": "dependency_inventory", "value": 7, "reason": "Logic folded into /coderef-foundation-docs" }
      ]
    },
    "commands_to_remove": {
      "count": 8,
      "list": [
        "/inventory-manifest",
        "/documentation-inventory",
        "/config-inventory",
        "/test-inventory",
        "/api-inventory",
        "/database-inventory",
        "/dependency-inventory",
        "/quick-inventory"
      ]
    },
    "templates_to_remove": {
      "count": 2,
      "list": [
        { "name": "readme.txt", "value": 4, "reason": "High-level overview not actionable for planning" },
        { "name": "user-guide.txt", "value": 2, "reason": "User-facing, not dev-facing" }
      ]
    },
    "impact": {
      "tool_count": "38 → 31 (-7)",
      "command_count": "46 → 38 (-8)"
    }
  },
  "context_model": {
    "high_value_outputs": {
      "ARCHITECTURE.md": { "value": 9, "when": "always", "extraction": "Deep: patterns, decisions, constraints" },
      "SCHEMA.md": { "value": 8, "when": "always", "extraction": "Deep: entities, relationships" },
      "COMPONENTS.md": { "value": 7, "when": "UI/frontend projects", "extraction": "Component hierarchy, props, patterns" },
      "api_context": { "value": 9, "when": "always", "extraction": "Detected endpoints + contracts (unified)" },
      "dependencies": { "value": 7, "when": "always", "extraction": "Auto-detect: vulns, outdated" },
      "database": { "value": 9, "when": "data-touching features", "extraction": "Auto-detect: schema, relationships" },
      "git_activity": { "value": 9, "when": "always", "extraction": "Recent commits, active files, contributors" },
      "detected_patterns": { "value": 8, "when": "always", "extraction": "From coderef: handlers, decorators, error handling" },
      "similar_features": { "value": 8, "when": "always", "extraction": "From coderef/archived/: past features with matching keywords" }
    }
  },
  "implementation_phases": [
    {
      "phase": 1,
      "name": "Create /coderef-foundation-docs Command",
      "effort": "3-4 hours",
      "files": [
        "server.py",
        "tool_handlers.py",
        ".claude/commands/coderef-foundation-docs.md"
      ],
      "tasks": [
        "Define new tool: coderef_foundation_docs",
        "Create handler: handle_coderef_foundation_docs",
        "Create slash command: /coderef-foundation-docs",
        "Wire to coderef-mcp for pattern detection"
      ]
    },
    {
      "phase": 2,
      "name": "Implement Foundation Doc Generation",
      "effort": "3-4 hours",
      "files": ["generators/coderef_foundation_generator.py"],
      "tasks": [
        "ARCHITECTURE.md - extract/generate patterns, decisions, constraints",
        "SCHEMA.md - extract/generate entities, relationships",
        "COMPONENTS.md - extract/generate component hierarchy (conditional)"
      ]
    },
    {
      "phase": 3,
      "name": "Implement Auto-Detection (replaces inventory tools)",
      "effort": "3-4 hours",
      "files": ["generators/coderef_foundation_generator.py"],
      "tasks": [
        "Auto-detect API endpoints from code (replaces api_inventory)",
        "Auto-detect database schema from models/migrations (replaces database_inventory)",
        "Auto-detect dependencies with vuln/outdated checking (replaces dependency_inventory)",
        "Parse git log for activity"
      ]
    },
    {
      "phase": 4,
      "name": "Wire to Planning Workflow",
      "effort": "2 hours",
      "files": [
        ".claude/commands/start-feature.md",
        "generators/planning_generator.py"
      ],
      "tasks": [
        "Update /start-feature to call /coderef-foundation-docs",
        "Update plan generator to use new context schema",
        "Remove calls to obsolete inventory commands"
      ]
    },
    {
      "phase": 5,
      "name": "Remove Obsolete Tools and Commands",
      "effort": "2-3 hours",
      "files": [
        "server.py",
        "tool_handlers.py",
        ".claude/commands/*.md",
        "generators/inventory_generators.py",
        "templates/power/readme.txt",
        "templates/power/user-guide.txt"
      ],
      "tasks": [
        "Remove 7 tool definitions from server.py",
        "Remove 7 handlers from tool_handlers.py",
        "Remove 8 slash command files",
        "Remove or refactor inventory_generators.py (keep logic needed for new generator)",
        "Remove readme.txt and user-guide.txt templates",
        "Update CLAUDE.md with new tool/command counts"
      ]
    }
  ],
  "key_files": {
    "server.py": "Add coderef_foundation_docs, remove 7 obsolete tools",
    "tool_handlers.py": "Add handle_coderef_foundation_docs, remove 7 obsolete handlers",
    "generators/coderef_foundation_generator.py": "New generator for unified workflow",
    "generators/inventory_generators.py": "Refactor - keep useful logic, remove standalone tool support",
    ".claude/commands/coderef-foundation-docs.md": "New slash command",
    ".claude/commands/start-feature.md": "Update to use new command",
    "generators/planning_generator.py": "Use new context schema",
    "templates/power/readme.txt": "DELETE",
    "templates/power/user-guide.txt": "DELETE",
    "CLAUDE.md": "Update documentation"
  }
}
