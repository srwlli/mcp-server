{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "planning_analyzer.py Schema",
  "description": "Type definitions and validation contracts for PlanningAnalyzer class",
  "definitions": {
    "PreparationSummaryDict": {
      "type": "object",
      "description": "Complete analysis results for plan.json Section 0",
      "properties": {
        "foundation_docs": {
          "$ref": "#/definitions/FoundationDocsResult"
        },
        "foundation_doc_content": {
          "$ref": "#/definitions/FoundationDocContent"
        },
        "inventory_data": {
          "$ref": "#/definitions/InventoryData"
        },
        "coding_standards": {
          "$ref": "#/definitions/CodingStandardsResult"
        },
        "reference_components": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of file paths to use as implementation references"
        },
        "key_patterns_identified": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of detected coding patterns"
        },
        "technology_stack": {
          "$ref": "#/definitions/TechnologyStack"
        },
        "project_structure": {
          "$ref": "#/definitions/ProjectStructure"
        },
        "gaps_and_risks": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of missing docs, low coverage, etc."
        }
      },
      "required": [
        "foundation_docs",
        "foundation_doc_content",
        "inventory_data",
        "coding_standards",
        "reference_components",
        "key_patterns_identified",
        "technology_stack",
        "project_structure",
        "gaps_and_risks"
      ]
    },
    "FoundationDocsResult": {
      "type": "object",
      "properties": {
        "available": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Available docs with location (e.g., 'README.md (root)')"
        },
        "missing": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Missing foundation docs"
        }
      },
      "required": ["available", "missing"]
    },
    "FoundationDocContent": {
      "type": "object",
      "description": "Content extracted from foundation docs",
      "patternProperties": {
        "^[A-Z-]+\\.md$": {
          "$ref": "#/definitions/DocContentInfo"
        }
      }
    },
    "DocContentInfo": {
      "type": "object",
      "properties": {
        "location": {
          "type": "string",
          "enum": ["root", "coderef/foundation-docs"],
          "description": "Where the doc was found"
        },
        "preview": {
          "type": "string",
          "maxLength": 500,
          "description": "First 500 characters of content"
        },
        "headers": {
          "type": "array",
          "items": {"type": "string"},
          "maxItems": 10,
          "description": "First 10 markdown headers"
        },
        "size": {
          "type": "integer",
          "minimum": 0,
          "description": "Total character count"
        }
      },
      "required": ["location", "preview", "headers", "size"]
    },
    "InventoryData": {
      "type": "object",
      "description": "Code inventory from .coderef/index.json or MCP scan",
      "properties": {
        "endpoints": {
          "type": "array",
          "items": {"type": "string"},
          "description": "API endpoints (e.g., 'GET /api/users')"
        },
        "schemas": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Data schemas/models"
        },
        "dependencies": {
          "type": "array",
          "items": {"type": "string"},
          "description": "External dependencies"
        }
      }
    },
    "CodingStandardsResult": {
      "type": "object",
      "properties": {
        "available": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Available standards docs"
        },
        "missing": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Missing standards docs"
        }
      },
      "required": ["available", "missing"]
    },
    "TechnologyStack": {
      "type": "object",
      "properties": {
        "language": {
          "type": "string",
          "description": "Primary language (Python, JavaScript, TypeScript, etc.)"
        },
        "framework": {
          "type": "string",
          "description": "Framework (FastAPI, React, Next.js, etc.)"
        },
        "database": {
          "type": "string",
          "description": "Database (PostgreSQL, MongoDB, SQLite, etc.)"
        },
        "testing": {
          "type": "string",
          "description": "Testing framework (pytest, Jest, vitest, etc.)"
        },
        "build": {
          "type": "string",
          "description": "Build system (Webpack, Vite, uv, etc.)"
        }
      },
      "required": ["language", "framework", "database", "testing", "build"]
    },
    "ProjectStructure": {
      "type": "object",
      "properties": {
        "pattern": {
          "type": "string",
          "enum": ["monorepo", "feature-based", "domain-driven", "layered", "flat"],
          "description": "Organization pattern"
        },
        "depth": {
          "type": "integer",
          "minimum": 1,
          "description": "Max directory nesting level"
        },
        "top_level_dirs": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Top-level directories"
        }
      },
      "required": ["pattern", "depth", "top_level_dirs"]
    },
    "FreshnessCheckResult": {
      "type": ["string", "null"],
      "description": "Warning message if >10% drift, null if fresh"
    },
    "CoderefFallbackTiers": {
      "type": "string",
      "enum": ["coderef_files", "mcp_tools", "regex_fallback"],
      "description": "3-tier fallback system priority"
    },
    "AnalyzerConstructorArgs": {
      "type": "object",
      "properties": {
        "project_path": {
          "type": "string",
          "description": "Absolute path to project directory (converted to Path)"
        }
      },
      "required": ["project_path"]
    },
    "ScannerMethodResult": {
      "oneOf": [
        {"$ref": "#/definitions/FoundationDocsResult"},
        {"$ref": "#/definitions/FoundationDocContent"},
        {"$ref": "#/definitions/InventoryData"},
        {"$ref": "#/definitions/CodingStandardsResult"},
        {"$ref": "#/definitions/TechnologyStack"},
        {"$ref": "#/definitions/ProjectStructure"},
        {
          "type": "array",
          "items": {"type": "string"},
          "description": "reference_components, key_patterns, or gaps_and_risks"
        }
      ]
    },
    "CoderefUtilityFunctions": {
      "type": "object",
      "description": "Utility functions for .coderef/ access",
      "properties": {
        "check_coderef_available": {
          "type": "object",
          "properties": {
            "signature": {
              "type": "string",
              "const": "check_coderef_available(project_path: Path, filename: str) -> bool"
            },
            "description": {
              "type": "string",
              "const": "Checks if .coderef/{filename} exists"
            }
          }
        },
        "read_coderef_output": {
          "type": "object",
          "properties": {
            "signature": {
              "type": "string",
              "const": "read_coderef_output(project_path: Path, filename: str) -> dict"
            },
            "description": {
              "type": "string",
              "const": "Reads and parses .coderef/{filename} as JSON"
            }
          }
        }
      }
    },
    "PerformanceMetrics": {
      "type": "object",
      "description": "Timing characteristics for analyzer methods",
      "properties": {
        "with_coderef": {
          "type": "object",
          "properties": {
            "total_time_seconds": {
              "type": "number",
              "minimum": 5,
              "maximum": 10,
              "description": "Total analysis time with .coderef/ data"
            },
            "speedup_factor": {
              "type": "number",
              "minimum": 5,
              "maximum": 10,
              "description": "Performance improvement vs without .coderef/"
            }
          }
        },
        "without_coderef": {
          "type": "object",
          "properties": {
            "total_time_seconds": {
              "type": "number",
              "minimum": 30,
              "maximum": 60,
              "description": "Total analysis time without .coderef/ (MCP + filesystem)"
            }
          }
        },
        "method_timings": {
          "type": "object",
          "properties": {
            "check_coderef_freshness": {"type": "number", "description": "Milliseconds"},
            "scan_foundation_docs": {"type": "number", "description": "Milliseconds"},
            "read_foundation_doc_content": {"type": "number", "description": "Milliseconds"},
            "read_inventory_data_tier1": {"type": "number", "description": "Milliseconds"},
            "read_inventory_data_tier2": {"type": "number", "description": "Milliseconds"},
            "identify_patterns_tier1": {"type": "number", "description": "Milliseconds"},
            "identify_patterns_tier3": {"type": "number", "description": "Milliseconds"}
          }
        }
      }
    },
    "ErrorRecoveryPath": {
      "type": "object",
      "properties": {
        "tier1_failure": {
          "type": "string",
          "const": "Falls back to tier2 (MCP tools)"
        },
        "tier2_failure": {
          "type": "string",
          "const": "Falls back to tier3 (regex/filesystem)"
        },
        "tier3_failure": {
          "type": "string",
          "const": "Returns empty/default values (graceful degradation)"
        }
      }
    }
  },
  "metadata": {
    "category": "planning/analysis",
    "file": "generators/planning_analyzer.py",
    "lines": 919,
    "class": "PlanningAnalyzer",
    "methods": 13,
    "async_methods": ["analyze", "read_inventory_data", "find_reference_components", "identify_patterns", "identify_gaps_and_risks"],
    "version": "1.3.0",
    "key_features": [
      "3-tier fallback system (.coderef/ → MCP → filesystem)",
      "Drift detection (>10% warns)",
      "5-10x speedup with .coderef/ pre-scanned data",
      "Foundation docs extraction with header parsing",
      "Technology stack auto-detection",
      "Pattern analysis with regex fallback"
    ],
    "integration_points": [
      "coderef-context MCP server (optional)",
      ".coderef/ structure (preferred)",
      "PlanningGenerator (consumer)",
      "coderef/utils (wrapper functions)"
    ],
    "generated_by": "Resource Sheet MCP Tool",
    "workorder_id": "WO-RESOURCE-SHEET-P0-001",
    "timestamp": "2026-01-02T00:00:00Z"
  }
}
