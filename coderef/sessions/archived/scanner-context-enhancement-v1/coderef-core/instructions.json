{
  "workorder_id": "WO-SCANNER-CONTEXT-ENHANCEMENT-001-CODEREF-CORE",
  "agent_id": "coderef-core",
  "phase": "phase_1",
  "role": "Implement 4 scanner quick wins for immediate user impact",

  "context": {
    "problem": "Scanner has 85% accuracy, slow performance (1185ms for 500 files), difficult configuration (15-30 min), and limited Python coverage (3 patterns)",
    "solution": "4 quick wins providing immediate improvements: pattern ordering (+15% speed), config presets (30 sec setup), structured errors (3x faster debugging), Python patterns (+30% coverage)",
    "impact": "Immediate user value, enables Phase 2 docs integration, foundation for Phase 3 advanced improvements"
  },

  "execution_steps": {
    "step_1": "READ resources/index.md - Understand all resource locations and task specifications",
    "step_2": "READ Scanner-Effectiveness-Improvements-RESOURCE-SHEET.md lines 1069-1093 - Quick wins overview",
    "step_3": "READ detailed specs for each quick win (lines referenced in resources/index.md)",
    "step_4": "CREATE context.json for /create-workorder workflow (use template below)",
    "step_5": "RUN /create-workorder in your project to generate plan.json",
    "step_6": "EXECUTE 4 quick wins sequentially (order matters: #1 first for baseline, #4 last for testing)",
    "step_7": "TEST each quick win after implementation (benchmarks, accuracy, UX)",
    "step_8": "CREATE outputs/coderef-dashboard-phase1-output.md (use format in resources/index.md)",
    "step_9": "UPDATE communication.json status after each quick win",
    "step_10": "COMMIT and push all changes"
  },

  "tasks": {
    "quickwin_1_pattern_ordering": {
      "description": "Reorder LANGUAGE_PATTERNS by TYPE_PRIORITY for 15% performance improvement",
      "detailed_spec": "Scanner-Effectiveness-Improvements-RESOURCE-SHEET.md lines 359-413",
      "target": {
        "file": "src/scanner/scanner.ts",
        "lines": "18-44",
        "section": "LANGUAGE_PATTERNS object"
      },
      "implementation": {
        "step_1": "Reorder patterns: constant → component → hook → class → method → function (by TYPE_PRIORITY 6→1)",
        "step_2": "Add exclusive: true flag to constant, component, hook patterns",
        "step_3": "Update loop to short-circuit when exclusive match found"
      },
      "code_example": {
        "current_order": "ts: [function, function, class, constant, component, hook, method]",
        "new_order": "ts: [constant (exclusive), component (exclusive), hook (exclusive), class, method, function, function]",
        "short_circuit": "if (match && pattern.exclusive) break; // Skip remaining patterns"
      },
      "testing": {
        "benchmark": "Measure 500 files, 1000 files, 5000 files (expect 15% improvement)",
        "accuracy": "Compare element counts before/after (should be identical)",
        "deduplication": "Verify no duplicate elements (deduplication still works)"
      },
      "success_criteria": "1185ms → ~1000ms for 500 files (15% improvement)"
    },

    "quickwin_2_configuration_presets": {
      "description": "Add 7 framework presets with auto-detection for 10x faster configuration",
      "detailed_spec": "Scanner-Effectiveness-Improvements-RESOURCE-SHEET.md lines 812-947",
      "target": {
        "file_1": "src/scanner/scanner.ts",
        "section": "New ScanPresets object",
        "file_2": "src/scanner/types.ts",
        "add_field": "preset?: string | string[] to ScanOptions"
      },
      "implementation": {
        "step_1": "Define ScanPresets object with 7 presets (nextjs, react, python, monorepo, go, rust, java)",
        "step_2": "Implement detectPreset() function (checks package.json, pyproject.toml, etc.)",
        "step_3": "Add preset parameter to ScanOptions interface",
        "step_4": "Merge preset exclusions with user-provided excludes"
      },
      "presets_definition": {
        "nextjs": {"exclude": ["**/.next/**", "**/node_modules/**"], "langs": ["ts", "tsx", "js", "jsx"]},
        "react": {"exclude": ["**/build/**", "**/node_modules/**"], "langs": ["ts", "tsx", "js", "jsx"]},
        "python": {"exclude": ["**/.venv/**", "**/__pycache__/**"], "langs": ["py"]},
        "monorepo": {"exclude": ["**/packages/*/node_modules/**"], "langs": ["ts", "tsx", "js", "jsx"]},
        "go": {"exclude": ["**/vendor/**"], "langs": ["go"]},
        "rust": {"exclude": ["**/target/**"], "langs": ["rs"]},
        "java": {"exclude": ["**/target/**", "**/build/**"], "langs": ["java"]}
      },
      "auto_detection": {
        "nextjs": "fs.existsSync('next.config.js')",
        "python": "fs.existsSync('pyproject.toml')",
        "rust": "fs.existsSync('Cargo.toml')",
        "go": "fs.existsSync('go.mod')",
        "java": "fs.existsSync('pom.xml')",
        "monorepo": "fs.existsSync('lerna.json') || fs.existsSync('pnpm-workspace.yaml')"
      },
      "testing": {
        "presets": "Test all 7 presets with real projects",
        "auto_detect": "Test on 20+ diverse projects (verify 95%+ accuracy)",
        "exclusions": "Verify excluded files not scanned",
        "time": "Measure configuration time (should be ~30 seconds)"
      },
      "success_criteria": "Configuration time 15-30 min → 30 sec, 95%+ auto-detection accuracy"
    },

    "quickwin_3_structured_errors": {
      "description": "Add ScanError interface with suggestions for 3x faster error resolution",
      "detailed_spec": "Scanner-Effectiveness-Improvements-RESOURCE-SHEET.md lines 660-743",
      "target": {
        "file_1": "src/scanner/types.ts",
        "add_interface": "ScanError with type, severity, file, line, message, suggestion",
        "file_2": "src/scanner/scanner.ts",
        "lines": "552 (error handling)",
        "change": "Return errors array instead of throwing"
      },
      "implementation": {
        "step_1": "Define ScanError interface in types.ts",
        "step_2": "Define ScanResult interface (elements + errors + warnings)",
        "step_3": "Create suggestion database for common errors",
        "step_4": "Wrap all errors in ScanError objects",
        "step_5": "Return errors array alongside elements (non-throwing)"
      },
      "interfaces": {
        "ScanError": {
          "type": "read | parse | pattern | permission | encoding",
          "severity": "error | warning | info",
          "file": "string",
          "line?": "number",
          "message": "string",
          "suggestion?": "string"
        },
        "ScanResult": {
          "elements": "ElementData[]",
          "errors": "ScanError[]",
          "warnings": "ScanError[]",
          "stats": "ScanStats"
        }
      },
      "suggestion_database": {
        "parse_error": "Check for syntax errors. Run `npx tsc --noEmit` to validate TypeScript syntax.",
        "encoding_error": "Convert file to UTF-8: `iconv -f ISO-8859-1 -t UTF-8 {file} > {file}.tmp && mv {file}.tmp {file}`",
        "permission_error": "Add read permission: `chmod +r {file}` or exclude with `exclude: ['{file}']`"
      },
      "testing": {
        "error_types": "Test all 5 error types (read, parse, pattern, permission, encoding)",
        "suggestions": "Verify all suggestions accurate and helpful",
        "partial_results": "Ensure elements returned even when some files error",
        "time": "Measure error resolution time improvement (expect 20 min → 5-7 min)"
      },
      "success_criteria": "Error resolution time 20 min → 5-7 min, all errors have suggestions"
    },

    "quickwin_4_python_patterns": {
      "description": "Add 4 Python patterns for +30% coverage (3 → 7 patterns)",
      "detailed_spec": "Scanner-Effectiveness-Improvements-RESOURCE-SHEET.md lines 162-212",
      "target": {
        "file": "src/scanner/scanner.ts",
        "lines": "18-44",
        "section": "Python patterns in LANGUAGE_PATTERNS"
      },
      "implementation": {
        "step_1": "Add decorator pattern: /@([a-zA-Z0-9_]+)/g",
        "step_2": "Add property pattern: /@property\\s+def\\s+([a-zA-Z0-9_]+)/g",
        "step_3": "Add static method pattern: /@staticmethod\\s+def\\s+([a-zA-Z0-9_]+)/g",
        "step_4": "Add nested class pattern: /^\\s{4,}class\\s+([a-zA-Z0-9_]+)/gm"
      },
      "patterns": [
        {"type": "decorator", "pattern": "/@([a-zA-Z0-9_]+)/g", "nameGroup": 1},
        {"type": "property", "pattern": "/@property\\s+def\\s+([a-zA-Z0-9_]+)/g", "nameGroup": 1},
        {"type": "method", "pattern": "/@staticmethod\\s+def\\s+([a-zA-Z0-9_]+)/g", "nameGroup": 1},
        {"type": "class", "pattern": "/^\\s{4,}class\\s+([a-zA-Z0-9_]+)/gm", "nameGroup": 1}
      ],
      "testing": {
        "decorators": "20 test cases (various decorator types)",
        "properties": "15 test cases (@property, @cached_property)",
        "static_methods": "10 test cases (@staticmethod, @classmethod)",
        "nested_classes": "20 test cases (various indentation levels)",
        "coverage": "Measure element count increase (expect +30%)",
        "accuracy": "Verify no false positives"
      },
      "success_criteria": "3 patterns → 7 patterns, +30% Python element coverage"
    }
  },

  "context_json_template": {
    "workorder_id": "WO-SCANNER-CONTEXT-ENHANCEMENT-001-CODEREF-CORE",
    "feature_name": "scanner-quick-wins",
    "requirements": [
      "Quick Win #1: Reorder patterns by TYPE_PRIORITY for 15% performance improvement",
      "Quick Win #2: Add 7 configuration presets with auto-detection (30 sec setup)",
      "Quick Win #3: Create ScanError interface with suggestion database (3x faster debugging)",
      "Quick Win #4: Expand Python patterns from 3 to 7 (+30% coverage)"
    ],
    "constraints": [
      "Maintain backward compatibility (all features opt-in)",
      "No breaking changes to existing scanner API",
      "Performance regression not acceptable (must be faster, not slower)",
      "Comprehensive testing required (benchmarks, accuracy, UX)"
    ],
    "technical_context": {
      "scanner_location": "packages/coderef-core/src/scanner/scanner.ts",
      "types_location": "packages/coderef-core/src/scanner/types.ts",
      "current_baseline": "85% accuracy, 1185ms for 500 files, 3 Python patterns",
      "detailed_spec": "Scanner-Effectiveness-Improvements-RESOURCE-SHEET.md"
    }
  },

  "success_criteria": {
    "quickwin_1": "15% performance improvement (1185ms → ~1000ms)",
    "quickwin_2": "Configuration time 15-30 min → 30 sec",
    "quickwin_3": "Error resolution 20 min → 5-7 min",
    "quickwin_4": "Python patterns 3 → 7 (+30% coverage)",
    "overall": "4/4 quick wins complete, all tests passing, no regressions"
  },

  "output_requirements": {
    "file": "outputs/coderef-dashboard-phase1-output.md",
    "format": "Markdown with implementation details, test results, benchmarks for each quick win",
    "see_template": "resources/index.md lines 199-288"
  },

  "phase_gate_checklist": [
    "Quick Win #1 complete: 15% performance improvement verified",
    "Quick Win #2 complete: 7 presets defined, auto-detection working",
    "Quick Win #3 complete: ScanError interface, suggestion database, non-throwing errors",
    "Quick Win #4 complete: 7 Python patterns, +30% coverage verified",
    "All benchmarks run: 500, 1000, 5000 files",
    "All accuracy tests passing: Python decorators, properties, static methods, nested classes",
    "No regressions: existing functionality unchanged",
    "Documentation updated: scanner.ts comments, types.ts JSDoc"
  ]
}
