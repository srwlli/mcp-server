{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Dependency Inventory Manifest",
  "description": "JSON schema for dependency inventory manifest structure",
  "type": "object",
  "required": ["project_name", "project_path", "generated_at", "package_managers", "dependencies", "vulnerabilities", "metrics"],
  "properties": {
    "project_name": {
      "type": "string",
      "description": "Name of the project"
    },
    "project_path": {
      "type": "string",
      "description": "Absolute path to project directory"
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when manifest was generated"
    },
    "package_managers": {
      "type": "array",
      "description": "List of detected package managers",
      "items": {
        "type": "string",
        "enum": ["npm", "pip", "cargo", "composer"]
      }
    },
    "dependencies": {
      "type": "object",
      "description": "Dependencies organized by ecosystem",
      "patternProperties": {
        "^(npm|pip|cargo|composer)$": {
          "type": "object",
          "properties": {
            "direct": {
              "type": "array",
              "items": { "$ref": "#/definitions/dependency" }
            },
            "dev": {
              "type": "array",
              "items": { "$ref": "#/definitions/dependency" }
            },
            "peer": {
              "type": "array",
              "items": { "$ref": "#/definitions/dependency" }
            },
            "transitive": {
              "type": "array",
              "items": { "$ref": "#/definitions/dependency" }
            }
          }
        }
      }
    },
    "vulnerabilities": {
      "type": "array",
      "description": "List of security vulnerabilities found",
      "items": { "$ref": "#/definitions/vulnerability" }
    },
    "metrics": {
      "type": "object",
      "description": "Aggregated dependency metrics",
      "required": [
        "total_dependencies",
        "direct_count",
        "dev_count",
        "outdated_count",
        "vulnerable_count"
      ],
      "properties": {
        "total_dependencies": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of dependencies"
        },
        "direct_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of direct production dependencies"
        },
        "dev_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of development dependencies"
        },
        "peer_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of peer dependencies (npm)"
        },
        "transitive_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of transitive dependencies"
        },
        "outdated_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of outdated packages"
        },
        "vulnerable_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of packages with vulnerabilities"
        },
        "critical_vulnerabilities": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of critical severity vulnerabilities"
        },
        "high_vulnerabilities": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of high severity vulnerabilities"
        },
        "medium_vulnerabilities": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of medium severity vulnerabilities"
        },
        "low_vulnerabilities": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of low severity vulnerabilities"
        },
        "license_breakdown": {
          "type": "object",
          "description": "Count of dependencies by license type",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        },
        "ecosystem_breakdown": {
          "type": "object",
          "description": "Count of dependencies by ecosystem",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        }
      }
    }
  },
  "definitions": {
    "dependency": {
      "type": "object",
      "required": ["name", "version", "type", "ecosystem"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Package name"
        },
        "version": {
          "type": "string",
          "description": "Current version installed"
        },
        "type": {
          "type": "string",
          "enum": ["direct", "dev", "peer", "transitive"],
          "description": "Dependency type"
        },
        "ecosystem": {
          "type": "string",
          "enum": ["npm", "pip", "cargo", "composer"],
          "description": "Package ecosystem"
        },
        "latest_version": {
          "type": "string",
          "description": "Latest available version from registry"
        },
        "outdated": {
          "type": "boolean",
          "description": "Whether current version is behind latest"
        },
        "license": {
          "type": "string",
          "description": "Package license (e.g., MIT, Apache-2.0)"
        },
        "vulnerabilities": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of CVE IDs affecting this package"
        },
        "vulnerability_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of vulnerabilities found"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"],
          "description": "Highest vulnerability severity"
        },
        "description": {
          "type": "string",
          "description": "Package description"
        },
        "homepage": {
          "type": "string",
          "format": "uri",
          "description": "Package homepage URL"
        }
      }
    },
    "vulnerability": {
      "type": "object",
      "required": ["id", "package_name", "ecosystem", "severity"],
      "properties": {
        "id": {
          "type": "string",
          "description": "CVE ID or vulnerability identifier"
        },
        "package_name": {
          "type": "string",
          "description": "Affected package name"
        },
        "ecosystem": {
          "type": "string",
          "enum": ["npm", "pip", "cargo", "composer"],
          "description": "Package ecosystem"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"],
          "description": "Vulnerability severity level"
        },
        "summary": {
          "type": "string",
          "description": "Brief vulnerability description"
        },
        "details": {
          "type": "string",
          "description": "Detailed vulnerability explanation"
        },
        "affected_versions": {
          "type": "string",
          "description": "Version range affected (e.g., '<1.2.3')"
        },
        "fixed_version": {
          "type": "string",
          "description": "First version with fix"
        },
        "published": {
          "type": "string",
          "format": "date-time",
          "description": "When vulnerability was published"
        },
        "modified": {
          "type": "string",
          "format": "date-time",
          "description": "When vulnerability was last modified"
        },
        "references": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          },
          "description": "URLs to advisories, patches, etc."
        },
        "cvss_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 10.0,
          "description": "CVSS score (0.0-10.0)"
        }
      }
    }
  }
}
