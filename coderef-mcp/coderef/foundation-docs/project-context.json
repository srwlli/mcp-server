{
  "api_context": {
    "endpoints": [],
    "count": 0,
    "frameworks_detected": [],
    "auth_method": "Unknown",
    "error_format": "RFC 7807"
  },
  "dependencies": {
    "count": 0,
    "production": [],
    "development": [],
    "outdated": [],
    "vulns": []
  },
  "database": {
    "tables": [
      {
        "name": "MetadataValue",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "ElementMetadata",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "Relationship",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "CodeRef2Element",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "QueryFilter",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "QueryRequest",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "QueryResponse",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "ImpactNode",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "ImpactAnalysis",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "AnalysisRequest",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "AnalysisResponse",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "CoverageInfo",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "CoverageAnalysis",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "TraversalRequest",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "TraversalNode",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "TraversalResponse",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "BatchQueryItem",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "BatchQueryRequest",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "BatchQueryResult",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "BatchQueryResponse",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "ErrorDetail",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "ErrorResponse",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "ToolStatus",
        "columns": [],
        "file": "coderef\\models.py"
      },
      {
        "name": "ServiceStatus",
        "columns": [],
        "file": "coderef\\models.py"
      }
    ],
    "relationships": [],
    "migrations": [],
    "table_count": 24,
    "has_migrations": false
  },
  "activity": {
    "recent_commits": [],
    "active_files": [],
    "contributors": [],
    "has_git": false
  },
  "patterns": {
    "handlers": [
      {
        "name": "handle_query_elements",
        "file": "tool_handlers.py"
      },
      {
        "name": "handle_analyze_impact",
        "file": "tool_handlers.py"
      },
      {
        "name": "handle_validate_references",
        "file": "tool_handlers.py"
      },
      {
        "name": "handle_batch_validate",
        "file": "tool_handlers.py"
      },
      {
        "name": "handle_generate_docs",
        "file": "tool_handlers.py"
      },
      {
        "name": "handle_audit",
        "file": "tool_handlers.py"
      },
      {
        "name": "handle_nl_query",
        "file": "tool_handlers.py"
      },
      {
        "name": "handle_scan_realtime",
        "file": "tool_handlers.py"
      }
    ],
    "decorators": [
      {
        "name": "Fn",
        "count": 58
      },
      {
        "name": "pytest.mark.asyncio",
        "count": 58
      },
      {
        "name": "pytest.fixture",
        "count": 16
      },
      {
        "name": "C",
        "count": 14
      },
      {
        "name": "dataclass",
        "count": 12
      },
      {
        "name": "F",
        "count": 11
      },
      {
        "name": "staticmethod",
        "count": 7
      },
      {
        "name": "M",
        "count": 5
      },
      {
        "name": "Type",
        "count": 3
      },
      {
        "name": "InvalidType",
        "count": 3
      },
      {
        "name": "classmethod",
        "count": 3
      },
      {
        "name": "app.list_tools",
        "count": 1
      },
      {
        "name": "app.call_tool",
        "count": 1
      },
      {
        "name": "app.list_resources",
        "count": 1
      },
      {
        "name": "app.read_resource",
        "count": 1
      }
    ],
    "error_handling": [
      "RuntimeError",
      "ValueError",
      "AssertionError",
      "OSError",
      "ServiceUnavailableError",
      "FileNotFoundError"
    ]
  },
  "similar_features": [],
  "existing_docs": {
    "architecture": null,
    "schema": null,
    "api": {
      "sections": {
        "coderef2_mcp_service_-_api_documentation": "**Version:** 1.0.0\n**Last Updated:** Phase 6 Complete\n\n---",
        "table_of_contents": "1. [Protocol Overview](#protocol-overview)\n2. [Authentication](#authentication)\n3. [Tool Specifications](#tool-specifications)\n4. [Data Models](#data-models)\n5. [Error Handling](#error-handling)\n6. [Rate Limiting](#rate-limiting)\n7. [Examples](#examples)\n\n---",
        "protocol_overview": "### MCP (Model Context Protocol)\n\nCodeRef2 implements the MCP specification for tool exposure:\n\n- **Protocol Version:** MCP 1.0\n- **Transport:** Stdio (default), SSE optional\n- **Encoding:** JSON\n- **Async Support:** Yes (all tools support async)\n\n### Tool Discovery\n\nList all available tools:\n\n```python\nawait server.list_tools()\n```\n\nReturns 6 tools with schemas, descriptions, and input specifications.\n\n---",
        "authentication": "**Current Implementation:** No authentication required\n\nCodeRef2 is designed to run in secure environments (local, private networks, or protected APIs).\n\n### Future Considerations\n\n- API key authentication\n- OAuth2 integration\n- Rate limiting per client\n- Request signing\n\n---",
        "tool_specifications": "### Tool 1: Query (`mcp__coderef__query`)\n\n**Status:** \u2705 Fully Implemented\n\n#### Description\nFind and retrieve CodeRef2 elements by reference or pattern matching.\n\n#### Input Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"query\": {\n      \"type\": \"string\",\n      \"description\": \"CodeRef2 reference (@Type/path#element:line) or search pattern\",\n      \"example\": \"@Fn/src/utils#calculate:42\"\n    },\n    \"filter\": {\n      \"type\": \"object\",\n      \"description\": \"Optional filter criteria\",\n      \"properties\": {\n        \"type_designators\": {\n          \"type\": \"array\",\n          \"description\": \"Filter by type (e.g., [\\\"Fn\\\", \\\"C\\\"])\",\n          \"items\": {\"type\": \"string\"}\n        },\n        \"path_pattern\": {\n          \"type\": \"string\",\n          \"description\": \"Glob pattern for path (e.g., \\\"src/*\\\")\"\n        },\n        \"metadata_filters\": {\n          \"type\": \"object\",\n          \"description\": \"Match metadata values\",\n          \"example\": {\"status\": \"active\", \"complexity\": \"high\"}\n        },\n        \"relationship_types\": {\n          \"type\": \"array\",\n          \"description\": \"Filter by relationship type\"\n        },\n        \"min_line\": {\"type\": \"integer\"},\n        \"max_line\": {\"type\": \"integer\"},\n        \"has_test_coverage\": {\"type\": \"boolean\"}\n      }\n    },\n    \"limit\": {\n      \"type\": \"integer\",\n      \"description\": \"Maximum results (1-1000)\",\n      \"default\": 100,\n      \"minimum\": 1,\n      \"maximum\": 1000\n    },\n    \"include_relationships\": {\n      \"type\": \"boolean\",\n      \"description\": \"Include relationship information\",\n      \"default\": true\n    },\n    \"include_metadata\": {\n      \"type\": \"boolean\",\n      \"description\": \"Include element metadata\",\n      \"default\": true\n    },\n    \"include_source\": {\n      \"type\": \"boolean\",\n      \"description\": \"Include source code snippets\",\n      \"default\": false\n    }\n  },\n  \"required\": [\"query\"]\n}\n```\n\n#### Output Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"status\": {\"type\": \"string\", \"enum\": [\"success\", \"error\"]},\n    \"query\": {\"type\": \"string\"},\n    \"total_count\": {\"type\": \"integer\"},\n    \"elements\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"reference\": {\"type\": \"string\"},\n          \"type_designator\": {\"type\": \"string\"},\n          \"path\": {\"type\": \"string\"},\n          \"element\": {\"type\": [\"string\", \"null\"]},\n          \"line\": {\"type\": [\"integer\", \"null\"]},\n          \"metadata\": {\"type\": \"object\"},\n          \"has_relationships\": {\"type\": \"boolean\"},\n          \"test_coverage\": {\"type\": [\"number\", \"null\"]}\n        }\n      }\n    },\n    \"execution_time_ms\": {\"type\": \"number\"},\n    \"query_status\": {\"type\": \"string\"},\n    \"timestamp\": {\"type\": \"string\", \"format\": \"date-time\"}\n  }\n}\n```\n\n#### Performance\n- **Target:** < 500ms\n- **Typical:** 200-400ms\n- **Max depth:** Not limited (depends on pattern complexity)\n\n#### Error Codes\n- `INVALID_REQUEST` - Missing or invalid parameters\n- `QUERY_ERROR` - Query execution failed\n- `INVALID_FILTER` - Filter configuration invalid\n\n---\n\n### Tool 2: Analyze (`mcp__coderef__analyze`)\n\n**Status:** \u2705 Fully Implemented\n\n#### Description\nPerform deep analysis on CodeRef2 elements (impact, coverage, complexity, graph traversal).\n\n#### Input Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"reference\": {\n      \"type\": \"string\",\n      \"description\": \"CodeRef2 reference to analyze\",\n      \"example\": \"@Fn/src/core#main:100\"\n    },\n    \"analysis_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"impact\", \"deep\", \"coverage\", \"complexity\"],\n      \"description\": \"Type of analysis\",\n      \"default\": \"impact\"\n    },\n    \"depth\": {\n      \"type\": \"integer\",\n      \"description\": \"Analysis traversal depth\",\n      \"default\": 3,\n      \"minimum\": 1,\n      \"maximum\": 10\n    },\n    \"include_test_impact\": {\n      \"type\": \"boolean\",\n      \"description\": \"Include test-related impacts\",\n      \"default\": true\n    }\n  },\n  \"required\": [\"reference\"]\n}\n```\n\n#### Analysis Types\n\n##### Impact Analysis\nDetermine what breaks if this element changes.\n\n```json\n{\n  \"status\": \"success\",\n  \"reference\": \"@Fn/src/core#main:100\",\n  \"analysis_type\": \"impact\",\n  \"total_affected\": 15,\n  \"affected_elements\": [\n    {\n      \"reference\": \"@Fn/src/handler#process\",\n      \"element_type\": \"Fn\",\n      \"impact_level\": \"critical\",\n      \"depth\": 1,\n      \"reason\": \"Direct caller\"\n    }\n  ],\n  \"impact_summary\": {\n    \"by_level\": {\"critical\": 1, \"high\": 3, \"medium\": 5, \"low\": 6},\n    \"max_depth\": 3\n  }\n}\n```\n\n##### Deep Analysis\nFull graph traversal with cycle detection.\n\n```json\n{\n  \"analysis_type\": \"deep\",\n  \"results\": {\n    \"dependents\": {\"total\": 15, \"by_depth\": {\"1\": 3, \"2\": 5, \"3\": 7}},\n    \"dependencies\": {\"total\": 8},\n    \"cycles_detected\": 0,\n    \"cycles\": []\n  }\n}\n```\n\n##### Coverage Analysis\nTest coverage statistics.\n\n```json\n{\n  \"analysis_type\": \"coverage\",\n  \"coverage_results\": {\n    \"total_elements\": 1,\n    \"covered_elements\": 1,\n    \"uncovered_elements\": 0,\n    \"coverage_percentage\": 85.5,\n    \"at_risk_count\": 2,\n    \"at_risk_elements\": [\"@Fn/src/utils#helper\"]\n  }\n}\n```\n\n##### Complexity Analysis\nCode complexity metrics.\n\n```json\n{\n  \"analysis_type\": \"complexity\",\n  \"complexity_score\": 42.5,\n  \"complexity_category\": \"medium\"\n}\n```\n\n#### Performance\n- **Target:** < 500ms\n- **Typical:** 300-450ms\n\n#### Error Codes\n- `INVALID_REFERENCE` - Reference format invalid\n- `ANALYSIS_ERROR` - Analysis execution failed\n- `UNSUPPORTED_ANALYSIS` - Unknown analysis type\n\n---\n\n### Tool 3: Validate (`mcp__coderef__validate`)\n\n**Status:** \u2705 Fully Implemented\n\n#### Description\nValidate CodeRef2 reference format and structure. Supports single or multiple references.\n\n#### Input Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"reference\": {\n      \"type\": \"string\",\n      \"description\": \"Single reference to validate\"\n    },\n    \"references\": {\n      \"type\": \"array\",\n      \"description\": \"Multiple references to validate\",\n      \"items\": {\"type\": \"string\"}\n    },\n    \"validate_existence\": {\n      \"type\": \"boolean\",\n      \"description\": \"Check if element exists\",\n      \"default\": false\n    }\n  }\n}\n```\n\n**Note:** Provide either `reference` or `references`, not both.\n\n#### Output Schema\n\n```json\n{\n  \"status\": \"success\",\n  \"total_references\": 1,\n  \"valid_count\": 1,\n  \"invalid_count\": 0,\n  \"results\": [\n    {\n      \"reference\": \"@Fn/src/utils#calculate_total:42\",\n      \"status\": \"valid\",\n      \"is_valid\": true,\n      \"issues\": [\n        {\n          \"severity\": \"warning\",\n          \"code\": \"CUSTOM_METADATA\",\n          \"message\": \"Metadata not in standard categories\",\n          \"field\": \"metadata\",\n          \"suggestion\": \"Consider using standard categories\"\n        }\n      ],\n      \"validation_time_ms\": 2.3\n    }\n  ],\n  \"validation_status\": \"success\"\n}\n```\n\n#### Validation Rules\n\n1. **Format:** Must match `@Type/path#element:line{metadata}`\n2. **Type:** Must be valid designator (26 types)\n3. **Path:** Must contain valid path characters\n4. **Element:** Optional, must be identifier\n5. **Line:** Optional, must be positive integer\n6. **Metadata:** Optional, key:value pairs\n\n#### Severity Levels\n- `info` - Informational\n- `warning` - Potential issue\n- `error` - Validation failed\n- `critical` - Must fix\n\n#### Error Codes\n- `EMPTY_REFERENCE` - Reference is empty\n- `MALFORMED_REFERENCE` - Format doesn't match pattern\n- `INVALID_TYPE` - Type designator not recognized\n- `EMPTY_PATH` - Path is missing\n- `NEGATIVE_LINE` - Line number < 0\n- `INVALID_METADATA_FORMAT` - Metadata syntax error\n\n---\n\n### Tool 4: Batch Validate (`mcp__coderef__batch_validate`)\n\n**Status:** \u2705 Fully Implemented\n\n#### Description\nValidate multiple references efficiently (sequential or parallel).\n\n#### Input Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"references\": {\n      \"type\": \"array\",\n      \"description\": \"References to validate\",\n      \"items\": {\"type\": \"string\"},\n      \"minItems\": 1\n    },\n    \"parallel\": {\n      \"type\": \"boolean\",\n      \"description\": \"Process in parallel\",\n      \"default\": true\n    },\n    \"max_workers\": {\n      \"type\": \"integer\",\n      \"description\": \"Max concurrent workers\",\n      \"default\": 5,\n      \"minimum\": 1,\n      \"maximum\": 20\n    },\n    \"timeout_ms\": {\n      \"type\": \"integer\",\n      \"description\": \"Batch timeout milliseconds\",\n      \"default\": 5000,\n      \"minimum\": 1000,\n      \"maximum\": 30000\n    }\n  },\n  \"required\": [\"references\"]\n}\n```\n\n#### Output Schema\n\n```json\n{\n  \"status\": \"success\",\n  \"total_items\": 100,\n  \"successful\": 98,\n  \"failed\": 2,\n  \"warnings\": 5,\n  \"results\": [\n    {\n      \"reference\": \"@Fn/src/a#func\",\n      \"status\": \"valid\",\n      \"is_valid\": true,\n      \"issue_count\": 0,\n      \"error_count\": 0,\n      \"warning_count\": 0\n    }\n  ],\n  \"summary\": {\n    \"success_rate\": 98.0,\n    \"average_validation_time_ms\": 2.1\n  },\n  \"batch_execution_time_ms\": 215.3\n}\n```\n\n#### Performance\n- **Sequential:** ~2-3ms per reference\n- **Parallel (5 workers):** ~20-30ms per reference\n- **Target for 100 items:** < 5000ms\n\n#### Optimization Tips\n- Use `parallel: true` for 50+ items\n- Increase `max_workers` for CPU-bound systems\n- Batch size 100-500 for optimal performance\n\n---\n\n### Tool 5 & 6: UDS Tools (Placeholder)\n\n**Status:** \u23f3 Deferred (P6.4-P6.5)\n\n#### Tool 5: UDS Compliance Check (`mcp__coderef__uds_compliance_check`)\n\n```json\n{\n  \"status\": \"pending\",\n  \"message\": \"UDS compliance checking implementation in P6.4\"\n}\n```\n\n#### Tool 6: Generate with UDS (`mcp__coderef__generate_with_uds`)\n\n```json\n{\n  \"status\": \"pending\",\n  \"message\": \"UDS-compliant generation implementation in P6.5\"\n}\n```\n\n---",
        "data_models": "### CodeRef2 Reference\n\n```typescript\n@Type/path#element:line{metadata}\n\n// Components:\nType: TypeDesignator        // One of 26 types (Fn, C, M, etc.)\npath: string                // File or module path\nelement?: string            // Optional element name\nline?: integer              // Optional line number\nmetadata?: {key: string}    // Optional metadata tags\n```\n\n### Element Metadata\n\n```typescript\n{\n  status?: \"active\" | \"deprecated\" | \"experimental\",\n  security?: \"public\" | \"internal\" | \"private\" | \"critical\",\n  performance?: \"fast\" | \"normal\" | \"slow\" | \"critical\",\n  complexity?: \"low\" | \"medium\" | \"high\" | \"critical\",\n  coverage?: \"0-100\" (percentage),\n  maintenance?: \"active\" | \"stable\" | \"deprecated\",\n  compatibility?: \"v1\" | \"v2\" | \"breaking\",\n  documentation?: \"complete\" | \"partial\" | \"minimal\"\n}\n```\n\n### Relationship Types\n\n```typescript\nenum RelationshipType {\n  IMPORTS = \"imports\",\n  CALLS = \"calls\",\n  DEPENDS_ON = \"depends-on\",\n  TESTS = \"tests\",\n  IMPLEMENTS = \"implements\",\n  EXTENDS = \"extends\",\n  CONTAINS = \"contains\",\n  REFERENCES = \"references\"\n}\n```\n\n### Type Designators (26 total)\n\n```typescript\nF        // File\nD        // Directory\nC        // Class\nFn       // Function\nCl       // Closure\nM        // Method\nP        // Property\nV        // Variable\nK        // Constant\nE        // Enum\nI        // Interface\nTr       // Trait\nMo       // Module\nPkg      // Package\nN        // Namespace\nTD       // Type Definition\nG        // Generic\nDec      // Decorator\nParam    // Parameter\nFd       // Field\nAttr     // Attribute\nTest     // Test Case\nFix      // Fixture\nMacro    // Macro\nAnn      // Annotation\nCustom   // Custom Type\n```\n\n---",
        "error_handling": "### Standard Error Response\n\n```json\n{\n  \"status\": \"error\",\n  \"error_code\": \"ERROR_CODE\",\n  \"message\": \"Human-readable error message\",\n  \"details\": {\n    \"field\": \"field_name\",\n    \"suggestion\": \"What to do about it\"\n  },\n  \"timestamp\": \"2024-01-15T10:30:45.123456\"\n}\n```\n\n### Error Categories\n\n#### Validation Errors (400)\n- `INVALID_REQUEST` - Invalid input parameters\n- `VALIDATION_ERROR` - Reference validation failed\n- `MALFORMED_REFERENCE` - Reference format invalid\n\n#### Execution Errors (500)\n- `QUERY_ERROR` - Query execution failed\n- `ANALYSIS_ERROR` - Analysis execution failed\n- `BATCH_VALIDATION_ERROR` - Batch processing failed\n- `TOOL_EXECUTION_ERROR` - General tool execution error\n\n#### Configuration Errors (500)\n- `UNKNOWN_TOOL` - Tool not found\n- `UNSUPPORTED_ANALYSIS` - Analysis type not supported\n\n---",
        "rate_limiting": "**Current:** No rate limiting\n\n### Planned Limits\n- 100 requests/second per client\n- 1000 elements per query\n- 500 elements per batch\n- 10 second timeout per request\n\n---",
        "examples": "### Example 1: Query Elements\n\n```python\nimport json\nfrom server import CodeRef2Server\n\nasync def example():\n    server = CodeRef2Server()\n\n    result = await server._handle_call_tool(\n        \"mcp__coderef__query\",\n        {\n            \"query\": \"@Fn/src/utils#*\",\n            \"limit\": 10,\n            \"include_metadata\": True\n        }\n    )\n\n    response = json.loads(result[0].text)\n    print(json.dumps(response, indent=2))\n```\n\n### Example 2: Analyze Impact\n\n```python\nresult = await server._handle_call_tool(\n    \"mcp__coderef__analyze\",\n    {\n        \"reference\": \"@Fn/src/core#main:100\",\n        \"analysis_type\": \"impact\",\n        \"depth\": 3\n    }\n)\n\nresponse = json.loads(result[0].text)\nprint(f\"Elements affected: {response['total_affected']}\")\nfor elem in response['affected_elements']:\n    print(f\"  - {elem['reference']} ({elem['impact_level']})\")\n```\n\n### Example 3: Batch Validate\n\n```python\nresult = await server._handle_call_tool(\n    \"mcp__coderef__batch_validate\",\n    {\n        \"references\": [\n            \"@Fn/src/a#func\",\n            \"@C/src/b#Class\",\n            \"invalid_ref\",\n            \"@F/src/config.py\"\n        ],\n        \"parallel\": True,\n        \"max_workers\": 4\n    }\n)\n\nresponse = json.loads(result[0].text)\nprint(f\"Success rate: {response['summary']['success_rate']}%\")\nfor result in response['results']:\n    status = \"\u2713\" if result['is_valid'] else \"\u2717\"\n    print(f\"  {status} {result['reference']}\")\n```\n\n---",
        "integration_guide": "### Using with Claude or Agents\n\n```json\n{\n  \"mcpServers\": {\n    \"coderef2\": {\n      \"command\": \"python\",\n      \"args\": [\"/path/to/server.py\"],\n      \"env\": {\n        \"CODEREF_LOG_LEVEL\": \"INFO\"\n      }\n    }\n  }\n}\n```\n\n### Direct Python Integration\n\n```python\nfrom server import get_server\nimport asyncio\n\nasync def main():\n    server = get_server()\n\n    # List tools\n    tools = await server._handle_list_tools()\n    print(f\"Available tools: {len(tools)}\")\n\n    # Health check\n    health = await server.health_check()\n    print(f\"Status: {health['status']}\")\n```\n\n---\n\n**API Version:** 1.0.0\n**Last Updated:** Phase 6 Implementation Complete"
      },
      "full_content": "# CodeRef2 MCP Service - API Documentation\n\n**Version:** 1.0.0\n**Last Updated:** Phase 6 Complete\n\n---\n\n## Table of Contents\n\n1. [Protocol Overview](#protocol-overview)\n2. [Authentication](#authentication)\n3. [Tool Specifications](#tool-specifications)\n4. [Data Models](#data-models)\n5. [Error Handling](#error-handling)\n6. [Rate Limiting](#rate-limiting)\n7. [Examples](#examples)\n\n---\n\n## Protocol Overview\n\n### MCP (Model Context Protocol)\n\nCodeRef2 implements the MCP specification for tool exposure:\n\n- **Protocol Version:** MCP 1.0\n- **Transport:** Stdio (default), SSE optional\n- **Encoding:** JSON\n- **Async Support:** Yes (all tools support async)\n\n### Tool Discovery\n\nList all available tools:\n\n```python\nawait server.list_tools()\n```\n\nReturns 6 tools with schemas, descriptions, and input specifications.\n\n---\n\n## Authentication\n\n**Current Implementation:** No authentication required\n\nCodeRef2 is designed to run in secure environments (local, private networks, or protected APIs).\n\n### Future Considerations\n\n- API key authentication\n- OAuth2 integration\n- Rate limiting per client\n- Request signing\n\n---\n\n## Tool Specifications\n\n### Tool 1: Query (`mcp__coderef__query`)\n\n**Status:** \u2705 Fully Implemented\n\n#### Description\nFind and retrieve CodeRef2 elements by reference or pattern matching.\n\n#### Input Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"query\": {\n      \"type\": \"string\",\n      \"description\": \"CodeRef2 reference (@Type/path#element:line) or search pattern\",\n      \"example\": \"@Fn/src/utils#calculate:42\"\n    },\n    \"filter\": {\n      \"type\": \"object\",\n      \"description\": \"Optional filter criteria\",\n      \"properties\": {\n        \"type_designators\": {\n          \"type\": \"array\",\n          \"description\": \"Filter by type (e.g., [\\\"Fn\\\", \\\"C\\\"])\",\n          \"items\": {\"type\": \"string\"}\n        },\n        \"path_pattern\": {\n          \"type\": \"string\",\n          \"description\": \"Glob pattern for path (e.g., \\\"src/*\\\")\"\n        },\n        \"metadata_filters\": {\n          \"type\": \"object\",\n          \"description\": \"Match metadata values\",\n          \"example\": {\"status\": \"active\", \"complexity\": \"high\"}\n        },\n        \"relationship_types\": {\n          \"type\": \"array\",\n          \"description\": \"Filter by relationship type\"\n        },\n        \"min_line\": {\"type\": \"integer\"},\n        \"max_line\": {\"type\": \"integer\"},\n        \"has_test_coverage\": {\"type\": \"boolean\"}\n      }\n    },\n    \"limit\": {\n      \"type\": \"integer\",\n      \"description\": \"Maximum results (1-1000)\",\n      \"default\": 100,\n      \"minimum\": 1,\n      \"maximum\": 1000\n    },\n    \"include_relationships\": {\n      \"type\": \"boolean\",\n      \"description\": \"Include relationship information\",\n      \"default\": true\n    },\n    \"include_metadata\": {\n      \"type\": \"boolean\",\n      \"description\": \"Include element metadata\",\n      \"default\": true\n    },\n    \"include_source\": {\n      \"type\": \"boolean\",\n      \"description\": \"Include source code snippets\",\n      \"default\": false\n    }\n  },\n  \"required\": [\"query\"]\n}\n```\n\n#### Output Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"status\": {\"type\": \"string\", \"enum\": [\"success\", \"error\"]},\n    \"query\": {\"type\": \"string\"},\n    \"total_count\": {\"type\": \"integer\"},\n    \"elements\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"reference\": {\"type\": \"string\"},\n          \"type_designator\": {\"type\": \"string\"},\n          \"path\": {\"type\": \"string\"},\n          \"element\": {\"type\": [\"string\", \"null\"]},\n          \"line\": {\"type\": [\"integer\", \"null\"]},\n          \"metadata\": {\"type\": \"object\"},\n          \"has_relationships\": {\"type\": \"boolean\"},\n          \"test_coverage\": {\"type\": [\"number\", \"null\"]}\n        }\n      }\n    },\n    \"execution_time_ms\": {\"type\": \"number\"},\n    \"query_status\": {\"type\": \"string\"},\n    \"timestamp\": {\"type\": \"string\", \"format\": \"date-time\"}\n  }\n}\n```\n\n#### Performance\n- **Target:** < 500ms\n- **Typical:** 200-400ms\n- **Max depth:** Not limited (depends on pattern complexity)\n\n#### Error Codes\n- `INVALID_REQUEST` - Missing or invalid parameters\n- `QUERY_ERROR` - Query execution failed\n- `INVALID_FILTER` - Filter configuration invalid\n\n---\n\n### Tool 2: Analyze (`mcp__coderef__analyze`)\n\n**Status:** \u2705 Fully Implemented\n\n#### Description\nPerform deep analysis on CodeRef2 elements (impact, coverage, complexity, graph traversal).\n\n#### Input Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"reference\": {\n      \"type\": \"string\",\n      \"description\": \"CodeRef2 reference to analyze\",\n      \"example\": \"@Fn/src/core#main:100\"\n    },\n    \"analysis_type\": {\n      \"type\": \"string\",\n      \"enum\": [\"impact\", \"deep\", \"coverage\", \"complexity\"],\n      \"description\": \"Type of analysis\",\n      \"default\": \"impact\"\n    },\n    \"depth\": {\n      \"type\": \"integer\",\n      \"description\": \"Analysis traversal depth\",\n      \"default\": 3,\n      \"minimum\": 1,\n      \"maximum\": 10\n    },\n    \"include_test_impact\": {\n      \"type\": \"boolean\",\n      \"description\": \"Include test-related impacts\",\n      \"default\": true\n    }\n  },\n  \"required\": [\"reference\"]\n}\n```\n\n#### Analysis Types\n\n##### Impact Analysis\nDetermine what breaks if this element changes.\n\n```json\n{\n  \"status\": \"success\",\n  \"reference\": \"@Fn/src/core#main:100\",\n  \"analysis_type\": \"impact\",\n  \"total_affected\": 15,\n  \"affected_elements\": [\n    {\n      \"reference\": \"@Fn/src/handler#process\",\n      \"element_type\": \"Fn\",\n      \"impact_level\": \"critical\",\n      \"depth\": 1,\n      \"reason\": \"Direct caller\"\n    }\n  ],\n  \"impact_summary\": {\n    \"by_level\": {\"critical\": 1, \"high\": 3, \"medium\": 5, \"low\": 6},\n    \"max_depth\": 3\n  }\n}\n```\n\n##### Deep Analysis\nFull graph traversal with cycle detection.\n\n```json\n{\n  \"analysis_type\": \"deep\",\n  \"results\": {\n    \"dependents\": {\"total\": 15, \"by_depth\": {\"1\": 3, \"2\": 5, \"3\": 7}},\n    \"dependencies\": {\"total\": 8},\n    \"cycles_detected\": 0,\n    \"cycles\": []\n  }\n}\n```\n\n##### Coverage Analysis\nTest coverage statistics.\n\n```json\n{\n  \"analysis_type\": \"coverage\",\n  \"coverage_results\": {\n    \"total_elements\": 1,\n    \"covered_elements\": 1,\n    \"uncovered_elements\": 0,\n    \"coverage_percentage\": 85.5,\n    \"at_risk_count\": 2,\n    \"at_risk_elements\": [\"@Fn/src/utils#helper\"]\n  }\n}\n```\n\n##### Complexity Analysis\nCode complexity metrics.\n\n```json\n{\n  \"analysis_type\": \"complexity\",\n  \"complexity_score\": 42.5,\n  \"complexity_category\": \"medium\"\n}\n```\n\n#### Performance\n- **Target:** < 500ms\n- **Typical:** 300-450ms\n\n#### Error Codes\n- `INVALID_REFERENCE` - Reference format invalid\n- `ANALYSIS_ERROR` - Analysis execution failed\n- `UNSUPPORTED_ANALYSIS` - Unknown analysis type\n\n---\n\n### Tool 3: Validate (`mcp__coderef__validate`)\n\n**Status:** \u2705 Fully Implemented\n\n#### Description\nValidate CodeRef2 reference format and structure. Supports single or multiple references.\n\n#### Input Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"reference\": {\n      \"type\": \"string\",\n      \"description\": \"Single reference to validate\"\n    },\n    \"references\": {\n      \"type\": \"array\",\n      \"description\": \"Multiple references to validate\",\n      \"items\": {\"type\": \"string\"}\n    },\n    \"validate_existence\": {\n      \"type\": \"boolean\",\n      \"description\": \"Check if element exists\",\n      \"default\": false\n    }\n  }\n}\n```\n\n**Note:** Provide either `reference` or `references`, not both.\n\n#### Output Schema\n\n```json\n{\n  \"status\": \"success\",\n  \"total_references\": 1,\n  \"valid_count\": 1,\n  \"invalid_count\": 0,\n  \"results\": [\n    {\n      \"reference\": \"@Fn/src/utils#calculate_total:42\",\n      \"status\": \"valid\",\n      \"is_valid\": true,\n      \"issues\": [\n        {\n          \"severity\": \"warning\",\n          \"code\": \"CUSTOM_METADATA\",\n          \"message\": \"Metadata not in standard categories\",\n          \"field\": \"metadata\",\n          \"suggestion\": \"Consider using standard categories\"\n        }\n      ],\n      \"validation_time_ms\": 2.3\n    }\n  ],\n  \"validation_status\": \"success\"\n}\n```\n\n#### Validation Rules\n\n1. **Format:** Must match `@Type/path#element:line{metadata}`\n2. **Type:** Must be valid designator (26 types)\n3. **Path:** Must contain valid path characters\n4. **Element:** Optional, must be identifier\n5. **Line:** Optional, must be positive integer\n6. **Metadata:** Optional, key:value pairs\n\n#### Severity Levels\n- `info` - Informational\n- `warning` - Potential issue\n- `error` - Validation failed\n- `critical` - Must fix\n\n#### Error Codes\n- `EMPTY_REFERENCE` - Reference is empty\n- `MALFORMED_REFERENCE` - Format doesn't match pattern\n- `INVALID_TYPE` - Type designator not recognized\n- `EMPTY_PATH` - Path is missing\n- `NEGATIVE_LINE` - Line number < 0\n- `INVALID_METADATA_FORMAT` - Metadata syntax error\n\n---\n\n### Tool 4: Batch Validate (`mcp__coderef__batch_validate`)\n\n**Status:** \u2705 Fully Implemented\n\n#### Description\nValidate multiple references efficiently (sequential or parallel).\n\n#### Input Schema\n\n```json\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"references\": {\n      \"type\": \"array\",\n      \"description\": \"References to validate\",\n      \"items\": {\"type\": \"string\"},\n      \"minItems\": 1\n    },\n    \"parallel\": {\n      \"type\": \"boolean\",\n      \"description\": \"Process in parallel\",\n      \"default\": true\n    },\n    \"max_workers\": {\n      \"type\": \"integer\",\n      \"description\": \"Max concurrent workers\",\n      \"default\": 5,\n      \"minimum\": 1,\n      \"maximum\": 20\n    },\n    \"timeout_ms\": {\n      \"type\": \"integer\",\n      \"description\": \"Batch timeout milliseconds\",\n      \"default\": 5000,\n      \"minimum\": 1000,\n      \"maximum\": 30000\n    }\n  },\n  \"required\": [\"references\"]\n}\n```\n\n#### Output Schema\n\n```json\n{\n  \"status\": \"success\",\n  \"total_items\": 100,\n  \"successful\": 98,\n  \"failed\": 2,\n  \"warnings\": 5,\n  \"results\": [\n    {\n      \"reference\": \"@Fn/src/a#func\",\n      \"status\": \"valid\",\n      \"is_valid\": true,\n      \"issue_count\": 0,\n      \"error_count\": 0,\n      \"warning_count\": 0\n    }\n  ],\n  \"summary\": {\n    \"success_rate\": 98.0,\n    \"average_validation_time_ms\": 2.1\n  },\n  \"batch_execution_time_ms\": 215.3\n}\n```\n\n#### Performance\n- **Sequential:** ~2-3ms per reference\n- **Parallel (5 workers):** ~20-30ms per reference\n- **Target for 100 items:** < 5000ms\n\n#### Optimization Tips\n- Use `parallel: true` for 50+ items\n- Increase `max_workers` for CPU-bound systems\n- Batch size 100-500 for optimal performance\n\n---\n\n### Tool 5 & 6: UDS Tools (Placeholder)\n\n**Status:** \u23f3 Deferred (P6.4-P6.5)\n\n#### Tool 5: UDS Compliance Check (`mcp__coderef__uds_compliance_check`)\n\n```json\n{\n  \"status\": \"pending\",\n  \"message\": \"UDS compliance checking implementation in P6.4\"\n}\n```\n\n#### Tool 6: Generate with UDS (`mcp__coderef__generate_with_uds`)\n\n```json\n{\n  \"status\": \"pending\",\n  \"message\": \"UDS-compliant generation implementation in P6.5\"\n}\n```\n\n---\n\n## Data Models\n\n### CodeRef2 Reference\n\n```typescript\n@Type/path#element:line{metadata}\n\n// Components:\nType: TypeDesignator        // One of 26 types (Fn, C, M, etc.)\npath: string                // File or module path\nelement?: string            // Optional element name\nline?: integer              // Optional line number\nmetadata?: {key: string}    // Optional metadata tags\n```\n\n### Element Metadata\n\n```typescript\n{\n  status?: \"active\" | \"deprecated\" | \"experimental\",\n  security?: \"public\" | \"internal\" | \"private\" | \"critical\",\n  performance?: \"fast\" | \"normal\" | \"slow\" | \"critical\",\n  complexity?: \"low\" | \"medium\" | \"high\" | \"critical\",\n  coverage?: \"0-100\" (percentage),\n  maintenance?: \"active\" | \"stable\" | \"deprecated\",\n  compatibility?: \"v1\" | \"v2\" | \"breaking\",\n  documentation?: \"complete\" | \"partial\" | \"minimal\"\n}\n```\n\n### Relationship Types\n\n```typescript\nenum RelationshipType {\n  IMPORTS = \"imports\",\n  CALLS = \"calls\",\n  DEPENDS_ON = \"depends-on\",\n  TESTS = \"tests\",\n  IMPLEMENTS = \"implements\",\n  EXTENDS = \"extends\",\n  CONTAINS = \"contains\",\n  REFERENCES = \"references\"\n}\n```\n\n### Type Designators (26 total)\n\n```typescript\nF        // File\nD        // Directory\nC        // Class\nFn       // Function\nCl       // Closure\nM        // Method\nP        // Property\nV        // Variable\nK        // Constant\nE        // Enum\nI        // Interface\nTr       // Trait\nMo       // Module\nPkg      // Package\nN        // Namespace\nTD       // Type Definition\nG        // Generic\nDec      // Decorator\nParam    // Parameter\nFd       // Field\nAttr     // Attribute\nTest     // Test Case\nFix      // Fixture\nMacro    // Macro\nAnn      // Annotation\nCustom   // Custom Type\n```\n\n---\n\n## Error Handling\n\n### Standard Error Response\n\n```json\n{\n  \"status\": \"error\",\n  \"error_code\": \"ERROR_CODE\",\n  \"message\": \"Human-readable error message\",\n  \"details\": {\n    \"field\": \"field_name\",\n    \"suggestion\": \"What to do about it\"\n  },\n  \"timestamp\": \"2024-01-15T10:30:45.123456\"\n}\n```\n\n### Error Categories\n\n#### Validation Errors (400)\n- `INVALID_REQUEST` - Invalid input parameters\n- `VALIDATION_ERROR` - Reference validation failed\n- `MALFORMED_REFERENCE` - Reference format invalid\n\n#### Execution Errors (500)\n- `QUERY_ERROR` - Query execution failed\n- `ANALYSIS_ERROR` - Analysis execution failed\n- `BATCH_VALIDATION_ERROR` - Batch processing failed\n- `TOOL_EXECUTION_ERROR` - General tool execution error\n\n#### Configuration Errors (500)\n- `UNKNOWN_TOOL` - Tool not found\n- `UNSUPPORTED_ANALYSIS` - Analysis type not supported\n\n---\n\n## Rate Limiting\n\n**Current:** No rate limiting\n\n### Planned Limits\n- 100 requests/second per client\n- 1000 elements per query\n- 500 elements per batch\n- 10 second timeout per request\n\n---\n\n## Examples\n\n### Example 1: Query Elements\n\n```python\nimport json\nfrom server import CodeRef2Server\n\nasync def example():\n    server = CodeRef2Server()\n\n    result = await server._handle_call_tool(\n        \"mcp__coderef__query\",\n        {\n            \"query\": \"@Fn/src/utils#*\",\n            \"limit\": 10,\n            \"include_metadata\": True\n        }\n    )\n\n    response = json.loads(result[0].text)\n    print(json.dumps(response, indent=2))\n```\n\n### Example 2: Analyze Impact\n\n```python\nresult = await server._handle_call_tool(\n    \"mcp__coderef__analyze\",\n    {\n        \"reference\": \"@Fn/src/core#main:100\",\n        \"analysis_type\": \"impact\",\n        \"depth\": 3\n    }\n)\n\nresponse = json.loads(result[0].text)\nprint(f\"Elements affected: {response['total_affected']}\")\nfor elem in response['affected_elements']:\n    print(f\"  - {elem['reference']} ({elem['impact_level']})\")\n```\n\n### Example 3: Batch Validate\n\n```python\nresult = await server._handle_call_tool(\n    \"mcp__coderef__batch_validate\",\n    {\n        \"references\": [\n            \"@Fn/src/a#func\",\n            \"@C/src/b#Class\",\n            \"invalid_ref\",\n            \"@F/src/config.py\"\n        ],\n        \"parallel\": True,\n        \"max_workers\": 4\n    }\n)\n\nresponse = json.loads(result[0].text)\nprint(f\"Success rate: {response['summary']['success_rate']}%\")\nfor result in response['results']:\n    status = \"\u2713\" if result['is_valid'] else \"\u2717\"\n    print(f\"  {status} {result['reference']}\")\n```\n\n---\n\n## Integration Guide\n\n### Using with Claude or Agents\n\n```json\n{\n  \"mcpServers\": {\n    \"coderef2\": {\n      \"command\": \"python\",\n      \"args\": [\"/path/to/server.py\"],\n      \"env\": {\n        \"CODEREF_LOG_LEVEL\": \"INFO\"\n      }\n    }\n  }\n}\n```\n\n### Direct Python Integration\n\n```python\nfrom server import get_server\nimport asyncio\n\nasync def main():\n    server = get_server()\n\n    # List tools\n    tools = await server._handle_list_tools()\n    print(f\"Available tools: {len(tools)}\")\n\n    # Health check\n    health = await server.health_check()\n    print(f\"Status: {health['status']}\")\n```\n\n---\n\n**API Version:** 1.0.0\n**Last Updated:** Phase 6 Implementation Complete\n",
      "word_count": 1705
    },
    "components": null,
    "readme": {
      "sections": {
        "coderef_mcp_service": "**Version:** 1.0.0\n**Status:** Production Ready\n**Components:** 6 MCP Tools, 281+ Baseline Elements, 150+ Integration Tests\n\n---",
        "overview": "CodeRef is an advanced **Model Context Protocol (MCP) service** for semantic code reference analysis and validation. It enables intelligent systems to:\n\n- **Query** code elements using semantic references (`@Type/path#element:line{metadata}`)\n- **Analyze** code impact, dependencies, and complexity through graph traversal\n- **Validate** reference format and structure with detailed error reporting\n- **Batch process** large datasets efficiently (parallel/sequential)\n\nCodeRef is part of the larger CodeRef ecosystem, providing a microservice that standalone systems can integrate for advanced code analysis capabilities.\n\n---",
        "architecture": "### Service Design\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      MCP Client Interface                \u2502\n\u2502  (Claude, Agents, External Systems)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 MCP Protocol\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      CodeRef MCP Server                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  6 MCP Tools + Schemas             \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 \u2705 Query Tool (Implemented)        \u2502 \u2502\n\u2502  \u2502 \u2705 Analyze Tool (Implemented)      \u2502 \u2502\n\u2502  \u2502 \u2705 Validate Tool (Implemented)     \u2502 \u2502\n\u2502  \u2502 \u2705 Batch Validate (Implemented)    \u2502 \u2502\n\u2502  \u2502 \u23f3 UDS Compliance (Placeholder)    \u2502 \u2502\n\u2502  \u2502 \u23f3 UDS Doc Generation (Placeholder)\u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Core Generators                         \u2502\n\u2502  \u2022 QueryEngine + ReferenceParser         \u2502\n\u2502  \u2022 DeepAnalysisEngine + Graph Traversal  \u2502\n\u2502  \u2022 ReferenceValidator + BatchProcessor   \u2502\n\u2502  \u2022 DocsClient (Fallback Support)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### Service Independence\n\n- **Standalone Service:** Runs independently as an MCP server (not embedded in coderef-system)\n- **Explicit Interfaces:** Uses explicit client interfaces (DocsClient, UDSClient) for inter-service communication\n- **Graceful Degradation:** Fallback implementations when external services are unavailable\n- **Python-based:** Built with Python 3.10+, MCP SDK, Pydantic\n\n---",
        "installation_&_setup": "### Prerequisites\n\n- Python 3.10+\n- pip or poetry\n\n### Installation\n\n```bash",
        "clone_or_download_the_service": "cd coderef-mcp",
        "install_dependencies": "pip install -r requirements.txt",
        "or_with_poetry": "poetry install\n```\n\n### Environment Setup\n\n```bash",
        "create_environment_file_(optional)": "cp .env.example .env",
        "configure_logging_(optional)": "export CODEREF_LOG_LEVEL=INFO\n```\n\n---",
        "usage": "### Starting the Server\n\n#### Option 1: Direct Python\n\n```bash\npython server.py\n```\n\n#### Option 2: MCP Configuration (Claude, Agents)\n\nIn your Claude configuration or agent setup:\n\n```json\n{\n  \"mcpServers\": {\n    \"coderef-mcp\": {\n      \"command\": \"python\",\n      \"args\": [\"/path/to/coderef-mcp/server.py\"]\n    }\n  }\n}\n```\n\n#### Option 3: Docker (Optional)\n\n```bash\ndocker build -t coderef-mcp .\ndocker run -p 8000:8000 coderef-mcp\n```\n\n### Verifying Installation\n\n```bash",
        "check_server_startup": "python server.py",
        "in_another_terminal,_verify_tools_are_registered": "python -c \"from server import get_server; s = get_server(); import asyncio; print(asyncio.run(s._handle_list_tools()))\"\n```\n\n---",
        "tools_reference": "### 1. Query Tool (`mcp__coderef__query`)\n\n**Purpose:** Find and retrieve CodeRef elements\n\n**Input:**\n```json\n{\n  \"query\": \"@Fn/src/utils#calculate_total:42\",\n  \"limit\": 100,\n  \"include_relationships\": true,\n  \"include_metadata\": true,\n  \"include_source\": false,\n  \"filter\": {\n    \"type_designators\": [\"Fn\", \"C\"],\n    \"path_pattern\": \"src/*\",\n    \"metadata_filters\": {\"status\": \"active\"}\n  }\n}\n```\n\n**Output:**\n```json\n{\n  \"status\": \"success\",\n  \"query\": \"@Fn/src/utils#calculate_total:42\",\n  \"total_count\": 1,\n  \"elements\": [\n    {\n      \"reference\": \"@Fn/src/utils#calculate_total:42\",\n      \"type_designator\": \"Fn\",\n      \"path\": \"src/utils\",\n      \"element\": \"calculate_total\",\n      \"line\": 42,\n      \"metadata\": {\"status\": \"active\", \"complexity\": \"medium\"},\n      \"has_relationships\": true,\n      \"test_coverage\": 85.5\n    }\n  ],\n  \"execution_time_ms\": 245.3\n}\n```\n\n**Performance:** < 500ms target\n\n---\n\n### 2. Analyze Tool (`mcp__coderef__analyze`)\n\n**Purpose:** Perform deep analysis (impact, coverage, complexity, etc.)\n\n**Input:**\n```json\n{\n  \"reference\": \"@Fn/src/core#main:100\",\n  \"analysis_type\": \"impact\",\n  \"depth\": 3,\n  \"include_test_impact\": true\n}\n```\n\n**Analysis Types:**\n- `impact`: Change impact analysis\n- `deep`: Full graph traversal with cycle detection\n- `coverage`: Test coverage analysis\n- `complexity`: Code complexity metrics\n\n**Output:**\n```json\n{\n  \"status\": \"success\",\n  \"reference\": \"@Fn/src/core#main:100\",\n  \"analysis_type\": \"impact\",\n  \"total_affected\": 12,\n  \"affected_elements\": [\n    {\n      \"reference\": \"@Fn/src/handler#process\",\n      \"element_type\": \"Fn\",\n      \"impact_level\": \"high\",\n      \"depth\": 1\n    }\n  ],\n  \"impact_summary\": {\"by_level\": {\"high\": 3, \"medium\": 5}},\n  \"execution_time_ms\": 342.1\n}\n```\n\n**Performance:** < 500ms target\n\n---\n\n### 3. Validate Tool (`mcp__coderef__validate`)\n\n**Purpose:** Validate reference format and structure\n\n**Input:**\n```json\n{\n  \"reference\": \"@Fn/src/utils#calculate_total:42{complexity:high}\",\n  \"validate_existence\": false\n}\n```\n\n**Output:**\n```json\n{\n  \"status\": \"success\",\n  \"total_references\": 1,\n  \"valid_count\": 1,\n  \"invalid_count\": 0,\n  \"results\": [\n    {\n      \"reference\": \"@Fn/src/utils#calculate_total:42\",\n      \"status\": \"valid\",\n      \"is_valid\": true,\n      \"issues\": []\n    }\n  ]\n}\n```\n\n---\n\n### 4. Batch Validate Tool (`mcp__coderef__batch_validate`)\n\n**Purpose:** Validate multiple references in batch (sequential or parallel)\n\n**Input:**\n```json\n{\n  \"references\": [\n    \"@Fn/src/a#func\",\n    \"@C/src/b#Class\",\n    \"invalid_ref\"\n  ],\n  \"parallel\": true,\n  \"max_workers\": 5,\n  \"timeout_ms\": 5000\n}\n```\n\n**Output:**\n```json\n{\n  \"status\": \"success\",\n  \"total_items\": 3,\n  \"successful\": 2,\n  \"failed\": 1,\n  \"warnings\": 0,\n  \"summary\": {\n    \"success_rate\": 66.67,\n    \"average_validation_time_ms\": 12.3\n  }\n}\n```\n\n**Performance:** < 5 seconds for 100 references\n\n---\n\n### 5-6. UDS Tools (Placeholder)\n\n**Status:** Deferred to P6.4-P6.5\n\n- `mcp__coderef__uds_compliance_check`: Compliance checking (not yet implemented)\n- `mcp__coderef__generate_with_uds`: Documentation generation (not yet implemented)\n\n---",
        "reference_syntax": "### CodeRef Reference Format\n\n```\n@Type/path#element:line{metadata}\n```\n\n**Components:**\n\n| Component | Required | Example | Description |\n|-----------|----------|---------|-------------|\n| `@Type` | \u2705 | `@Fn` | Type designator (26 types available) |\n| `/path` | \u2705 | `/src/utils.py` | File path or module path |\n| `#element` | \u2b55 | `#calculate_total` | Specific element name (optional) |\n| `:line` | \u2b55 | `:42` | Line number (optional) |\n| `{metadata}` | \u2b55 | `{complexity:high,status:active}` | Metadata tags (optional) |\n\n**Examples:**\n\n```\n@Fn/src/utils#calculate_total:42                  # Function with line\n@C/src/models#User                                # Class without line\n@F/src/config.py                                  # File only\n@M/src/service#execute:100{complexity:high}       # Method with metadata\n```\n\n### Type Designators (26 Total)\n\n| Code | Type | Example |\n|------|------|---------|\n| `F` | File | `@F/src/config.py` |\n| `D` | Directory | `@D/src/handlers` |\n| `C` | Class | `@C/src/models#User` |\n| `Fn` | Function | `@Fn/src/utils#process` |\n| `M` | Method | `@M/src/service#execute` |\n| `P` | Property | `@P/src/model#name` |\n| `V` | Variable | `@V/src/const#MAX_SIZE` |\n| `K` | Constant | `@K/src/config#API_KEY` |\n| ... | ... | 18 more types |\n\n---",
        "performance_characteristics": "| Operation | Target | Actual |\n|-----------|--------|--------|\n| Query single element | <500ms | ~245ms avg |\n| Analyze element | <500ms | ~342ms avg |\n| Validate single | <50ms | ~12ms avg |\n| Batch validate (100 items, parallel) | <5000ms | ~2300ms avg |\n\n---",
        "testing": "### Running Tests\n\n```bash",
        "unit_tests_(120+_tests)": "pytest tests/unit/ -v",
        "integration_tests_(150+_tests_on_281_baseline_elements)": "pytest tests/integration/ -v",
        "all_tests": "pytest tests/ -v --cov",
        "specific_test": "pytest tests/integration/test_full_system.py::TestQueryToolIntegration::test_query_all_function_elements -v\n```\n\n### Test Coverage\n\n- **Unit Tests:** 120+ tests across query, analysis, validation generators\n- **Integration Tests:** 150+ tests on 281 baseline elements\n- **End-to-End Tests:** Complete workflows combining all tools\n- **Performance Tests:** Validation of latency targets\n\n---",
        "configuration": "### Environment Variables\n\n```bash",
        "logging": "CODEREF_LOG_LEVEL=INFO              # DEBUG, INFO, WARNING, ERROR\nCODEREF_LOG_FORMAT=json             # json, text",
        "service": "CODEREF_SERVICE_NAME=coderef-mcp\nCODEREF_SERVICE_VERSION=1.0.0",
        "performance": "CODEREF_BATCH_WORKERS=5             # Max parallel workers\nCODEREF_BATCH_TIMEOUT_MS=5000       # Batch processing timeout\n```\n\n### Configuration Files\n\n- `constants.py`: Service constants, type designators, metadata categories\n- `logger_config.py`: Logging configuration with JSON formatter\n- `pyproject.toml`: Project dependencies and metadata\n\n---",
        "deployment": "### Production Checklist\n\n- [ ] Dependencies installed: `pip install -r requirements.txt`\n- [ ] Unit tests passing: `pytest tests/unit/ -v`\n- [ ] Integration tests passing: `pytest tests/integration/ -v`\n- [ ] All 6 tools registered and operational\n- [ ] Health check passing: `curl http://localhost:8000/health`\n- [ ] Performance targets met on production data\n- [ ] Logging enabled for monitoring\n- [ ] Error handling tested with invalid inputs\n\n### Health Check\n\n```bash\npython -c \"from server import get_server; import asyncio; s = get_server(); \\\nprint(asyncio.run(s.health_check()))\"\n```\n\nExpected output:\n```json\n{\n  \"status\": \"healthy\",\n  \"service\": \"coderef-mcp\",\n  \"version\": \"1.0.0\",\n  \"tools_available\": 6,\n  \"timestamp\": \"2024-01-15T10:30:45.123456\"\n}\n```\n\n---",
        "architecture_notes": "### Design Decisions\n\n1. **Independent Service:** Runs as separate MCP server, not embedded in coderef-system\n2. **Explicit Clients:** Uses documented client interfaces (DocsClient) rather than direct imports\n3. **Async-First:** All tools support async/await for non-blocking operation\n4. **Graceful Degradation:** Fallback modes when external services unavailable\n5. **Modular Generators:** Separate generators for queries, analysis, validation\n6. **Singleton Pattern:** Server and tool executors use singleton for state management\n\n### Module Organization\n\n```\ncoderef-mcp/\n\u251c\u2500\u2500 coderef/\n\u2502   \u251c\u2500\u2500 __init__.py              # Package exports\n\u2502   \u251c\u2500\u2500 models.py                # 26+ Pydantic models\n\u2502   \u251c\u2500\u2500 clients/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 docs_client.py       # Explicit DocsClient interface\n\u2502   \u251c\u2500\u2500 generators/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 query_generator.py   # Query engine with reference parsing\n\u2502   \u2502   \u251c\u2500\u2500 analysis_generator.py # Graph traversal & analysis\n\u2502   \u2502   \u2514\u2500\u2500 validation_generator.py # Reference validation\n\u2502   \u2514\u2500\u2500 utils/\n\u2502       \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 server.py                     # MCP server with 6 tools\n\u251c\u2500\u2500 tool_handlers.py             # Tool handler implementations\n\u251c\u2500\u2500 constants.py                 # Service constants\n\u251c\u2500\u2500 error_responses.py           # Error factory\n\u251c\u2500\u2500 logger_config.py             # Logging setup\n\u251c\u2500\u2500 pyproject.toml               # Dependencies\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 unit/                    # 120+ unit tests\n\u2502   \u251c\u2500\u2500 integration/             # 150+ integration tests\n\u2502   \u2514\u2500\u2500 performance/             # Performance benchmarks\n\u2514\u2500\u2500 README.md                     # This file\n```\n\n---",
        "troubleshooting": "### Issue: \"Unknown tool\" error\n\n**Solution:** Ensure all tools are registered in `tool_handlers.py` and server is properly initialized.\n\n```bash\npython -c \"from tool_handlers import TOOL_HANDLERS; print(TOOL_HANDLERS.keys())\"\n```\n\n### Issue: Reference validation always passes invalid references\n\n**Solution:** Check `ReferenceValidator` configuration in `validation_generator.py`. Ensure pattern matches CodeRef format.\n\n### Issue: Slow performance on batch operations\n\n**Solution:** Increase `max_workers` or switch to parallel mode:\n\n```json\n{\n  \"references\": [...],\n  \"parallel\": true,\n  \"max_workers\": 10\n}\n```\n\n---",
        "contributing": "### Adding a New Tool\n\n1. Define tool schema in `server.py` (`TOOL_SCHEMAS`)\n2. Implement handler in `tool_handlers.py`\n3. Register handler in `TOOL_HANDLERS` dict\n4. Add unit tests in `tests/unit/`\n5. Add integration tests in `tests/integration/`\n\n---",
        "license": "Part of the CodeRef ecosystem. See main repository for license details.\n\n---",
        "support": "For issues, questions, or contributions:\n- Check existing tests for usage examples\n- Review tool input/output specifications above\n- Consult module docstrings for implementation details\n\n---\n\n**Last Updated:** Phase 6 Implementation Complete\n**Status:** Production Ready - All 4 main tools fully operational"
      },
      "full_content": "# CodeRef MCP Service\n\n**Version:** 1.0.0\n**Status:** Production Ready\n**Components:** 6 MCP Tools, 281+ Baseline Elements, 150+ Integration Tests\n\n---\n\n## Overview\n\nCodeRef is an advanced **Model Context Protocol (MCP) service** for semantic code reference analysis and validation. It enables intelligent systems to:\n\n- **Query** code elements using semantic references (`@Type/path#element:line{metadata}`)\n- **Analyze** code impact, dependencies, and complexity through graph traversal\n- **Validate** reference format and structure with detailed error reporting\n- **Batch process** large datasets efficiently (parallel/sequential)\n\nCodeRef is part of the larger CodeRef ecosystem, providing a microservice that standalone systems can integrate for advanced code analysis capabilities.\n\n---\n\n## Architecture\n\n### Service Design\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      MCP Client Interface                \u2502\n\u2502  (Claude, Agents, External Systems)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502 MCP Protocol\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      CodeRef MCP Server                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  6 MCP Tools + Schemas             \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 \u2705 Query Tool (Implemented)        \u2502 \u2502\n\u2502  \u2502 \u2705 Analyze Tool (Implemented)      \u2502 \u2502\n\u2502  \u2502 \u2705 Validate Tool (Implemented)     \u2502 \u2502\n\u2502  \u2502 \u2705 Batch Validate (Implemented)    \u2502 \u2502\n\u2502  \u2502 \u23f3 UDS Compliance (Placeholder)    \u2502 \u2502\n\u2502  \u2502 \u23f3 UDS Doc Generation (Placeholder)\u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Core Generators                         \u2502\n\u2502  \u2022 QueryEngine + ReferenceParser         \u2502\n\u2502  \u2022 DeepAnalysisEngine + Graph Traversal  \u2502\n\u2502  \u2022 ReferenceValidator + BatchProcessor   \u2502\n\u2502  \u2022 DocsClient (Fallback Support)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### Service Independence\n\n- **Standalone Service:** Runs independently as an MCP server (not embedded in coderef-system)\n- **Explicit Interfaces:** Uses explicit client interfaces (DocsClient, UDSClient) for inter-service communication\n- **Graceful Degradation:** Fallback implementations when external services are unavailable\n- **Python-based:** Built with Python 3.10+, MCP SDK, Pydantic\n\n---\n\n## Installation & Setup\n\n### Prerequisites\n\n- Python 3.10+\n- pip or poetry\n\n### Installation\n\n```bash\n# Clone or download the service\ncd coderef-mcp\n\n# Install dependencies\npip install -r requirements.txt\n\n# Or with poetry\npoetry install\n```\n\n### Environment Setup\n\n```bash\n# Create environment file (optional)\ncp .env.example .env\n\n# Configure logging (optional)\nexport CODEREF_LOG_LEVEL=INFO\n```\n\n---\n\n## Usage\n\n### Starting the Server\n\n#### Option 1: Direct Python\n\n```bash\npython server.py\n```\n\n#### Option 2: MCP Configuration (Claude, Agents)\n\nIn your Claude configuration or agent setup:\n\n```json\n{\n  \"mcpServers\": {\n    \"coderef-mcp\": {\n      \"command\": \"python\",\n      \"args\": [\"/path/to/coderef-mcp/server.py\"]\n    }\n  }\n}\n```\n\n#### Option 3: Docker (Optional)\n\n```bash\ndocker build -t coderef-mcp .\ndocker run -p 8000:8000 coderef-mcp\n```\n\n### Verifying Installation\n\n```bash\n# Check server startup\npython server.py\n\n# In another terminal, verify tools are registered\npython -c \"from server import get_server; s = get_server(); import asyncio; print(asyncio.run(s._handle_list_tools()))\"\n```\n\n---\n\n## Tools Reference\n\n### 1. Query Tool (`mcp__coderef__query`)\n\n**Purpose:** Find and retrieve CodeRef elements\n\n**Input:**\n```json\n{\n  \"query\": \"@Fn/src/utils#calculate_total:42\",\n  \"limit\": 100,\n  \"include_relationships\": true,\n  \"include_metadata\": true,\n  \"include_source\": false,\n  \"filter\": {\n    \"type_designators\": [\"Fn\", \"C\"],\n    \"path_pattern\": \"src/*\",\n    \"metadata_filters\": {\"status\": \"active\"}\n  }\n}\n```\n\n**Output:**\n```json\n{\n  \"status\": \"success\",\n  \"query\": \"@Fn/src/utils#calculate_total:42\",\n  \"total_count\": 1,\n  \"elements\": [\n    {\n      \"reference\": \"@Fn/src/utils#calculate_total:42\",\n      \"type_designator\": \"Fn\",\n      \"path\": \"src/utils\",\n      \"element\": \"calculate_total\",\n      \"line\": 42,\n      \"metadata\": {\"status\": \"active\", \"complexity\": \"medium\"},\n      \"has_relationships\": true,\n      \"test_coverage\": 85.5\n    }\n  ],\n  \"execution_time_ms\": 245.3\n}\n```\n\n**Performance:** < 500ms target\n\n---\n\n### 2. Analyze Tool (`mcp__coderef__analyze`)\n\n**Purpose:** Perform deep analysis (impact, coverage, complexity, etc.)\n\n**Input:**\n```json\n{\n  \"reference\": \"@Fn/src/core#main:100\",\n  \"analysis_type\": \"impact\",\n  \"depth\": 3,\n  \"include_test_impact\": true\n}\n```\n\n**Analysis Types:**\n- `impact`: Change impact analysis\n- `deep`: Full graph traversal with cycle detection\n- `coverage`: Test coverage analysis\n- `complexity`: Code complexity metrics\n\n**Output:**\n```json\n{\n  \"status\": \"success\",\n  \"reference\": \"@Fn/src/core#main:100\",\n  \"analysis_type\": \"impact\",\n  \"total_affected\": 12,\n  \"affected_elements\": [\n    {\n      \"reference\": \"@Fn/src/handler#process\",\n      \"element_type\": \"Fn\",\n      \"impact_level\": \"high\",\n      \"depth\": 1\n    }\n  ],\n  \"impact_summary\": {\"by_level\": {\"high\": 3, \"medium\": 5}},\n  \"execution_time_ms\": 342.1\n}\n```\n\n**Performance:** < 500ms target\n\n---\n\n### 3. Validate Tool (`mcp__coderef__validate`)\n\n**Purpose:** Validate reference format and structure\n\n**Input:**\n```json\n{\n  \"reference\": \"@Fn/src/utils#calculate_total:42{complexity:high}\",\n  \"validate_existence\": false\n}\n```\n\n**Output:**\n```json\n{\n  \"status\": \"success\",\n  \"total_references\": 1,\n  \"valid_count\": 1,\n  \"invalid_count\": 0,\n  \"results\": [\n    {\n      \"reference\": \"@Fn/src/utils#calculate_total:42\",\n      \"status\": \"valid\",\n      \"is_valid\": true,\n      \"issues\": []\n    }\n  ]\n}\n```\n\n---\n\n### 4. Batch Validate Tool (`mcp__coderef__batch_validate`)\n\n**Purpose:** Validate multiple references in batch (sequential or parallel)\n\n**Input:**\n```json\n{\n  \"references\": [\n    \"@Fn/src/a#func\",\n    \"@C/src/b#Class\",\n    \"invalid_ref\"\n  ],\n  \"parallel\": true,\n  \"max_workers\": 5,\n  \"timeout_ms\": 5000\n}\n```\n\n**Output:**\n```json\n{\n  \"status\": \"success\",\n  \"total_items\": 3,\n  \"successful\": 2,\n  \"failed\": 1,\n  \"warnings\": 0,\n  \"summary\": {\n    \"success_rate\": 66.67,\n    \"average_validation_time_ms\": 12.3\n  }\n}\n```\n\n**Performance:** < 5 seconds for 100 references\n\n---\n\n### 5-6. UDS Tools (Placeholder)\n\n**Status:** Deferred to P6.4-P6.5\n\n- `mcp__coderef__uds_compliance_check`: Compliance checking (not yet implemented)\n- `mcp__coderef__generate_with_uds`: Documentation generation (not yet implemented)\n\n---\n\n## Reference Syntax\n\n### CodeRef Reference Format\n\n```\n@Type/path#element:line{metadata}\n```\n\n**Components:**\n\n| Component | Required | Example | Description |\n|-----------|----------|---------|-------------|\n| `@Type` | \u2705 | `@Fn` | Type designator (26 types available) |\n| `/path` | \u2705 | `/src/utils.py` | File path or module path |\n| `#element` | \u2b55 | `#calculate_total` | Specific element name (optional) |\n| `:line` | \u2b55 | `:42` | Line number (optional) |\n| `{metadata}` | \u2b55 | `{complexity:high,status:active}` | Metadata tags (optional) |\n\n**Examples:**\n\n```\n@Fn/src/utils#calculate_total:42                  # Function with line\n@C/src/models#User                                # Class without line\n@F/src/config.py                                  # File only\n@M/src/service#execute:100{complexity:high}       # Method with metadata\n```\n\n### Type Designators (26 Total)\n\n| Code | Type | Example |\n|------|------|---------|\n| `F` | File | `@F/src/config.py` |\n| `D` | Directory | `@D/src/handlers` |\n| `C` | Class | `@C/src/models#User` |\n| `Fn` | Function | `@Fn/src/utils#process` |\n| `M` | Method | `@M/src/service#execute` |\n| `P` | Property | `@P/src/model#name` |\n| `V` | Variable | `@V/src/const#MAX_SIZE` |\n| `K` | Constant | `@K/src/config#API_KEY` |\n| ... | ... | 18 more types |\n\n---\n\n## Performance Characteristics\n\n| Operation | Target | Actual |\n|-----------|--------|--------|\n| Query single element | <500ms | ~245ms avg |\n| Analyze element | <500ms | ~342ms avg |\n| Validate single | <50ms | ~12ms avg |\n| Batch validate (100 items, parallel) | <5000ms | ~2300ms avg |\n\n---\n\n## Testing\n\n### Running Tests\n\n```bash\n# Unit tests (120+ tests)\npytest tests/unit/ -v\n\n# Integration tests (150+ tests on 281 baseline elements)\npytest tests/integration/ -v\n\n# All tests\npytest tests/ -v --cov\n\n# Specific test\npytest tests/integration/test_full_system.py::TestQueryToolIntegration::test_query_all_function_elements -v\n```\n\n### Test Coverage\n\n- **Unit Tests:** 120+ tests across query, analysis, validation generators\n- **Integration Tests:** 150+ tests on 281 baseline elements\n- **End-to-End Tests:** Complete workflows combining all tools\n- **Performance Tests:** Validation of latency targets\n\n---\n\n## Configuration\n\n### Environment Variables\n\n```bash\n# Logging\nCODEREF_LOG_LEVEL=INFO              # DEBUG, INFO, WARNING, ERROR\nCODEREF_LOG_FORMAT=json             # json, text\n\n# Service\nCODEREF_SERVICE_NAME=coderef-mcp\nCODEREF_SERVICE_VERSION=1.0.0\n\n# Performance\nCODEREF_BATCH_WORKERS=5             # Max parallel workers\nCODEREF_BATCH_TIMEOUT_MS=5000       # Batch processing timeout\n```\n\n### Configuration Files\n\n- `constants.py`: Service constants, type designators, metadata categories\n- `logger_config.py`: Logging configuration with JSON formatter\n- `pyproject.toml`: Project dependencies and metadata\n\n---\n\n## Deployment\n\n### Production Checklist\n\n- [ ] Dependencies installed: `pip install -r requirements.txt`\n- [ ] Unit tests passing: `pytest tests/unit/ -v`\n- [ ] Integration tests passing: `pytest tests/integration/ -v`\n- [ ] All 6 tools registered and operational\n- [ ] Health check passing: `curl http://localhost:8000/health`\n- [ ] Performance targets met on production data\n- [ ] Logging enabled for monitoring\n- [ ] Error handling tested with invalid inputs\n\n### Health Check\n\n```bash\npython -c \"from server import get_server; import asyncio; s = get_server(); \\\nprint(asyncio.run(s.health_check()))\"\n```\n\nExpected output:\n```json\n{\n  \"status\": \"healthy\",\n  \"service\": \"coderef-mcp\",\n  \"version\": \"1.0.0\",\n  \"tools_available\": 6,\n  \"timestamp\": \"2024-01-15T10:30:45.123456\"\n}\n```\n\n---\n\n## Architecture Notes\n\n### Design Decisions\n\n1. **Independent Service:** Runs as separate MCP server, not embedded in coderef-system\n2. **Explicit Clients:** Uses documented client interfaces (DocsClient) rather than direct imports\n3. **Async-First:** All tools support async/await for non-blocking operation\n4. **Graceful Degradation:** Fallback modes when external services unavailable\n5. **Modular Generators:** Separate generators for queries, analysis, validation\n6. **Singleton Pattern:** Server and tool executors use singleton for state management\n\n### Module Organization\n\n```\ncoderef-mcp/\n\u251c\u2500\u2500 coderef/\n\u2502   \u251c\u2500\u2500 __init__.py              # Package exports\n\u2502   \u251c\u2500\u2500 models.py                # 26+ Pydantic models\n\u2502   \u251c\u2500\u2500 clients/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2514\u2500\u2500 docs_client.py       # Explicit DocsClient interface\n\u2502   \u251c\u2500\u2500 generators/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 query_generator.py   # Query engine with reference parsing\n\u2502   \u2502   \u251c\u2500\u2500 analysis_generator.py # Graph traversal & analysis\n\u2502   \u2502   \u2514\u2500\u2500 validation_generator.py # Reference validation\n\u2502   \u2514\u2500\u2500 utils/\n\u2502       \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 server.py                     # MCP server with 6 tools\n\u251c\u2500\u2500 tool_handlers.py             # Tool handler implementations\n\u251c\u2500\u2500 constants.py                 # Service constants\n\u251c\u2500\u2500 error_responses.py           # Error factory\n\u251c\u2500\u2500 logger_config.py             # Logging setup\n\u251c\u2500\u2500 pyproject.toml               # Dependencies\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 unit/                    # 120+ unit tests\n\u2502   \u251c\u2500\u2500 integration/             # 150+ integration tests\n\u2502   \u2514\u2500\u2500 performance/             # Performance benchmarks\n\u2514\u2500\u2500 README.md                     # This file\n```\n\n---\n\n## Troubleshooting\n\n### Issue: \"Unknown tool\" error\n\n**Solution:** Ensure all tools are registered in `tool_handlers.py` and server is properly initialized.\n\n```bash\npython -c \"from tool_handlers import TOOL_HANDLERS; print(TOOL_HANDLERS.keys())\"\n```\n\n### Issue: Reference validation always passes invalid references\n\n**Solution:** Check `ReferenceValidator` configuration in `validation_generator.py`. Ensure pattern matches CodeRef format.\n\n### Issue: Slow performance on batch operations\n\n**Solution:** Increase `max_workers` or switch to parallel mode:\n\n```json\n{\n  \"references\": [...],\n  \"parallel\": true,\n  \"max_workers\": 10\n}\n```\n\n---\n\n## Contributing\n\n### Adding a New Tool\n\n1. Define tool schema in `server.py` (`TOOL_SCHEMAS`)\n2. Implement handler in `tool_handlers.py`\n3. Register handler in `TOOL_HANDLERS` dict\n4. Add unit tests in `tests/unit/`\n5. Add integration tests in `tests/integration/`\n\n---\n\n## License\n\nPart of the CodeRef ecosystem. See main repository for license details.\n\n---\n\n## Support\n\nFor issues, questions, or contributions:\n- Check existing tests for usage examples\n- Review tool input/output specifications above\n- Consult module docstrings for implementation details\n\n---\n\n**Last Updated:** Phase 6 Implementation Complete\n**Status:** Production Ready - All 4 main tools fully operational\n",
      "word_count": 1585
    }
  },
  "coderef": {
    "available": true,
    "element_count": 19092,
    "has_graph": true,
    "auto_scan_attempted": true,
    "auto_scan_performed": false,
    "auto_scan_success": true
  },
  "_metadata": {
    "generated_at": "2025-12-23T17:48:20.516082",
    "generator": "coderef_foundation_generator",
    "version": "2.0.0"
  }
}