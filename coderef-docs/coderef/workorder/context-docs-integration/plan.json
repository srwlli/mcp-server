{
  "META_DOCUMENTATION": {
    "version": "1.0.0",
    "created": "2025-12-27T00:00:00Z",
    "workorder_id": "WO-CONTEXT-DOCS-INTEGRATION-001",
    "feature_name": "context-docs-integration",
    "project": "coderef-docs",
    "status": "planning_complete",
    "priority": "P1",
    "phase_count": 3,
    "task_count": 9,
    "multi_agent": false,
    "estimated_duration_hours": "6-8",
    "source": "PHASE-3-ROADMAP-SYNTHESIS.md (Critical #4)"
  },

  "0_PREPARATION": {
    "analysis_date": "2025-12-27",
    "key_findings": [
      "coderef-docs currently returns placeholder templates for API.md, SCHEMA.md, COMPONENTS.md",
      "coderef-context has 10 tools available: scan, query, impact, complexity, patterns, coverage, context, validate, drift, diagram",
      "Both servers scan code patterns independently - duplication of effort",
      "No integration between servers - docs are static, not code-aware",
      "High ROI opportunity: 2-3 hours of manual doc work → seconds with integration"
    ],
    "existing_foundation": {
      "coderef_context": "✅ Complete - 10 tools available, AST-based analysis",
      "coderef_docs": "✅ Complete - template system ready, just needs intelligence layer",
      "integration_point": "generate_individual_doc() function in server.py"
    },
    "risks_identified": [
      "coderef-context CLI unavailable → needs graceful degradation",
      "Large token usage if coderef-context returns verbose results → need result filtering",
      "API.md, SCHEMA.md, COMPONENTS.md structure mismatch → need data transformation"
    ],
    "similar_features": "None - this is foundational integration work"
  },

  "1_EXECUTIVE_SUMMARY": {
    "problem": "coderef-docs generates placeholder documentation. Users must manually write API.md, SCHEMA.md, COMPONENTS.md with real implementation details.",
    "solution": "Call coderef-context from generate_individual_doc() to extract code intelligence and auto-populate documentation with actual API endpoints, database schemas, and component definitions.",
    "impact": "90% reduction in manual documentation time (6+ hours → 30 minutes)",
    "scope": "3 phases: Setup (1h) + Integration (3-4h) + Testing (2-3h)",
    "deliverables": [
      "Modified server.py with coderef-context integration",
      "API extraction logic for API.md auto-generation",
      "Schema extraction logic for SCHEMA.md auto-generation",
      "Component extraction logic for COMPONENTS.md auto-generation",
      "Error handling + graceful degradation",
      "Unit tests + integration tests with coderef-context calls"
    ]
  },

  "2_RISK_ASSESSMENT": {
    "breaking_changes": "None - maintains backward compatibility. Users without coderef-context still get working docs.",
    "security": "Low risk - coderef-context is internal MCP server, not public API. No auth changes needed.",
    "performance": "Medium risk - coderef-context calls add latency (120s timeout). Need result caching + memoization.",
    "maintainability": "Low risk - clean integration point (generate_individual_doc), isolated changes",
    "reversibility": "High - can remove coderef-context calls easily, falls back to placeholders",
    "overall_risk": "LOW - Well-scoped, isolated changes, clear integration point, no breaking changes"
  },

  "3_CURRENT_STATE_ANALYSIS": {
    "architecture": {
      "current": "coderef-docs is standalone - generates docs from templates alone",
      "target": "coderef-docs calls coderef-context for code intelligence before populating templates",
      "integration_pattern": "Loose coupling via MCP - coderef-docs calls coderef-context tools, handles failures"
    },
    "patterns_to_reuse": [
      "Tool invocation pattern from coderef-context's own server.py",
      "Error handling from existing coderef-docs code",
      "Result transformation from generate_docs workflow",
      "Caching pattern if implemented in coderef-context"
    ],
    "constraints": [
      "Cannot modify coderef-context (external server)",
      "Must maintain coderef-docs' existing API",
      "Must handle coderef-context unavailability gracefully"
    ]
  },

  "4_KEY_FEATURES": {
    "feature_1_api_extraction": {
      "name": "API.md Auto-Generation",
      "description": "Call coderef-context to extract API endpoint signatures and auto-populate API.md template",
      "inputs": "project_path, template_name='api'",
      "outputs": "API.md with real endpoints (or placeholder if extraction fails)",
      "how_it_works": "1. Call coderef_context.coderef_query('api') to get all API endpoints 2. Transform results to markdown table format 3. Insert into API.md template",
      "success_criteria": "API.md contains ≥2 real endpoints per project, properly formatted"
    },
    "feature_2_schema_extraction": {
      "name": "SCHEMA.md Auto-Generation",
      "description": "Call coderef-context to extract database entities and auto-populate SCHEMA.md template",
      "inputs": "project_path, template_name='schema'",
      "outputs": "SCHEMA.md with real entities (or placeholder if extraction fails)",
      "how_it_works": "1. Call coderef_context.coderef_scan() to find models/schema files 2. Extract entity definitions 3. Transform to entity relationship diagram 4. Insert into SCHEMA.md template",
      "success_criteria": "SCHEMA.md contains ≥2 real entities with relationships, properly formatted"
    },
    "feature_3_components_extraction": {
      "name": "COMPONENTS.md Auto-Generation",
      "description": "Call coderef-context to extract component definitions and auto-populate COMPONENTS.md template",
      "inputs": "project_path, template_name='components'",
      "outputs": "COMPONENTS.md with real components (or placeholder if extraction fails)",
      "how_it_works": "1. Call coderef_context.coderef_scan() looking for component files (*.tsx, *.jsx, .vue) 2. Extract component tree/hierarchy 3. Transform to hierarchy format 4. Insert into COMPONENTS.md template",
      "success_criteria": "COMPONENTS.md contains real component hierarchy, properly formatted"
    },
    "feature_4_error_handling": {
      "name": "Graceful Degradation",
      "description": "Handle coderef-context unavailability without breaking doc generation",
      "inputs": "Any coderef-context call that fails",
      "outputs": "Falls back to placeholder template, logs warning",
      "how_it_works": "1. Try coderef-context call with timeout 2. Catch exception 3. Return placeholder docs 4. Log warning to user",
      "success_criteria": "Doc generation succeeds even if coderef-context unavailable"
    },
    "feature_5_backward_compat": {
      "name": "Backward Compatibility",
      "description": "Existing doc generation features continue to work unchanged",
      "inputs": "All existing generate_individual_doc calls",
      "outputs": "Same output format as before (markdown files)",
      "how_it_works": "New coderef-context integration is optional enhancement. If coderef-context returns nothing, falls back to template placeholders.",
      "success_criteria": "All existing tests passing, no behavior change for users without coderef-context"
    }
  },

  "5_TASK_ID_SYSTEM": {
    "format": "{PHASE}-{NUMBER}: {Description}",
    "phases": {
      "SETUP": "Preparation and integration point setup",
      "INTEGRATE": "Call coderef-context from generate_individual_doc",
      "TEST": "Unit tests + integration tests"
    },
    "example_task": "SETUP-001: Import coderef-context client library",
    "task_dependencies": "SETUP-* must complete before INTEGRATE-* must complete before TEST-*"
  },

  "6_IMPLEMENTATION_PHASES": {
    "phase_1_setup": {
      "name": "Setup & Integration Point",
      "duration_hours": 1,
      "tasks": [
        {
          "id": "SETUP-001",
          "title": "Import coderef-context client",
          "description": "Add imports for coderef-context MCP client library to coderef-docs/server.py",
          "effort_hours": 0.25,
          "dependencies": []
        },
        {
          "id": "SETUP-002",
          "title": "Add coderef-context health check",
          "description": "Verify coderef-context server is available at startup, set graceful-degradation flag if not",
          "effort_hours": 0.25,
          "dependencies": ["SETUP-001"]
        },
        {
          "id": "SETUP-003",
          "title": "Create extract_* functions",
          "description": "Create extract_apis(), extract_schemas(), extract_components() functions in src/ that call coderef-context",
          "effort_hours": 1,
          "dependencies": ["SETUP-002"]
        }
      ],
      "success_criteria": [
        "coderef-context client importable",
        "Health check runs at startup",
        "Three extract functions stubbed with error handling"
      ]
    },
    "phase_2_integration": {
      "name": "Integration with generate_individual_doc",
      "duration_hours": 3.5,
      "tasks": [
        {
          "id": "INTEGRATE-001",
          "title": "Implement API extraction logic",
          "description": "Extract API endpoints from coderef-context via coderef_query('api'), transform to markdown table for API.md",
          "effort_hours": 1,
          "dependencies": ["SETUP-003"]
        },
        {
          "id": "INTEGRATE-002",
          "title": "Implement SCHEMA extraction logic",
          "description": "Extract database schemas from coderef-context via coderef_scan(), transform to entity relationship format for SCHEMA.md",
          "effort_hours": 1,
          "dependencies": ["SETUP-003"]
        },
        {
          "id": "INTEGRATE-003",
          "title": "Implement COMPONENTS extraction logic",
          "description": "Extract component definitions from coderef-context via coderef_scan(), transform to hierarchy format for COMPONENTS.md",
          "effort_hours": 1,
          "dependencies": ["SETUP-003"]
        },
        {
          "id": "INTEGRATE-004",
          "title": "Add error handling + result caching",
          "description": "Wrap all coderef-context calls with try/except, add memoization for same-session calls, graceful fallback to placeholders",
          "effort_hours": 0.5,
          "dependencies": ["INTEGRATE-001", "INTEGRATE-002", "INTEGRATE-003"]
        }
      ],
      "success_criteria": [
        "API.md populated with real endpoints when coderef-context available",
        "SCHEMA.md populated with real entities when coderef-context available",
        "COMPONENTS.md populated with real components when coderef-context available",
        "Graceful fallback to placeholders if coderef-context unavailable",
        "No breaking changes to existing doc generation"
      ]
    },
    "phase_3_testing": {
      "name": "Testing & Validation",
      "duration_hours": 2.5,
      "tasks": [
        {
          "id": "TEST-001",
          "title": "Unit tests for extract_* functions",
          "description": "Mock coderef-context calls, test transform logic, test error handling",
          "effort_hours": 1,
          "dependencies": ["INTEGRATE-004"]
        },
        {
          "id": "TEST-002",
          "title": "Integration tests with real coderef-context",
          "description": "Test actual coderef-context calls, verify doc output format, test with sample projects",
          "effort_hours": 0.75,
          "dependencies": ["TEST-001"]
        },
        {
          "id": "TEST-003",
          "title": "Verify backward compatibility",
          "description": "Run all existing coderef-docs tests, ensure no regressions",
          "effort_hours": 0.75,
          "dependencies": ["TEST-002"]
        }
      ],
      "success_criteria": [
        "All unit tests passing",
        "All integration tests passing",
        "All existing tests still passing",
        "Doc output matches expected format"
      ]
    }
  },

  "7_TESTING_STRATEGY": {
    "unit_tests": {
      "scope": "extract_apis(), extract_schemas(), extract_components() with mocked coderef-context calls",
      "files": "tests/test_integration_context_docs.py",
      "approach": "Mock coderef-context, test transformation logic independently",
      "coverage_target": ">90%"
    },
    "integration_tests": {
      "scope": "Real coderef-context calls via generate_individual_doc()",
      "files": "tests/integration/test_context_docs_integration.py",
      "approach": "Test with sample projects, verify doc output format",
      "coverage_target": "All 3 doc types (API.md, SCHEMA.md, COMPONENTS.md)"
    },
    "regression_tests": {
      "scope": "All existing coderef-docs functionality",
      "files": "Existing test suite",
      "approach": "Run full test suite before/after changes",
      "coverage_target": "100% of existing tests still passing"
    },
    "acceptance_criteria": "All tests passing, no breaking changes, docs accurately reflect code"
  },

  "8_SUCCESS_CRITERIA": {
    "functional": [
      "API.md contains real endpoint signatures extracted from coderef-context",
      "SCHEMA.md contains real entity definitions extracted from coderef-context",
      "COMPONENTS.md contains real component definitions extracted from coderef-context",
      "All extraction functions handle coderef-context unavailability gracefully",
      "Docs fallback to placeholders if coderef-context fails"
    ],
    "quality": [
      "All unit tests passing (≥90% coverage)",
      "All integration tests passing",
      "All existing coderef-docs tests still passing (no regressions)",
      "Code quality: mypy passes, black formatted, ruff clean"
    ],
    "performance": [
      "Doc generation latency acceptable (<10s per doc)",
      "coderef-context calls cached/memoized to avoid redundant calls",
      "Graceful timeout handling (120s max per call)"
    ],
    "integration": [
      "coderef-context health check at startup",
      "Proper error logging when coderef-context unavailable",
      "No dependencies added to coderef-docs (uses existing client)"
    ]
  },

  "9_IMPLEMENTATION_CHECKLIST": {
    "phase_1_setup": [
      "[ ] SETUP-001: Import coderef-context client library",
      "[ ] SETUP-002: Implement health check at startup",
      "[ ] SETUP-003: Create extract_apis(), extract_schemas(), extract_components() stubs"
    ],
    "phase_2_integration": [
      "[ ] INTEGRATE-001: Implement API endpoint extraction",
      "[ ] INTEGRATE-002: Implement database schema extraction",
      "[ ] INTEGRATE-003: Implement component definition extraction",
      "[ ] INTEGRATE-004: Add error handling + caching"
    ],
    "phase_3_testing": [
      "[ ] TEST-001: Write unit tests for extract_* functions",
      "[ ] TEST-002: Write integration tests with real coderef-context",
      "[ ] TEST-003: Verify backward compatibility with existing tests"
    ],
    "quality": [
      "[ ] Type checking: mypy src/ passes",
      "[ ] Code style: black formatted, ruff clean",
      "[ ] Coverage: ≥90% for new code",
      "[ ] Documentation: Added docstrings to new functions"
    ],
    "validation": [
      "[ ] All 3 doc types (API.md, SCHEMA.md, COMPONENTS.md) tested",
      "[ ] Graceful degradation tested (coderef-context unavailable)",
      "[ ] Backward compatibility verified (all existing tests pass)",
      "[ ] Performance acceptable (<10s per doc generation)"
    ]
  }
}
