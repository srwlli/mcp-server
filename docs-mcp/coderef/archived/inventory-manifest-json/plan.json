{
  "0_preparation": {
    "foundation_docs": {
      "available": [
        "README.md (root)",
        "API.md (coderef/foundation-docs)",
        "ARCHITECTURE.md (coderef/foundation-docs)",
        "COMPONENTS.md (coderef/foundation-docs)",
        "SCHEMA.md (coderef/foundation-docs)"
      ],
      "missing": []
    },
    "coding_standards": {
      "available": [
        "BEHAVIOR-STANDARDS.md",
        "UI-STANDARDS.md", 
        "UX-PATTERNS.md",
        "COMPONENT-INDEX.md"
      ],
      "missing": [
        "COMPONENT-PATTERN.md"
      ]
    },
    "reference_components": {
      "primary": "ChangelogGenerator - Similar JSON-based data management with schema validation",
      "secondary": [
        "FoundationGenerator - File generation and template processing",
        "StandardsGenerator - File analysis and pattern extraction"
      ]
    },
    "key_patterns_identified": [
      "All generators follow BaseGenerator pattern with template handling",
      "All MCP tools use handler registry pattern in tool_handlers.py",
      "JSON schema validation for data integrity (CHANGELOG.json pattern)",
      "Structured logging with security audit trails",
      "ErrorResponse factory for consistent error handling"
    ],
    "gaps_and_risks": [
      "No COMPONENT-PATTERN.md (will infer from existing generators)",
      "No test directory found (will create tests following existing patterns)"
    ]
  },
  "1_executive_summary": {
    "purpose": "Add inventory-manifest.json MCP tool to enable automated project file cataloging and analysis",
    "value_proposition": "Enables AI agents to automatically discover and catalog project files with metadata, supports project analysis workflows, provides structured inventory for documentation and maintenance",
    "real_world_analogy": "Like a librarian creating a comprehensive catalog of all books in a library - organizing files by type, size, purpose, and relationships",
    "use_case": "AI agent analyzes project → generates inventory manifest → uses manifest for documentation, refactoring, or maintenance tasks",
    "output": "New MCP tool (inventory_manifest), InventoryGenerator class, JSON schema for manifest validation, comprehensive test suite"
  },
  "2_risk_assessment": {
    "overall_risk": "medium",
    "complexity": "medium",
    "scope": "Medium - 8-12 files, affects generators module and MCP tool system",
    "risk_factors": {
      "file_system": "medium - Reads project files and directories, needs path traversal protection",
      "dependencies": "low - Uses existing patterns and libraries",
      "performance": "low - File system operations are lightweight",
      "security": "medium - File path validation needed to prevent directory traversal",
      "breaking_changes": "none - Purely additive feature"
    },
    "mitigation_strategies": [
      "Reuse existing path validation from BaseGenerator",
      "Follow established error handling patterns",
      "Use existing logging infrastructure for audit trails"
    ]
  },
  "3_current_state_analysis": {
    "affected_files": [
      "NEW: generators/inventory_generator.py - Core inventory generation logic",
      "NEW: coderef/inventory/schema.json - JSON schema for inventory manifest validation",
      "NEW: test_inventory_generator.py - Comprehensive test suite",
      "MODIFIED: server.py - Add inventory_manifest MCP tool definition",
      "MODIFIED: tool_handlers.py - Add handle_inventory_manifest function",
      "MODIFIED: constants.py - Add inventory-related constants",
      "MODIFIED: type_defs.py - Add inventory-related TypedDict definitions",
      "MODIFIED: validation.py - Add inventory-specific validation functions",
      "MODIFIED: generators/__init__.py - Export InventoryGenerator class"
    ],
    "dependencies": {
      "existing_internal": [
        "BaseGenerator - Template handling and path validation patterns",
        "ErrorResponse factory - Consistent error formatting",
        "logger_config - Structured logging infrastructure",
        "validation.py - Input validation patterns"
      ],
      "existing_external": [
        "pathlib - File system operations (Python standard library)",
        "json - JSON serialization (Python standard library)",
        "jsonschema - Schema validation (already installed)"
      ],
      "new_external": [],
      "new_internal": [
        "InventoryGenerator class - Core inventory generation logic",
        "InventoryManifestDict TypedDict - Type definitions for manifest structure"
      ]
    },
    "architecture_context": "Operates at the generator layer following existing BaseGenerator pattern. Integrates with MCP tool system using established handler registry pattern. Uses JSON schema validation similar to changelog system. Follows existing error handling and logging patterns."
  },
  "4_key_features": [
    "Generate comprehensive project file inventory with metadata (size, lines, type, role)",
    "Categorize files using universal taxonomy (core, source, template, config, test, docs)",
    "Calculate risk levels based on file characteristics (size, complexity, sensitivity)",
    "Extract file dependencies and relationships through import analysis",
    "Generate structured JSON manifest with schema validation",
    "Support configurable analysis depth (quick, standard, deep)",
    "Provide detailed file descriptions and role assignments",
    "Include project metrics and health indicators in manifest"
  ],
  "5_task_id_system": [
    "SETUP-001: Create inventory generator class structure following BaseGenerator pattern",
    "SETUP-002: Define inventory manifest JSON schema with validation rules",
    "SETUP-003: Add inventory-related constants to constants.py",
    "SETUP-004: Create TypedDict definitions for inventory data structures",
    "LOGIC-001: Implement file discovery and metadata collection logic",
    "LOGIC-002: Implement file categorization using universal taxonomy",
    "LOGIC-003: Implement risk level calculation algorithm",
    "LOGIC-004: Implement dependency analysis through import parsing",
    "LOGIC-005: Implement project metrics calculation",
    "API-001: Add inventory_manifest MCP tool definition to server.py",
    "API-002: Implement handle_inventory_manifest function in tool_handlers.py",
    "API-003: Add inventory-specific input validation functions",
    "TEST-001: Create unit tests for file discovery and metadata collection",
    "TEST-002: Create unit tests for categorization and risk calculation",
    "TEST-003: Create unit tests for dependency analysis",
    "TEST-004: Create integration tests for complete manifest generation",
    "TEST-005: Create edge case tests for error handling and security",
    "DOC-001: Update API.md with inventory_manifest tool documentation",
    "DOC-002: Update README.md with inventory manifest feature description"
  ],
  "6_implementation_phases": [
    {
      "title": "Phase 1: Foundation Setup",
      "purpose": "Set up core infrastructure and data structures",
      "complexity": "low",
      "effort_level": 2,
      "tasks": [
        "SETUP-001: Create inventory generator class structure following BaseGenerator pattern",
        "SETUP-002: Define inventory manifest JSON schema with validation rules", 
        "SETUP-003: Add inventory-related constants to constants.py",
        "SETUP-004: Create TypedDict definitions for inventory data structures"
      ],
      "completion_criteria": "All foundation files exist, schema validates, code compiles"
    },
    {
      "title": "Phase 2: Core Implementation",
      "purpose": "Implement inventory generation logic and analysis algorithms",
      "complexity": "high",
      "effort_level": 4,
      "tasks": [
        "LOGIC-001: Implement file discovery and metadata collection logic",
        "LOGIC-002: Implement file categorization using universal taxonomy",
        "LOGIC-003: Implement risk level calculation algorithm",
        "LOGIC-004: Implement dependency analysis through import parsing",
        "LOGIC-005: Implement project metrics calculation"
      ],
      "completion_criteria": "Complete manifest generation works end-to-end for test project"
    },
    {
      "title": "Phase 3: MCP Integration",
      "purpose": "Integrate with MCP tool system and add validation",
      "complexity": "medium",
      "effort_level": 3,
      "tasks": [
        "API-001: Add inventory_manifest MCP tool definition to server.py",
        "API-002: Implement handle_inventory_manifest function in tool_handlers.py",
        "API-003: Add inventory-specific input validation functions"
      ],
      "completion_criteria": "MCP tool responds correctly to inventory_manifest requests"
    },
    {
      "title": "Phase 4: Testing and Documentation",
      "purpose": "Comprehensive testing and documentation updates",
      "complexity": "medium",
      "effort_level": 3,
      "tasks": [
        "TEST-001: Create unit tests for file discovery and metadata collection",
        "TEST-002: Create unit tests for categorization and risk calculation",
        "TEST-003: Create unit tests for dependency analysis",
        "TEST-004: Create integration tests for complete manifest generation",
        "TEST-005: Create edge case tests for error handling and security",
        "DOC-001: Update API.md with inventory_manifest tool documentation",
        "DOC-002: Update README.md with inventory manifest feature description"
      ],
      "completion_criteria": "All tests pass, documentation updated, ready for deployment"
    }
  ],
  "7_testing_strategy": {
    "unit_tests": [
      "test_file_discovery() - Verify correct file detection and filtering",
      "test_metadata_collection() - Verify size, line count, and timestamp extraction",
      "test_categorization() - Verify files categorized correctly by type and role",
      "test_risk_calculation() - Verify risk levels calculated based on file characteristics",
      "test_dependency_analysis() - Verify import parsing and dependency extraction",
      "test_project_metrics() - Verify metrics calculation accuracy"
    ],
    "integration_tests": [
      "test_complete_manifest_generation() - End-to-end manifest creation",
      "test_mcp_tool_integration() - Verify MCP tool responds correctly",
      "test_schema_validation() - Verify generated manifest validates against schema",
      "test_error_handling() - Verify graceful handling of file system errors"
    ],
    "edge_cases": [
      {
        "scenario": "Empty project directory",
        "setup": "Create empty directory",
        "expected_behavior": "Return empty manifest with basic project info",
        "verification": "Manifest contains project metadata but empty files array"
      },
      {
        "scenario": "Directory with permission errors",
        "setup": "Directory with restricted access",
        "expected_behavior": "Skip inaccessible files, log warnings",
        "verification": "Manifest contains accessible files, warnings logged"
      },
      {
        "scenario": "Very large files (>100MB)",
        "setup": "Project with large binary files",
        "expected_behavior": "Skip large files or handle gracefully",
        "verification": "Large files excluded from analysis, manifest generated"
      },
      {
        "scenario": "Circular import dependencies",
        "setup": "Files with circular import references",
        "expected_behavior": "Detect circular dependencies, mark appropriately",
        "verification": "Circular dependencies identified in manifest"
      },
      {
        "scenario": "Malformed import statements",
        "setup": "Files with syntax errors in imports",
        "expected_behavior": "Skip malformed imports, continue analysis",
        "verification": "Analysis completes despite syntax errors"
      },
      {
        "scenario": "Symlinks and special files",
        "setup": "Directory with symlinks and special files",
        "expected_behavior": "Handle symlinks appropriately, skip special files",
        "verification": "Symlinks resolved, special files excluded"
      },
      {
        "scenario": "Unicode file names and paths",
        "setup": "Files with non-ASCII characters in names",
        "expected_behavior": "Handle Unicode correctly in manifest",
        "verification": "Unicode characters preserved in manifest JSON"
      }
    ]
  },
  "8_success_criteria": {
    "functional_requirements": [
      {
        "requirement": "File discovery and metadata collection",
        "metric": "All project files detected with accurate metadata",
        "target": "100% of accessible files included with correct size, line count, and timestamps",
        "validation": "Run on test project, verify manual file count matches manifest count"
      },
      {
        "requirement": "File categorization accuracy",
        "metric": "Files categorized correctly by type and role",
        "target": ">95% categorization accuracy on test projects",
        "validation": "Manual verification of categorization for sample files"
      },
      {
        "requirement": "Risk level calculation",
        "metric": "Risk levels calculated based on file characteristics",
        "target": "Risk levels reflect file size, complexity, and sensitivity",
        "validation": "Verify risk levels match expected patterns for different file types"
      },
      {
        "requirement": "Dependency analysis",
        "metric": "Import dependencies correctly identified",
        "target": ">90% accuracy in dependency detection for supported languages",
        "validation": "Compare detected dependencies with manual analysis"
      },
      {
        "requirement": "MCP tool integration",
        "metric": "Tool responds correctly to MCP requests",
        "target": "Tool returns valid JSON manifest for valid project paths",
        "validation": "Test MCP tool with various project paths and verify responses"
      }
    ],
    "quality_requirements": [
      {
        "requirement": "Code style compliance",
        "metric": "Linter passes with zero warnings",
        "target": "pylint/flake8 returns exit code 0",
        "validation": "Run linter on all new files"
      },
      {
        "requirement": "Test coverage",
        "metric": "Percentage of lines covered by tests",
        "target": ">85% line coverage for new code",
        "validation": "Run pytest with coverage reporting"
      },
      {
        "requirement": "Type safety",
        "metric": "Type checker passes",
        "target": "mypy returns zero errors",
        "validation": "Run mypy on all new files"
      },
      {
        "requirement": "Documentation completeness",
        "metric": "All public APIs documented",
        "target": "Every public function/method has docstring",
        "validation": "Run documentation coverage tool"
      },
      {
        "requirement": "Schema validation",
        "metric": "Generated manifests validate against schema",
        "target": "100% of generated manifests pass schema validation",
        "validation": "Test schema validation on generated manifests"
      }
    ],
    "performance_requirements": [
      {
        "requirement": "Analysis speed",
        "metric": "Time to generate manifest for typical project",
        "target": "<5 seconds for projects with <1000 files",
        "validation": "Time manifest generation on test projects of various sizes"
      },
      {
        "requirement": "Memory usage",
        "metric": "Peak memory consumption during analysis",
        "target": "<100MB for typical project analysis",
        "validation": "Profile memory usage during manifest generation"
      }
    ],
    "security_requirements": [
      {
        "requirement": "Path traversal prevention",
        "metric": "No unauthorized file system access",
        "target": "Cannot access files outside project directory",
        "validation": "Test with malicious path inputs, verify access denied"
      },
      {
        "requirement": "Input validation",
        "metric": "All inputs validated before processing",
        "target": "Invalid project paths rejected with clear error messages",
        "validation": "Test with invalid inputs, verify appropriate error responses"
      }
    ]
  },
  "9_implementation_checklist": {
    "pre_implementation": [
      "☐ Review complete plan for gaps or ambiguities",
      "☐ Get stakeholder approval (if required)",
      "☐ Commit finalized plan to main branch with message 'pre-inventory-manifest-json execution commit' and push",
      "☐ Set up development environment"
    ],
    "phase_1_foundation_setup": [
      "☐ SETUP-001: Create inventory generator class structure following BaseGenerator pattern",
      "☐ SETUP-002: Define inventory manifest JSON schema with validation rules",
      "☐ SETUP-003: Add inventory-related constants to constants.py",
      "☐ SETUP-004: Create TypedDict definitions for inventory data structures"
    ],
    "phase_2_core_implementation": [
      "☐ LOGIC-001: Implement file discovery and metadata collection logic",
      "☐ LOGIC-002: Implement file categorization using universal taxonomy",
      "☐ LOGIC-003: Implement risk level calculation algorithm",
      "☐ LOGIC-004: Implement dependency analysis through import parsing",
      "☐ LOGIC-005: Implement project metrics calculation"
    ],
    "phase_3_mcp_integration": [
      "☐ API-001: Add inventory_manifest MCP tool definition to server.py",
      "☐ API-002: Implement handle_inventory_manifest function in tool_handlers.py",
      "☐ API-003: Add inventory-specific input validation functions"
    ],
    "phase_4_testing_and_documentation": [
      "☐ TEST-001: Create unit tests for file discovery and metadata collection",
      "☐ TEST-002: Create unit tests for categorization and risk calculation",
      "☐ TEST-003: Create unit tests for dependency analysis",
      "☐ TEST-004: Create integration tests for complete manifest generation",
      "☐ TEST-005: Create edge case tests for error handling and security",
      "☐ DOC-001: Update API.md with inventory_manifest tool documentation",
      "☐ DOC-002: Update README.md with inventory manifest feature description"
    ],
    "finalization": [
      "☐ All tests passing",
      "☐ Code review completed and approved",
      "☐ Documentation updated",
      "☐ Changelog entry created",
      "☐ Commit completed implementation to main branch with message 'post-inventory-manifest-json execution commit' and push",
      "☐ Deploy to staging environment",
      "☐ Smoke tests on staging",
      "☐ Deploy to production (if applicable)"
    ]
  }
}



