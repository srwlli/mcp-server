{
  "META_DOCUMENTATION": {
    "feature_name": "create-plan-workflow-improvements",
    "schema_version": "1.0.0",
    "version": "1.0.0",
    "status": "draft",
    "generated_by": "Lloyd (AI Assistant)",
    "has_context": true,
    "has_analysis": false,
    "stubs_merged": 12,
    "created_at": "2025-12-17T19:30:00Z"
  },
  "UNIVERSAL_PLANNING_STRUCTURE": {
    "0_preparation": {
      "foundation_docs": [
        "docs-mcp/CLAUDE.md",
        "docs-mcp/tool_handlers.py",
        "docs-mcp/server.py",
        "personas-mcp/personas/base/lloyd.json"
      ],
      "reference_implementations": [
        "handle_create_plan in tool_handlers.py",
        "handle_execute_plan in tool_handlers.py",
        "handle_update_deliverables in tool_handlers.py"
      ],
      "constraints": [
        "Backwards compatible with existing plan.json files",
        "Must work across all projects using docs-mcp",
        "Minimal additional overhead for agents"
      ]
    },
    "1_executive_summary": {
      "feature_name": "Create-Plan Workflow Improvements",
      "goal": "Make the create-plan workflow robust, consistent, and fully trackable from start (gather-context) to finish (archive-feature) with proper enforcement, progress tracking, git integration, and standardized feature documentation",
      "scope": "12 merged stubs covering enforcement, progress tracking, workflow enhancements, multi-agent coordination, and documentation",
      "estimated_complexity": "high",
      "files_affected": 15,
      "new_tools": 3,
      "modified_tools": 5,
      "workflow_change": "gather-context → create-plan → [commit] → execute-plan (progress+testing) → update-deliverables → git-workflow → archive-feature"
    },
    "2_risk_assessment": {
      "overall_risk": "medium",
      "risks": [
        {
          "risk": "Breaking existing plan.json files",
          "mitigation": "Schema validation with graceful fallback for old formats",
          "severity": "high"
        },
        {
          "risk": "TodoWrite-plan.json sync complexity",
          "mitigation": "Start with instruction-based tracking, add automation later",
          "severity": "medium"
        },
        {
          "risk": "Scope creep with 12 stubs",
          "mitigation": "Implement in phases, validate each phase before proceeding",
          "severity": "medium"
        },
        {
          "risk": "Lloyd persona changes breaking existing usage",
          "mitigation": "Strict mode is opt-in, default behavior unchanged",
          "severity": "low"
        }
      ]
    },
    "3_current_state_analysis": {
      "files_to_modify": [
        {
          "path": "docs-mcp/tool_handlers.py",
          "purpose": "Add timestamp wrapper, new tools (audit_plans, git_release, generate_features_inventory)"
        },
        {
          "path": "docs-mcp/server.py",
          "purpose": "Register new tools"
        },
        {
          "path": "docs-mcp/CLAUDE.md",
          "purpose": "Document new workflow, enforce plan.json standard"
        },
        {
          "path": "docs-mcp/generators/planning_generator.py",
          "purpose": "Add timestamp to outputs, update plan template"
        },
        {
          "path": "personas-mcp/personas/base/lloyd.json",
          "purpose": "Add strict mode for plan.json execution"
        },
        {
          "path": "docs-mcp/.claude/commands/start-feature.md",
          "purpose": "Add git commit step after planning artifacts"
        },
        {
          "path": "docs-mcp/context/planning-template-for-ai.json",
          "purpose": "Add verify_step field to task schema"
        }
      ],
      "files_to_create": [
        {
          "path": "docs-mcp/generators/features_inventory_generator.py",
          "purpose": "Generate features.md for projects"
        },
        {
          "path": "docs-mcp/templates/features.md.template",
          "purpose": "Template for features.md generation"
        },
        {
          "path": "docs-mcp/.claude/commands/git-release.md",
          "purpose": "Git workflow slash command"
        },
        {
          "path": "docs-mcp/.claude/commands/audit-plans.md",
          "purpose": "Plan audit slash command"
        },
        {
          "path": "docs-mcp/validation/plan_format_validator.py",
          "purpose": "Validate plan.json format enforcement"
        }
      ],
      "dependencies": [
        "Existing docs-mcp infrastructure",
        "personas-mcp Lloyd persona",
        "Git CLI available in environment"
      ]
    },
    "4_key_features": {
      "features": [
        {
          "id": "F1",
          "name": "Timestamp Enforcement",
          "description": "Add ISO 8601 timestamps to all workflow outputs",
          "stubs": ["STUB-036"],
          "priority": "high"
        },
        {
          "id": "F2",
          "name": "Plan Format Enforcement",
          "description": "Enforce plan.json as only valid format at coderef/working/{feature}/plan.json",
          "stubs": ["STUB-032", "STUB-039"],
          "priority": "high"
        },
        {
          "id": "F3",
          "name": "Progress Tracking",
          "description": "Agents update task status in plan.json during execution",
          "stubs": ["STUB-009"],
          "priority": "high"
        },
        {
          "id": "F4",
          "name": "Plan Audit Workflow",
          "description": "Scan and index all plan.json files, surface stale/active/blocked plans",
          "stubs": ["STUB-028"],
          "priority": "high"
        },
        {
          "id": "F5",
          "name": "Start Feature Git Commit",
          "description": "Auto-commit planning artifacts after /start-feature",
          "stubs": ["STUB-040"],
          "priority": "medium"
        },
        {
          "id": "F6",
          "name": "Git Release Workflow",
          "description": "Version bump, commit, push as final step before archive",
          "stubs": ["STUB-038"],
          "priority": "medium"
        },
        {
          "id": "F7",
          "name": "Incremental Testing",
          "description": "Optional verify_step field in task schema",
          "stubs": ["STUB-010"],
          "priority": "medium"
        },
        {
          "id": "F8",
          "name": "Workorder Handoff Protocol",
          "description": "Standardize multi-agent handoff with prompt templates",
          "stubs": ["STUB-008"],
          "priority": "high"
        },
        {
          "id": "F9",
          "name": "Features Inventory",
          "description": "Generate features.md documenting tools, APIs, features per project",
          "stubs": ["STUB-002"],
          "priority": "high"
        },
        {
          "id": "F10",
          "name": "Workflow Naming",
          "description": "Better naming for slash commands",
          "stubs": ["STUB-041"],
          "priority": "low"
        },
        {
          "id": "F11",
          "name": "Automation Ideas",
          "description": "Future automation backlog",
          "stubs": ["STUB-042"],
          "priority": "low"
        }
      ]
    },
    "5_task_id_system": {
      "workorder": {
        "id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
        "name": "Create Plan Workflow Improvements",
        "feature_dir": "coderef/working/create-plan-workflow-improvements"
      },
      "tasks": [
        {
          "id": "TS-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Add timestamp wrapper function to tool_handlers.py",
          "feature": "F1",
          "file": "docs-mcp/tool_handlers.py",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "TS-002",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Update all handler responses to include timestamp field",
          "feature": "F1",
          "file": "docs-mcp/tool_handlers.py",
          "complexity": "medium",
          "status": "pending"
        },
        {
          "id": "ENF-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Create plan_format_validator.py with validate_plan_format()",
          "feature": "F2",
          "file": "docs-mcp/validation/plan_format_validator.py",
          "complexity": "medium",
          "status": "pending"
        },
        {
          "id": "ENF-002",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Update Lloyd persona with strict_mode flag",
          "feature": "F2",
          "file": "personas-mcp/personas/base/lloyd.json",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "ENF-003",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Document plan.json enforcement in CLAUDE.md",
          "feature": "F2",
          "file": "docs-mcp/CLAUDE.md",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "PROG-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Add update_task_status tool to tool_handlers.py",
          "feature": "F3",
          "file": "docs-mcp/tool_handlers.py",
          "complexity": "medium",
          "status": "pending"
        },
        {
          "id": "PROG-002",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Register update_task_status in server.py",
          "feature": "F3",
          "file": "docs-mcp/server.py",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "PROG-003",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Add progress tracking instructions to plan template",
          "feature": "F3",
          "file": "docs-mcp/context/planning-template-for-ai.json",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "AUDIT-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Create audit_plans tool to scan all plan.json files",
          "feature": "F4",
          "file": "docs-mcp/tool_handlers.py",
          "complexity": "high",
          "status": "pending"
        },
        {
          "id": "AUDIT-002",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Register audit_plans in server.py",
          "feature": "F4",
          "file": "docs-mcp/server.py",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "AUDIT-003",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Create /audit-plans slash command",
          "feature": "F4",
          "file": "docs-mcp/.claude/commands/audit-plans.md",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "GIT-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Update /start-feature to commit planning artifacts",
          "feature": "F5",
          "file": "docs-mcp/.claude/commands/start-feature.md",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "GIT-002",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Create /git-release slash command",
          "feature": "F6",
          "file": "docs-mcp/.claude/commands/git-release.md",
          "complexity": "medium",
          "status": "pending"
        },
        {
          "id": "TEST-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Add verify_step optional field to task schema",
          "feature": "F7",
          "file": "docs-mcp/context/planning-template-for-ai.json",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "HAND-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Add handoff_prompt_template to communication.json schema",
          "feature": "F8",
          "file": "docs-mcp/tool_handlers.py",
          "complexity": "medium",
          "status": "pending"
        },
        {
          "id": "HAND-002",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Document standard handoff protocol in CLAUDE.md",
          "feature": "F8",
          "file": "docs-mcp/CLAUDE.md",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "INV-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Create features_inventory_generator.py",
          "feature": "F9",
          "file": "docs-mcp/generators/features_inventory_generator.py",
          "complexity": "high",
          "status": "pending"
        },
        {
          "id": "INV-002",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Create features.md.template",
          "feature": "F9",
          "file": "docs-mcp/templates/features.md.template",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "INV-003",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Add generate_features_inventory tool to tool_handlers.py",
          "feature": "F9",
          "file": "docs-mcp/tool_handlers.py",
          "complexity": "medium",
          "status": "pending"
        },
        {
          "id": "INV-004",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Register generate_features_inventory in server.py",
          "feature": "F9",
          "file": "docs-mcp/server.py",
          "complexity": "low",
          "status": "pending"
        },
        {
          "id": "DOC-001",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Update CLAUDE.md with complete workflow documentation",
          "feature": "F2",
          "file": "docs-mcp/CLAUDE.md",
          "complexity": "medium",
          "status": "pending"
        },
        {
          "id": "DOC-002",
          "workorder_id": "WO-CREATE-PLAN-WORKFLOW-IMPROVEMENTS-001",
          "description": "Document naming considerations for future (STUB-041)",
          "feature": "F10",
          "file": "docs-mcp/CLAUDE.md",
          "complexity": "low",
          "status": "pending"
        }
      ]
    },
    "6_implementation_phases": {
      "phases": [
        {
          "phase": 1,
          "name": "Foundation - Timestamps & Enforcement",
          "description": "Add timestamps to all outputs and create plan format validation",
          "tasks": ["TS-001", "TS-002", "ENF-001", "ENF-002", "ENF-003"],
          "deliverables": [
            "Timestamp wrapper function",
            "All tool outputs include timestamp field",
            "plan_format_validator.py created",
            "Lloyd strict_mode flag added",
            "CLAUDE.md updated with enforcement rules"
          ],
          "stubs_addressed": ["STUB-036", "STUB-032", "STUB-039"]
        },
        {
          "phase": 2,
          "name": "Progress Tracking & Audit",
          "description": "Enable task status tracking and plan audit capabilities",
          "tasks": ["PROG-001", "PROG-002", "PROG-003", "AUDIT-001", "AUDIT-002", "AUDIT-003"],
          "deliverables": [
            "update_task_status tool working",
            "Plan template includes progress instructions",
            "audit_plans tool scans all plans",
            "/audit-plans slash command available"
          ],
          "stubs_addressed": ["STUB-009", "STUB-028"]
        },
        {
          "phase": 3,
          "name": "Git Workflow & Testing",
          "description": "Add git integration and optional incremental testing",
          "tasks": ["GIT-001", "GIT-002", "TEST-001"],
          "deliverables": [
            "/start-feature commits planning artifacts",
            "/git-release command available",
            "verify_step field in task schema"
          ],
          "stubs_addressed": ["STUB-040", "STUB-038", "STUB-010"]
        },
        {
          "phase": 4,
          "name": "Handoff & Inventory",
          "description": "Standardize multi-agent handoff and create features inventory",
          "tasks": ["HAND-001", "HAND-002", "INV-001", "INV-002", "INV-003", "INV-004"],
          "deliverables": [
            "Handoff prompt template in communication.json",
            "Handoff protocol documented",
            "features_inventory_generator working",
            "features.md template created",
            "generate_features_inventory tool available"
          ],
          "stubs_addressed": ["STUB-008", "STUB-002"]
        },
        {
          "phase": 5,
          "name": "Documentation & Polish",
          "description": "Final documentation and naming considerations",
          "tasks": ["DOC-001", "DOC-002"],
          "deliverables": [
            "Complete workflow documentation in CLAUDE.md",
            "Naming considerations documented for future"
          ],
          "stubs_addressed": ["STUB-041", "STUB-042"]
        }
      ]
    },
    "7_testing_strategy": {
      "unit_tests": [
        "Test timestamp wrapper adds valid ISO 8601 timestamp",
        "Test plan_format_validator accepts valid plan.json",
        "Test plan_format_validator rejects plan.md files",
        "Test update_task_status updates correct task in plan.json",
        "Test audit_plans finds all plan.json in coderef/working/",
        "Test audit_plans identifies stale plans (>7 days)",
        "Test features_inventory_generator produces valid markdown"
      ],
      "integration_tests": [
        "Full /start-feature workflow creates plan.json and commits",
        "/execute-plan generates TodoWrite list from plan.json",
        "update_task_status syncs with DELIVERABLES.md",
        "/git-release performs version bump, commit, push",
        "/audit-plans returns correct status for multiple plans",
        "generate_features_inventory works on docs-mcp project"
      ]
    },
    "8_success_criteria": {
      "criteria": [
        "All tool outputs include timestamp field (ISO 8601)",
        "Plans only accepted in plan.json format at standard location",
        "Lloyd persona can enforce strict mode when enabled",
        "Agents can update task status via update_task_status tool",
        "audit_plans returns stale/active/blocked plan counts",
        "/start-feature commits planning artifacts automatically",
        "/git-release performs complete release workflow",
        "communication.json includes handoff_prompt_template",
        "generate_features_inventory produces valid features.md",
        "All 12 stubs addressed and documented"
      ]
    },
    "9_implementation_checklist": {
      "phase_1": [
        "[ ] TS-001: Add timestamp wrapper function",
        "[ ] TS-002: Update all handler responses with timestamp",
        "[ ] ENF-001: Create plan_format_validator.py",
        "[ ] ENF-002: Update Lloyd persona with strict_mode",
        "[ ] ENF-003: Document enforcement in CLAUDE.md"
      ],
      "phase_2": [
        "[ ] PROG-001: Add update_task_status tool",
        "[ ] PROG-002: Register update_task_status in server.py",
        "[ ] PROG-003: Add progress instructions to plan template",
        "[ ] AUDIT-001: Create audit_plans tool",
        "[ ] AUDIT-002: Register audit_plans in server.py",
        "[ ] AUDIT-003: Create /audit-plans slash command"
      ],
      "phase_3": [
        "[ ] GIT-001: Update /start-feature with git commit",
        "[ ] GIT-002: Create /git-release slash command",
        "[ ] TEST-001: Add verify_step field to task schema"
      ],
      "phase_4": [
        "[ ] HAND-001: Add handoff_prompt_template to communication.json",
        "[ ] HAND-002: Document handoff protocol in CLAUDE.md",
        "[ ] INV-001: Create features_inventory_generator.py",
        "[ ] INV-002: Create features.md.template",
        "[ ] INV-003: Add generate_features_inventory tool",
        "[ ] INV-004: Register generate_features_inventory in server.py"
      ],
      "phase_5": [
        "[ ] DOC-001: Update CLAUDE.md with complete workflow docs",
        "[ ] DOC-002: Document naming considerations (STUB-041, STUB-042)"
      ]
    }
  }
}
