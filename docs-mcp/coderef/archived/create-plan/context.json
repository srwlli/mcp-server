{
  "feature_name": "create-plan",
  "description": "Slash command and MCP tool that guides AI through generating a complete implementation plan JSON file by synthesizing data from context gathering, project analysis, and the planning template. This bridges the workflow gap between /analyze-for-planning and /validate-plan.",
  "goal": "Enable AI assistants to create high-quality implementation plans autonomously, ensuring consistency and completeness while reducing the cognitive load of remembering all required sections and quality criteria.",
  "requirements": [
    "Load context.json if available (from prior /gather-context)",
    "Load project analysis if available (from prior /analyze-for-planning)",
    "Load AI-optimized planning template (~400-500 lines, extracted from full 1,347-line template)",
    "Create complete plan in batch mode (all 10 sections at once)",
    "Save partial plan with TODOs if generation fails mid-way",
    "Auto-retry once for transient errors before saving partial",
    "Prompt user if context/analysis missing (don't auto-run prerequisites)",
    "Print terminal report after completion showing sections completed and next steps",
    "Keep tools independent (no modifications to /analyze-for-planning or /gather-context)"
  ],
  "out_of_scope": [
    "Auto-running /gather-context or /analyze-for-planning (user runs separately)",
    "Modifying existing plans (only creates new ones)",
    "Auto-validation (user runs /validate-plan separately after creation)",
    "Auto-iteration to score >= 90 (just creates initial plan)",
    "Executing the plan (only creates the JSON, doesn't implement)"
  ],
  "constraints": [
    "Must work with existing MCP tool architecture (handlers, validation, logging, error responses)",
    "Must follow existing error response patterns (ErrorResponse factory)",
    "Must save to coderef/working/<feature-name>/plan.json",
    "Must use AI-optimized template (not full 1,347-line version)",
    "Must extract template by removing META_DOCUMENTATION and USAGE_INSTRUCTIONS sections",
    "Keep schema + examples + quality checklists + common mistakes for AI guidance"
  ],
  "decisions": {
    "q4_plan_structure_guidance": "Batch mode - AI loads entire template, creates complete plan in one shot, then validates",
    "q5_integration_with_analyze": "Keep tools independent - /create-plan loads context.json and analysis separately",
    "q6_error_handling": "Save partial + single retry - Retry once for transient errors, then save partial plan with TODOs marking incomplete sections",
    "template_optimization": "Extract AI-optimized version (~400-500 lines) by removing human tutorial prose, keeping structure + examples"
  },
  "success_criteria": {
    "functional": [
      "Creates valid JSON file (parseable)",
      "Contains all 10 required sections (0-9)",
      "No placeholder text like '[TBD]' or '[TODO]' in completed sections"
    ],
    "operational": [
      "File saved to correct location (coderef/working/<feature-name>/plan.json)",
      "Terminal output shows summary (sections completed, next steps)",
      "Handles missing context/analysis gracefully with user prompts"
    ],
    "quality": [
      "Code coverage >80% for new generator",
      "Follows existing patterns (handler registry, validation, error responses)",
      "Plan generation completes in <5 seconds"
    ]
  }
}
