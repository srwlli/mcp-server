# CodeRef Directory Structure Reference

**Document Version:** 1.0.0
**Created:** 2025-12-30
**Last Updated:** 2025-12-30
**Status:** Reference Guide
**Audience:** Human Users & AI Agents

---

## Purpose

This document explains the complete directory structure of the CodeRef ecosystem's `coderef/` folder, what each directory contains, and how they're used in workflows.

---

## Overview

The `coderef/` directory is the **global artifact storage** for the entire CodeRef ecosystem. All 5 MCP servers read from and write to these directories during feature planning, implementation, testing, and archival.

**Location:** `~/.mcp-servers/coderef/`

**Key Principle:**
- âœ… **Global paths only** - All servers use the same `coderef/` directory
- âŒ **No local copies** - Single source of truth
- âœ… **Organized by purpose** - Each subdirectory has a specific role

---

## Complete Directory Structure

```
C:\Users\willh\.mcp-servers\coderef\
â”‚
â”œâ”€â”€ ğŸ“ agent/                           # Agent-specific artifacts
â”‚   â””â”€â”€ standards/                      # Agent coding standards & patterns
â”‚
â”œâ”€â”€ ğŸ“ archived/                        # Completed features (historical)
â”‚   â”œâ”€â”€ align-plan-workflow/           # Example: Archived feature
â”‚   â”‚   â”œâ”€â”€ plan.json
â”‚   â”‚   â”œâ”€â”€ DELIVERABLES.md
â”‚   â”‚   â”œâ”€â”€ context.json
â”‚   â”‚   â””â”€â”€ analysis.json
â”‚   â””â”€â”€ index.json                     # Archive metadata & search index
â”‚
â”œâ”€â”€ ğŸ“ proofs/                          # Proof of concepts / experiments
â”‚   â”œâ”€â”€ index.json                     # POC tracking
â”‚   â””â”€â”€ {poc-name}/                    # Individual POC folders
â”‚
â”œâ”€â”€ ğŸ“ testing/                         # Test automation artifacts
â”‚   â”œâ”€â”€ INDEX.md                       # Test suite index
â”‚   â”œâ”€â”€ README.md                      # Test documentation
â”‚   â””â”€â”€ results/                       # Test execution results
â”‚       â””â”€â”€ {feature}-test-results.json
â”‚
â”œâ”€â”€ ğŸ“ user/                            # Human-readable documentation
â”‚   â”œâ”€â”€ CODEREF-ECOSYSTEM-GUIDE.md     # Complete ecosystem guide
â”‚   â””â”€â”€ DIRECTORY-STRUCTURE.md         # This document
â”‚
â”œâ”€â”€ ğŸ“ workorder/                       # Active feature implementations
â”‚   â”œâ”€â”€ papertrail-integration/
â”‚   â”‚   â”œâ”€â”€ plan.json                  # 10-section implementation plan
â”‚   â”‚   â”œâ”€â”€ context.json               # Feature requirements
â”‚   â”‚   â”œâ”€â”€ analysis.json              # Project analysis
â”‚   â”‚   â”œâ”€â”€ DELIVERABLES.md            # Progress tracking
â”‚   â”‚   â””â”€â”€ communication.json         # Multi-agent coordination (optional)
â”‚   â”œâ”€â”€ papertrail-python-package/
â”‚   â””â”€â”€ tool-server-migration/
â”‚
â””â”€â”€ ğŸ“„ workorder-log.txt                # Global workorder audit trail
```

---

## Directory Purposes

### ğŸ“ `agent/` - Agent-Specific Artifacts

**Purpose:** Storage for agent-specific coding standards, patterns, and configuration.

**Contents:**
```
agent/
â””â”€â”€ standards/
    â”œâ”€â”€ ui-patterns.md           # Frontend coding standards
    â”œâ”€â”€ behavior-patterns.md     # Error handling, loading states
    â”œâ”€â”€ ux-patterns.md           # Navigation, permissions
    â””â”€â”€ standards-index.md       # Overview of all standards
```

**Used By:**
- `coderef-personas` - Loads standards for agent behavior
- `coderef-docs` - Establishes and validates standards
- All agents - Reference during implementation

**Lifecycle:** Persistent (updated as patterns evolve)

**Key Files:**
- `standards/` - Generated by `/establish-standards`
- Used by `/check-consistency` for validation

---

### ğŸ“ `archived/` - Completed Features

**Purpose:** Long-term storage for completed features with full historical context.

**Contents:**
```
archived/
â”œâ”€â”€ {feature-name}/
â”‚   â”œâ”€â”€ plan.json               # Original implementation plan
â”‚   â”œâ”€â”€ DELIVERABLES.md         # Final metrics & completion data
â”‚   â”œâ”€â”€ context.json            # Requirements & constraints
â”‚   â”œâ”€â”€ analysis.json           # Project analysis at planning time
â”‚   â””â”€â”€ communication.json      # Multi-agent coordination (if used)
â””â”€â”€ index.json                  # Searchable archive index
```

**Used By:**
- `coderef-workflow` - Moves features here via `/archive-feature`
- `coderef-docs` - Searches for similar features during planning
- Future AI agents - Learning from past implementations

**Lifecycle:** Permanent archive (never deleted)

**Example Entry:**
```json
{
  "feature_name": "align-plan-workflow",
  "workorder_id": "WO-ALIGN-PLAN-001",
  "archived_date": "2025-12-28T15:30:00Z",
  "status": "completed",
  "deliverables": {
    "lines_of_code": 487,
    "files_changed": 12,
    "tests_added": 15
  }
}
```

**Key Commands:**
- `/archive-feature` - Move completed feature to archive
- `generate_features_inventory` - List all archived features

---

### ğŸ“ `proofs/` - Proof of Concepts

**Purpose:** Experimental features and proof-of-concept implementations.

**Contents:**
```
proofs/
â”œâ”€â”€ index.json                  # POC tracking metadata
â””â”€â”€ {poc-name}/
    â”œâ”€â”€ notes.md                # Experiment notes
    â”œâ”€â”€ results.md              # Findings
    â””â”€â”€ code/                   # Experimental code
```

**Used By:**
- Development/research teams
- Testing new workflows before productionizing

**Lifecycle:** Temporary (deleted after validation or promotion)

**Typical Flow:**
```
POC Created â†’ Tested â†’ Evaluated
    â†“
Promote to workorder/ (if successful)
    OR
Delete (if unsuccessful)
```

---

### ğŸ“ `testing/` - Test Automation

**Purpose:** Test execution results, coverage reports, and health metrics.

**Contents:**
```
testing/
â”œâ”€â”€ INDEX.md                    # Test suite overview
â”œâ”€â”€ README.md                   # Test documentation
â””â”€â”€ results/
    â”œâ”€â”€ {feature}-test-results.json
    â”œâ”€â”€ coverage-report.json
    â””â”€â”€ health-metrics.json
```

**Used By:**
- `coderef-testing` - Stores test execution results
- CI/CD pipelines - Automated testing
- Developers - Review test outcomes

**Lifecycle:** Active (continuously updated)

**Key Files:**
- `results/*.json` - Generated by `/run-tests`
- `coverage-report.json` - Generated by `/test-coverage`
- `health-metrics.json` - Generated by `/test-health`

**Example Result:**
```json
{
  "feature": "auth-system",
  "test_run": "2025-12-30T10:15:00Z",
  "total_tests": 847,
  "passed": 844,
  "failed": 3,
  "skipped": 12,
  "coverage": 87.5,
  "duration_seconds": 45.2
}
```

---

### ğŸ“ `user/` - Human Documentation

**Purpose:** Human-readable guides, tutorials, and reference documentation.

**Contents:**
```
user/
â”œâ”€â”€ CODEREF-ECOSYSTEM-GUIDE.md    # Complete ecosystem overview
â”œâ”€â”€ DIRECTORY-STRUCTURE.md        # This document
â”œâ”€â”€ GETTING-STARTED.md            # Onboarding guide (future)
â””â”€â”€ FAQ.md                        # Common questions (future)
```

**Used By:**
- Human users learning the system
- Onboarding new team members
- Documentation team

**Lifecycle:** Persistent (living documents)

**Writing Style:**
- Plain language (not technical jargon)
- Practical examples
- Use cases and workflows
- Visual diagrams where helpful

**Future Additions:**
- Video tutorials
- Troubleshooting guides
- Best practices
- Community contributions

---

### ğŸ“ `workorder/` - Active Features

**Purpose:** Active feature implementations currently being worked on.

**Contents:**
```
workorder/
â””â”€â”€ {feature-name}/
    â”œâ”€â”€ plan.json               # 10-section implementation plan
    â”œâ”€â”€ context.json            # Requirements from /gather-context
    â”œâ”€â”€ analysis.json           # Project analysis from /analyze-for-planning
    â”œâ”€â”€ DELIVERABLES.md         # Progress tracking & metrics
    â”œâ”€â”€ communication.json      # Multi-agent coordination (optional)
    â””â”€â”€ claude.md               # Agent handoff context (optional)
```

**Used By:**
- `coderef-workflow` - Planning and execution
- `coderef-personas` - Agent coordination
- `coderef-docs` - Documentation generation
- All agents during implementation

**Lifecycle:** Active â†’ Archived (via `/archive-feature`)

**File Breakdown:**

**1. plan.json (10 Sections)**
```json
{
  "META_DOCUMENTATION": {
    "workorder_id": "WO-AUTH-SYSTEM-001",
    "version": "1.0.0",
    "created": "2025-12-30T10:00:00Z",
    "status": "in_progress"
  },
  "0_PREPARATION": { /* project analysis */ },
  "1_EXECUTIVE_SUMMARY": { /* what & why */ },
  "2_RISK_ASSESSMENT": { /* breaking changes, security */ },
  "3_CURRENT_STATE_ANALYSIS": { /* existing patterns */ },
  "4_KEY_FEATURES": { /* must-haves */ },
  "5_TASK_ID_SYSTEM": { /* naming conventions */ },
  "6_IMPLEMENTATION_PHASES": { /* tasks */ },
  "7_TESTING_STRATEGY": { /* test plan */ },
  "8_SUCCESS_CRITERIA": { /* definition of done */ }
}
```

**2. context.json**
```json
{
  "feature_name": "auth-system",
  "description": "Add JWT authentication with refresh tokens",
  "goal": "Secure all API endpoints",
  "requirements": [
    "JWT token generation",
    "Refresh token rotation",
    "Token validation middleware"
  ],
  "constraints": [
    "Must work with existing user model",
    "No breaking changes to public API"
  ]
}
```

**3. analysis.json**
```json
{
  "foundation_docs": {
    "readme_path": "README.md",
    "architecture_path": "docs/ARCHITECTURE.md"
  },
  "coding_standards": {
    "ui_patterns": "coderef/agent/standards/ui-patterns.md",
    "behavior_patterns": "coderef/agent/standards/behavior-patterns.md"
  },
  "reference_components": [
    "src/middleware/auth_decorator.py",
    "src/models/user.py"
  ],
  "dependencies": [
    "PyJWT>=2.8.0",
    "cryptography>=41.0.0"
  ]
}
```

**4. DELIVERABLES.md**
```markdown
# Deliverables: Auth System (WO-AUTH-SYSTEM-001)

## Status
- **Current Status:** In Progress
- **Progress:** 75% (12/16 tasks complete)
- **Last Updated:** 2025-12-30

## Implementation Metrics
- **Lines of Code:** +487 added, -23 removed
- **Files Changed:** 12
- **Commits:** 8
- **Time Elapsed:** 3.5 hours

## Task Checklist
- [x] SETUP-001: Install PyJWT dependency
- [x] IMPL-001: Create JWT token generator
- [ ] IMPL-002: Add token validation middleware
- [ ] TEST-001: Write unit tests
```

**5. communication.json (Multi-Agent Mode)**
```json
{
  "workorder_id": "WO-AUTH-SYSTEM-001",
  "agents": {
    "agent_1": {
      "name": "Marcus",
      "workorder_id": "WO-AUTH-SYSTEM-001-A1",
      "tasks": ["IMPL-001", "IMPL-002"],
      "forbidden_files": ["frontend/*", "tests/*"],
      "status": "in_progress"
    },
    "agent_2": {
      "name": "Quinn",
      "workorder_id": "WO-AUTH-SYSTEM-001-A2",
      "tasks": ["TEST-001", "TEST-002"],
      "forbidden_files": ["src/*"],
      "status": "completed"
    }
  }
}
```

**Key Commands:**
- `/create-workorder` - Create new feature in workorder/
- `/execute-plan` - Generate TodoWrite checklist
- `/update-deliverables` - Update metrics
- `/archive-feature` - Move to archived/

---

### ğŸ“„ `workorder-log.txt` - Global Audit Trail

**Purpose:** Simple, append-only log of all workorders created system-wide.

**Format:**
```
WO-ID | Project | Description | Timestamp
```

**Example:**
```
WO-AUTH-SYSTEM-001 | mcp-servers | Add JWT authentication | 2025-12-30T10:00:00Z
WO-DARK-MODE-UI-002 | web-app | Dark mode toggle | 2025-12-30T11:30:00Z
WO-API-V2-REFACTOR-003 | backend | Refactor API endpoints | 2025-12-30T14:15:00Z
```

**Properties:**
- Thread-safe (file locking)
- Reverse chronological (latest first)
- Simple grep-able format
- Never deleted (permanent audit trail)

**Key Commands:**
- `log_workorder` - Add new entry
- `get_workorder_log` - Query entries

---

## Workflow Flow

### Complete Feature Lifecycle

```
1. PLANNING
   User idea â†’ /create-workorder
      â†“
   coderef/workorder/{feature}/
      â”œâ”€ context.json (created)
      â”œâ”€ analysis.json (generated)
      â””â”€ plan.json (generated)

2. EXECUTION
   /execute-plan â†’ TodoWrite checklist
      â†“
   Agent implements tasks
      â†“
   DELIVERABLES.md (updated continuously)

3. TESTING
   /run-tests
      â†“
   coderef/testing/results/{feature}-test-results.json

4. DOCUMENTATION
   /update-deliverables â†’ /record-changes
      â†“
   CHANGELOG.json, README.md updated

5. ARCHIVAL
   /archive-feature
      â†“
   coderef/workorder/{feature}/
      â†“ (moved)
   coderef/archived/{feature}/
      â””â”€ All artifacts preserved
```

---

## Directory Access Patterns

### Who Reads/Writes What

| Directory | Read By | Written By | Frequency |
|-----------|---------|------------|-----------|
| `agent/standards/` | All agents, personas | coderef-docs | Once (setup), rare updates |
| `archived/` | All servers (reference) | coderef-workflow | On feature completion |
| `proofs/` | Developers | Manual | During research |
| `testing/` | Developers, CI/CD | coderef-testing | Every test run |
| `user/` | Humans | Documentation team | As needed |
| `workorder/` | All servers | coderef-workflow | Continuous (active features) |

---

## Best Practices

### âœ… Do's

1. **Use global paths** - Always reference `coderef/` from root
2. **Follow naming conventions** - Use `{feature-name}/` for clarity
3. **Archive completed features** - Don't delete, archive for reference
4. **Update DELIVERABLES.md** - Track progress as you work
5. **Use workorder IDs** - Every feature gets a unique WO-ID

### âŒ Don'ts

1. **Don't create local copies** - Single source of truth only
2. **Don't skip archival** - Completed features must be archived
3. **Don't manually edit workorder-log.txt** - Use MCP tools
4. **Don't delete archived features** - Permanent historical record
5. **Don't mix active/archived** - Clear separation required

---

## File Naming Conventions

### Feature Folders
```
Format: lowercase-with-hyphens
Examples:
  âœ… auth-system
  âœ… dark-mode-toggle
  âœ… api-v2-migration
  âŒ AuthSystem
  âŒ dark_mode_toggle
  âŒ API-V2-Migration
```

### Workorder IDs
```
Format: WO-{FEATURE}-{CATEGORY}-###
Examples:
  âœ… WO-AUTH-SYSTEM-001
  âœ… WO-DARK-MODE-UI-002
  âœ… WO-API-V2-REFACTOR-003
  âŒ wo-auth-001
  âŒ WO-AUTH-1
  âŒ AUTH-SYSTEM-001
```

### Standard Files
```
Required in workorder/{feature}/:
  â”œâ”€ plan.json              (10-section plan)
  â”œâ”€ context.json           (requirements)
  â”œâ”€ analysis.json          (project analysis)
  â””â”€ DELIVERABLES.md        (progress tracking)

Optional:
  â”œâ”€ communication.json     (multi-agent mode)
  â””â”€ claude.md              (handoff context)
```

---

## Quick Reference Commands

### Working with Directories

**Create New Feature:**
```bash
/create-workorder
# Creates: coderef/workorder/{feature}/
```

**Archive Completed Feature:**
```bash
/archive-feature --feature auth-system
# Moves: workorder/auth-system/ â†’ archived/auth-system/
```

**List Active Features:**
```bash
ls coderef/workorder/
# Shows all features in progress
```

**List Archived Features:**
```bash
cat coderef/archived/index.json
# Or: /generate-features-inventory
```

**Establish Standards:**
```bash
/establish-standards
# Creates: coderef/agent/standards/
```

**Check Standards Compliance:**
```bash
/check-consistency
# Reads: coderef/agent/standards/
# Validates: Current code against standards
```

---

## Directory Sizes (Current Project)

```
Directory         Size     Status
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
agent/            ~50K     Active
archived/         ~2MB     Growing
proofs/           ~100K    Experimental
testing/          ~1.5MB   Active
user/             ~28KB    Growing
workorder/        ~5MB     Active (3 features)
workorder-log.txt 2KB      Append-only
```

---

## Future Directory Additions

### Planned
- `coderef/templates/` - Reusable plan templates
- `coderef/metrics/` - Analytics and dashboards
- `coderef/reviews/` - Code review feedback
- `coderef/migrations/` - Schema migration tracking

### Under Consideration
- `coderef/snapshots/` - Point-in-time codebase snapshots
- `coderef/patterns/` - Discovered code patterns library
- `coderef/benchmarks/` - Performance benchmarking data

---

## Troubleshooting

### Common Issues

**Problem:** "Feature not found in workorder/"
```bash
# Check if it was archived
ls coderef/archived/ | grep feature-name

# Check workorder log
grep "feature-name" coderef/workorder-log.txt
```

**Problem:** "Standards validation failing"
```bash
# Re-establish standards
/establish-standards

# Check what changed
git diff coderef/agent/standards/
```

**Problem:** "Test results not updating"
```bash
# Check permissions
ls -la coderef/testing/results/

# Re-run tests
/run-tests
```

---

## Version History

**1.0.0 (2025-12-30):**
- âœ… Initial directory structure documentation
- âœ… Documented all 6 directories + workorder-log.txt
- âœ… Added workflow flows and examples
- âœ… Included best practices and conventions
- âœ… Added troubleshooting section

---

## Related Documentation

- `CODEREF-ECOSYSTEM-GUIDE.md` - Complete ecosystem overview
- `CLAUDE.md` - Technical architecture for AI agents
- `README.md` - Installation and quick start
- Individual server `CLAUDE.md` files for detailed specs

---

**Maintained by:** willh, Claude Code AI
**Last Updated:** 2025-12-30
**Status:** Reference Guide (updated as structure evolves)

---

*This directory structure enables the complete CodeRef workflow from idea to production. Each directory serves a specific purpose in the feature lifecycle.*
