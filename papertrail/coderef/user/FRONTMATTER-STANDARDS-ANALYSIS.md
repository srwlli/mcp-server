# Frontmatter Standards Analysis

**Purpose:** Analyze how YAML frontmatter is enforced across all Papertrail document types

**Date:** 2026-01-10

---

## Current State: Frontmatter Enforcement by Document Type

### 1. Resource Sheets ✅ ENFORCED

**Schema:** `schemas/documentation/resource-sheet-metadata-schema.json` (RSMS v2.0)

**Required Fields:**
```yaml
---
agent: {agent-name}           # UDS Required
date: YYYY-MM-DD             # UDS Required
task: CREATE|UPDATE|...      # UDS Required
subject: {component-name}    # RSMS Required
parent_project: {project}    # RSMS Required
category: service|controller|...  # RSMS Required
---
```

**Enforcement:** `validators/resource-sheets/validate.ps1`
- ✅ Validates all required UDS fields (agent, date, task)
- ✅ Validates all required RSMS fields (subject, parent_project, category)
- ✅ Enforces snake_case naming
- ✅ Validates enums and formats

**Status:** COMPLETE

---

### 2. Scripts/Tests ✅ ENFORCED

**Schema:** `schemas/documentation/script-frontmatter-schema.json`

**Required Fields:**
```yaml
---
resource_sheet: {path-to-resource-sheet}
related_test: {path}  # For scripts
related_script: {path}  # For tests
---
```

**Enforcement:** `validators/scripts/validate.py`
- ✅ Validates frontmatter presence
- ✅ Validates bidirectional references
- ✅ Validates resource sheet exists

**Status:** COMPLETE

**Note:** Does NOT require UDS fields (agent, date, task) - only relationship fields

---

### 3. Sessions (communication.json) ✅ ENFORCED

**Schema:** `schemas/sessions/communication-schema.json`

**Format:** JSON (not markdown, no YAML frontmatter)

**Required Fields:**
```json
{
  "workorder_id": "WO-{CATEGORY}-{ID}-###",
  "feature_name": "{kebab-case}",
  "created": "YYYY-MM-DD",
  "status": "not_started|in_progress|complete",
  ...
}
```

**Enforcement:** `validators/sessions/validate.ps1`
- ✅ Validates JSON schema compliance
- ✅ Auto-fixes common typos

**Status:** COMPLETE

**Note:** JSON files don't use YAML frontmatter - uses JSON metadata fields

---

### 4. Plans (plan.json) ✅ ENFORCED

**Schema:** `schemas/planning/plan.schema.json`

**Format:** JSON (not markdown, no YAML frontmatter)

**Required Fields:**
```json
{
  "META_DOCUMENTATION": {
    "feature_name": "...",
    "workorder_id": "WO-...",
    "version": "...",
    "status": "...",
    ...
  },
  "UNIVERSAL_PLANNING_STRUCTURE": { ... }
}
```

**Enforcement:** `validators/plans/validate.py`
- ✅ Validates 10-section structure
- ✅ Validates metadata completeness
- ✅ Scores plan quality (0-100)

**Status:** COMPLETE

**Note:** JSON files don't use YAML frontmatter - uses META_DOCUMENTATION section

---

### 5. Foundation Docs (README, ARCHITECTURE, etc.) ⚠️ PARTIAL

**Schema:** None (no dedicated schema)

**Expected Format (from UDS):**
```yaml
---
workorder_id: WO-{FEATURE}-{CATEGORY}-###
generated_by: coderef-docs v1.2.0
feature_id: {feature-name}
timestamp: YYYY-MM-DDTHH:MM:SSZ
title: {title}
version: X.Y.Z
status: APPROVED|DRAFT
doc_type: readme|architecture|api|schema|components
---
```

**Enforcement:** ❌ NO VALIDATOR

**Current State:**
- Foundation docs generated by coderef-docs DO include UDS headers
- But NO validator checks compliance
- Global standards say "agent, date, task" required but foundation docs use different fields (workorder_id, generated_by, feature_id)

**Status:** INCONSISTENT

**Gap:** Foundation docs use UDS workorder-based metadata, not RSMS resource-based metadata

---

### 6. General Markdown Docs ❌ NOT ENFORCED

**Schema:** None

**Expected Format (from Global Standards):**
```yaml
---
agent: {agent-name}
date: YYYY-MM-DD
task: CREATE|UPDATE|REVIEW|DOCUMENT|CONSOLIDATE
---
```

**Enforcement:** ❌ NO VALIDATOR

**Current State:**
- Global standards document says "all markdown must have frontmatter"
- But NO validator enforces this for general docs
- Only resource sheets are validated

**Status:** NOT ENFORCED

**Examples of non-validated docs:**
- CLAUDE.md
- README.md (root level, not foundation docs)
- Most .md files in docs/

---

## Summary: Frontmatter Coverage by Document Type

| Document Type | Format | Required Frontmatter | Validator | Status |
|---------------|--------|---------------------|-----------|--------|
| **Resource Sheets** | Markdown | agent, date, task, subject, parent_project, category | validate.ps1 | ✅ ENFORCED |
| **Scripts/Tests** | Code | resource_sheet, related_test/script | validate.py | ✅ ENFORCED |
| **Sessions** | JSON | workorder_id, feature_name, created, status | validate.ps1 | ✅ ENFORCED |
| **Plans** | JSON | META_DOCUMENTATION section | validate.py | ✅ ENFORCED |
| **Foundation Docs** | Markdown | workorder_id, generated_by, feature_id, timestamp | ❌ NONE | ⚠️ PARTIAL |
| **General Markdown** | Markdown | agent, date, task | ❌ NONE | ❌ NOT ENFORCED |

---

## The Problem: Inconsistent Standards

### Issue 1: Two Metadata Systems

**RSMS (Resource Sheets):**
```yaml
agent: Claude Sonnet 4.5
date: 2026-01-10
task: CREATE
subject: AuthService
parent_project: backend-api
category: service
```

**UDS (Foundation Docs):**
```yaml
workorder_id: WO-FEATURE-001
generated_by: coderef-docs v1.2.0
feature_id: auth-system
timestamp: 2026-01-10T00:00:00Z
title: Authentication System
version: 1.0.0
status: APPROVED
doc_type: architecture
```

**Conflict:** Which metadata standard applies to which doc type?

### Issue 2: Global Standards Not Enforced

**Global Standards say:**
> "All markdown documents must start with YAML front matter"

**Reality:**
- Only resource sheets are validated
- Foundation docs use different metadata
- Most markdown files have no frontmatter

### Issue 3: No Validator for Foundation Docs

Foundation docs generated by coderef-docs include UDS headers, but:
- ❌ No schema validation
- ❌ No automated checks
- ❌ Can't verify compliance

---

## Recommendations

### Option 1: Create Foundation Doc Validator

**Create:** `papertrail/validators/foundation_docs.py`

**Validates:**
- UDS header presence (workorder_id, generated_by, feature_id, timestamp)
- Required fields for each doc_type
- POWER framework sections (Purpose, Overview, What/Why/When, Examples, References)

**Integration:**
- Used by coderef-docs after generating docs
- Can validate existing foundation docs

### Option 2: Create General Markdown Validator

**Create:** `papertrail/validators/general_markdown.py`

**Validates:**
- YAML frontmatter presence
- Required UDS fields: agent, date, task
- Footer presence (Last Updated, Version, Maintained by)
- No emojis

**Scope:**
- Any .md file NOT covered by resource-sheets validator
- Excludes: README.md (uses UDS), CLAUDE.md (special case)

### Option 3: Consolidate Metadata Standards

**Decision needed:** Should ALL markdown docs use the same frontmatter?

**Option A: Universal RSMS**
- All markdown uses: agent, date, task, subject, parent_project, category
- Foundation docs migrate from UDS to RSMS
- ✅ Consistent
- ❌ Loses workorder traceability

**Option B: Type-Specific Metadata**
- Resource sheets: RSMS (agent, date, task, subject, ...)
- Foundation docs: UDS (workorder_id, generated_by, ...)
- General docs: Minimal (agent, date, task only)
- ✅ Preserves traceability
- ❌ Multiple standards

**Option C: Unified Hybrid**
- ALL docs include: agent, date, task (UDS base)
- PLUS type-specific fields:
  - Resource sheets ADD: subject, parent_project, category
  - Foundation docs ADD: workorder_id, generated_by, feature_id
  - General docs: base only
- ✅ Consistent base + flexibility
- ✅ Clear hierarchy

---

## Proposed Solution: Option C (Unified Hybrid)

### Base Metadata (ALL markdown files)

```yaml
---
agent: {agent-name}
date: YYYY-MM-DD
task: CREATE|UPDATE|REVIEW|DOCUMENT|CONSOLIDATE
---
```

### Resource Sheets (EXTENDS base)

```yaml
---
agent: Claude Sonnet 4.5
date: 2026-01-10
task: CREATE
# RSMS extensions:
subject: AuthService
parent_project: backend-api
category: service
version: 1.0.0
related_files: [...]
related_docs: [...]
---
```

### Foundation Docs (EXTENDS base)

```yaml
---
agent: coderef-docs v1.2.0
date: 2026-01-10
task: DOCUMENT
# UDS extensions:
workorder_id: WO-FEATURE-001
feature_id: auth-system
timestamp: 2026-01-10T00:00:00Z
title: Authentication System
version: 1.0.0
status: APPROVED
doc_type: architecture
---
```

### General Docs (BASE only)

```yaml
---
agent: Claude Sonnet 4.5
date: 2026-01-10
task: UPDATE
---
```

---

## Implementation Tasks

To enforce frontmatter globally:

1. **Create foundation_docs validator** (papertrail/validators/foundation_docs.py)
   - Validates UDS extended frontmatter
   - Checks POWER framework sections
   - Returns ValidationResult

2. **Create general_markdown validator** (papertrail/validators/general_markdown.py)
   - Validates base UDS frontmatter (agent, date, task)
   - Checks footer presence
   - No emojis check

3. **Update schemas**
   - Create `schemas/documentation/foundation-doc-frontmatter-schema.json`
   - Create `schemas/documentation/general-markdown-frontmatter-schema.json`
   - Define base UDS schema that others extend

4. **Update global standards**
   - Clarify: base fields (agent, date, task) required for ALL markdown
   - Document: type-specific extensions (RSMS, UDS)
   - Examples: show all three patterns

5. **Migrate existing docs**
   - Add base frontmatter to docs missing it
   - Ensure foundation docs have both base + UDS fields
   - Run validators on all docs

---

## Current Gap Summary

**What's missing:**
- ❌ No validator for foundation docs (README, ARCHITECTURE, API, SCHEMA, COMPONENTS)
- ❌ No validator for general markdown files
- ❌ Global standards not enforced beyond resource sheets
- ❌ Inconsistent metadata across doc types

**What works:**
- ✅ Resource sheets fully validated (RSMS)
- ✅ Scripts/tests validated (frontmatter references)
- ✅ Sessions validated (communication.json)
- ✅ Plans validated (plan.json)

**Priority:**
1. Create foundation_docs validator (HIGH - protects coderef-docs output)
2. Update schemas with base + extensions (MEDIUM)
3. Create general_markdown validator (LOW - nice to have)

---

**Maintained by:** Papertrail Analysis
**Date:** 2026-01-10
