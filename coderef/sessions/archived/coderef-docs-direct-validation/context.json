{
  "workorder_id": "WO-CODEREF-DOCS-DIRECT-VALIDATION-001",
  "feature_name": "coderef-docs-direct-validation",
  "created": "2026-01-10",
  "status": "planning",
  "target_project": "coderef-docs",

  "description": "Add direct validation integration to coderef-docs that writes validation metadata to markdown frontmatter _uds sections, while preserving the existing instruction-based validation pattern. Both patterns will coexist.",

  "goal": "Enable machine-readable validation metadata in generated documentation frontmatter for downstream tool consumption, while maintaining user transparency through instruction-based validation.",

  "requirements": [
    "Validation metadata must appear in frontmatter _uds section (validation_score, validation_errors, validation_warnings, validated_at, validator)",
    "Instruction-based validation must remain intact (no breaking changes to WO-UDS-COMPLIANCE-CODEREF-DOCS-001)",
    "Both validation patterns must run for all generated docs (foundation + standards)",
    "Helper function write_validation_metadata_to_frontmatter() must be created in utils/validation_helpers.py",
    "Foundation doc generator must call validators at runtime and write metadata",
    "Standards doc generator must call validators at runtime and write metadata",
    "Tests must verify both patterns coexist without conflicts",
    "No regression in existing 12 tests (must all pass)",
    "4 new tests must verify direct validation integration",
    "Documentation must explain both patterns and why they coexist"
  ],

  "constraints": [
    "Must not break existing instruction-based validation (WO-UDS-COMPLIANCE-CODEREF-DOCS-001 complete, 12 tests passing)",
    "Must use papertrail validators (FoundationDocValidator, StandardsDocValidator)",
    "Frontmatter _uds structure must match papertrail UDS standards",
    "Validation metadata must be YAML-serializable",
    "Must handle edge cases: missing frontmatter, invalid YAML, file write errors",
    "Total test count after implementation: 16 tests (12 existing + 4 new), all passing"
  ],

  "technical_context": {
    "existing_integration": "WO-UDS-COMPLIANCE-CODEREF-DOCS-001 (instruction-based validation complete)",
    "validation_coverage": "72% (13/18 outputs validated via instruction-based pattern)",
    "affected_files": [
      "tool_handlers.py (foundation doc generator, standards doc generator)",
      "utils/validation_helpers.py (CREATE NEW)",
      "tests/test_direct_validation.py (CREATE NEW)",
      "CLAUDE.md (update to v3.7.0)",
      "README.md (update validation section)"
    ],
    "validators_to_use": [
      "papertrail.validators.foundation.FoundationDocValidator (for 5 foundation docs)",
      "papertrail.validators.standards.StandardsDocValidator (for 3 standards docs)"
    ],
    "frontmatter_structure": {
      "_uds": {
        "validation_score": "integer 0-100",
        "validation_errors": "array of error objects",
        "validation_warnings": "array of warning strings",
        "validated_at": "ISO 8601 timestamp string",
        "validator": "string (validator class name)"
      }
    }
  },

  "user_decisions": {
    "question_1_downstream_tools_need_metadata": "YES - downstream tools need validation metadata",
    "question_2_markdown_docs_should_have_uds": "YES - markdown docs should have _uds sections in frontmatter",
    "question_3_developer_education_burden": "YES - acceptable to have two patterns, will document the why",
    "question_4_rework_tolerance": "Keep docs as-is, build new integration, wire up both patterns"
  },

  "out_of_scope": [
    "Replacing instruction-based validation (must keep both)",
    "Modifying papertrail validators (use as-is)",
    "Adding validation to remaining 5 unvalidated outputs (P2 - future work)",
    "Changing validation threshold (keep score >= 90 for passing)"
  ],

  "success_criteria": {
    "functional": [
      "Frontmatter _uds metadata appears in all generated docs (README, ARCHITECTURE, API, SCHEMA, COMPONENTS, ui-patterns, behavior-patterns, ux-patterns)",
      "Instruction-based validation code still appears in tool output",
      "Both patterns run without conflicts or errors",
      "Validation scores are accurate (match validator results)",
      "Metadata is well-formatted and machine-readable"
    ],
    "testing": [
      "16/16 tests passing (12 existing + 4 new)",
      "No regression in existing tests",
      "New tests verify direct validation works",
      "New tests verify both patterns coexist",
      "Manual testing confirms frontmatter _uds present"
    ],
    "documentation": [
      "CLAUDE.md updated to v3.7.0 with both patterns documented",
      "README.md updated with validation section explaining both patterns",
      "COMPLETION-SUMMARY.md created for this workorder",
      "Both patterns clearly explained with rationale"
    ]
  },

  "risks": {
    "frontmatter_yaml_serialization": {
      "description": "YAML serialization of complex validation_errors objects might fail",
      "mitigation": "Simplify error objects to primitive types (strings) before serialization",
      "severity": "MEDIUM"
    },
    "file_write_conflicts": {
      "description": "Writing metadata might overwrite other frontmatter fields",
      "mitigation": "Read existing frontmatter, merge _uds section, preserve other fields",
      "severity": "LOW"
    },
    "test_regression": {
      "description": "Adding direct validation might break existing instruction-based tests",
      "mitigation": "Run existing tests after each step, fix regressions immediately",
      "severity": "LOW"
    }
  },

  "estimated_effort": {
    "total_hours": "3-4 hours",
    "breakdown": {
      "step_1_understand": "30 min",
      "step_2_design": "30 min",
      "step_3_helper": "1 hour",
      "step_4_foundation": "1 hour",
      "step_5_standards": "45 min",
      "step_6_tests": "45 min",
      "step_7_docs": "30 min",
      "step_8_verify": "30 min"
    }
  },

  "implementation_order": [
    "1. Read existing implementation (WO-UDS-COMPLIANCE-CODEREF-DOCS-001)",
    "2. Design frontmatter _uds structure",
    "3. Create validation helper function",
    "4. Integrate with foundation doc generator",
    "5. Integrate with standards doc generator",
    "6. Add tests for direct validation",
    "7. Update documentation",
    "8. Verify and mark complete"
  ],

  "completion_deliverables": [
    "utils/validation_helpers.py (helper function)",
    "tool_handlers.py (updated with direct validation)",
    "tests/test_direct_validation.py (4 new tests)",
    "CLAUDE.md (v3.7.0)",
    "README.md (updated validation section)",
    "COMPLETION-SUMMARY.md (workorder completion report)",
    "coderef-docs-implementation-report.md (implementation details)"
  ],

  "reference_documents": [
    "C:\\Users\\willh\\.mcp-servers\\coderef-docs\\coderef\\workorder\\uds-compliance-coderef-docs\\COMPLETION-SUMMARY.md (existing implementation)",
    "C:\\Users\\willh\\.mcp-servers\\coderef\\sessions\\validator-integration\\orchestrator-integration-review.md (architectural decision context)",
    "C:\\Users\\willh\\.mcp-servers\\papertrail\\docs\\UDS-IMPLEMENTATION-GUIDE.md (validation patterns)",
    "C:\\Users\\willh\\.mcp-servers\\coderef\\sessions\\coderef-docs-direct-validation\\instructions.json (detailed task breakdown)"
  ]
}
