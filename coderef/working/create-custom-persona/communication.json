{
  "feature": "CREATE-CUSTOM-PERSONA",
  "workorder_id": "WO-CREATE-CUSTOM-PERSONA-001",
  "from": "Agent 1 (Lloyd)",
  "to": "Taylor (General Purpose Agent)",
  "date": "2025-10-23",
  "task": "Implement custom persona creation system with guided workflow, template-based generation, and multi-stage validation",
  "instruction": "Build the create_custom_persona MCP tool that enables users to create custom personas through a guided workflow with automatic system prompt generation and validation",
  "precise_steps": [
    "Step 1: Read coderef/working/create-custom-persona/plan.json to understand complete implementation requirements",
    "Step 2: Create directory structure: mkdir -p personas-mcp/personas/custom personas-mcp/templates",
    "Step 3: Implement CustomPersonaInput Pydantic schema in personas-mcp/src/models.py (lines at end of file)",
    "Step 4: Create JSON schema at personas-mcp/templates/custom_persona_schema.json for input validation",
    "Step 5: Design system prompt template at personas-mcp/templates/persona_template.txt with {{placeholder}} syntax",
    "Step 6: Create template renderer logic (function render_template(template, variables))",
    "Step 7: Implement src/validators.py with three validation stages: schema_validate(), semantic_validate(), quality_validate()",
    "Step 8: Create src/persona_generator.py with PersonaGenerator class containing generate_system_prompt() and generate_metadata() methods",
    "Step 9: Add create_custom_persona tool definition to personas-mcp/server.py list_tools()",
    "Step 10: Implement handle_create_custom_persona() handler in server.py with guided workflow using AskUserQuestion",
    "Step 11: Create .claude/commands/create-persona.md slash command file",
    "Step 12: Write unit tests in tests/test_models.py, tests/test_persona_generator.py, tests/test_validators.py",
    "Step 13: Write integration test in tests/integration/test_create_custom_persona.py",
    "Step 14: Run all tests: pytest tests/ -v --cov=src",
    "Step 15: Update personas-mcp/README.md with create_custom_persona tool documentation",
    "Step 16: Update personas-mcp/CLAUDE.md with custom persona creation workflow",
    "Step 17: Create personas-mcp/CUSTOMIZATION-GUIDE.md with examples and best practices",
    "Step 18: Verify all 25 tasks in plan.json are complete",
    "Step 19: Update DELIVERABLES.md with completion status",
    "Step 20: Commit changes with message: 'feat: Add create_custom_persona tool with guided workflow and validation (WO-CREATE-CUSTOM-PERSONA-001)'"
  ],
  "details": {
    "work_area": "personas-mcp/",
    "forbidden_files": [
      "personas-mcp/personas/base/*.json - DO NOT MODIFY (reason: existing base personas must remain unchanged)",
      "personas-mcp/src/persona_manager.py - READ ONLY unless extending to support custom/ directory",
      "docs-mcp/ - DO NOT MODIFY (reason: different MCP server)",
      "coderef-mcp/ - DO NOT MODIFY (reason: different MCP server)"
    ],
    "allowed_files": [
      "personas-mcp/src/models.py - Add CustomPersonaInput schema",
      "personas-mcp/src/validators.py - CREATE new file for validation logic",
      "personas-mcp/src/persona_generator.py - CREATE new file for generation logic",
      "personas-mcp/server.py - Add create_custom_persona tool definition and handler",
      "personas-mcp/templates/ - CREATE new directory and template files",
      "personas-mcp/personas/custom/ - CREATE new directory for custom personas",
      "personas-mcp/.claude/commands/create-persona.md - CREATE slash command",
      "personas-mcp/tests/ - CREATE test files",
      "personas-mcp/README.md - UPDATE with new tool documentation",
      "personas-mcp/CLAUDE.md - UPDATE with customization workflow",
      "personas-mcp/CUSTOMIZATION-GUIDE.md - CREATE new documentation"
    ],
    "context": {
      "feature_name": "create_custom_persona",
      "goal": "Enable users to create custom personas without writing JSON or system prompts manually",
      "dependencies": [
        "Existing PersonaDefinition schema in src/models.py",
        "Existing PersonaManager in src/persona_manager.py",
        "MCP server infrastructure in server.py",
        "Pydantic for validation",
        "JSON schema validation library"
      ],
      "references": [
        "plan.json section 4_key_features (5 key features)",
        "plan.json section 5_task_id_system (25 tasks total)",
        "personas-mcp-improvements.json TOOL-010 specification",
        "Existing personas in personas/base/ as reference examples"
      ]
    }
  },
  "testing_checklist": [
    "1. Create unit test for CustomPersonaInput schema validation (valid and invalid inputs)",
    "2. Create unit test for template rendering with placeholder substitution",
    "3. Create unit tests for all three validation stages (schema, semantic, quality)",
    "4. Create integration test for complete persona creation workflow",
    "5. Run unit tests: pytest tests/ -v",
    "6. Run integration tests: pytest tests/integration/ -v",
    "7. Verify test coverage >= 90%: pytest --cov=src --cov-report=term-missing",
    "8. Test slash command: /create-persona with sample inputs",
    "9. Verify generated persona activates: use_persona('test-custom-persona')",
    "10. Verify forbidden files unchanged: git diff personas/base/"
  ],
  "success_criteria": [
    "✅ CustomPersonaInput schema defined and validates inputs correctly",
    "✅ System prompt template created with proper {{placeholder}} syntax",
    "✅ Template renderer substitutes placeholders correctly",
    "✅ Multi-stage validation works (schema → semantic → quality)",
    "✅ PersonaGenerator generates coherent system prompts",
    "✅ create_custom_persona tool registered and handler implemented",
    "✅ Guided workflow collects user inputs via AskUserQuestion",
    "✅ Custom personas saved to personas/custom/{name}.json",
    "✅ /create-persona slash command available",
    "✅ All 25 tasks in plan.json completed",
    "✅ Test coverage >= 90% for new code",
    "✅ All unit tests passing (pytest tests/)",
    "✅ All integration tests passing (pytest tests/integration/)",
    "✅ Documentation updated (README, CLAUDE, CUSTOMIZATION-GUIDE)",
    "✅ Forbidden files unchanged (base personas untouched)",
    "✅ Custom personas can be activated via use_persona tool"
  ],
  "agent_1_status": "READY - Plan complete, DELIVERABLES generated, awaiting Taylor assignment",
  "agent_taylor_status": null,
  "agent_taylor_assigned_at": null,
  "agent_taylor_workorder": "WO-CREATE-CUSTOM-PERSONA-002",
  "agent_taylor_completion": {
    "status": null,
    "timestamp": null,
    "changes_made": [],
    "verification": {
      "forbidden_files_unchanged": null,
      "tests_passing": null,
      "build_successful": null
    },
    "commit_hash": null,
    "commit_message": null
  },
  "agent_1_verification": {
    "status": null,
    "verified_at": null,
    "verified_by": "Agent 1 (Lloyd)",
    "code_review": {
      "passed": null,
      "comments": []
    },
    "independent_tests": {
      "passed": null,
      "test_results": []
    },
    "forbidden_files_check": {
      "passed": null,
      "files_verified": []
    },
    "production_integration": {
      "passed": null,
      "integration_tests": []
    },
    "final_approval": null
  },
  "metadata": {
    "created_at": "2025-10-23T21:10:00Z",
    "updated_at": "2025-10-23T21:10:00Z",
    "version": "1.0.0",
    "template_version": "1.0.0"
  }
}
