{
  "META_DOCUMENTATION": {
    "plan_name": "LLM Workflow - Multi-LLM Consolidation System",
    "workorder_id": "WO-LLM-WORKFLOW-001",
    "version": "1.0.0",
    "status": "draft",
    "created_at": "2025-12-06",
    "updated_at": "2025-12-06"
  },
  "1_executive_summary": {
    "feature_name": "llm-workflow",
    "description": "Multi-LLM consolidation system for getting best, most comprehensive information by consolidating responses from multiple LLMs",
    "primary_goal": "Collective intelligence > Single perspective - don't miss anything important",
    "success_metrics": [
      "Tool parses messy multi-LLM input",
      "Extracts all points from all sources",
      "Identifies unique insights",
      "Flags conflicts",
      "Generates clean consolidated output",
      "Works with /create-plan workflow"
    ],
    "estimated_complexity": "medium",
    "estimated_phases": 3
  },
  "2_risk_assessment": {
    "technical_risks": [
      {
        "risk": "LLM output format inconsistency",
        "likelihood": "medium",
        "impact": "medium",
        "mitigation": "Prompt template enforces JSON output schema"
      },
      {
        "risk": "JSON parsing failures from LLM responses",
        "likelihood": "medium",
        "impact": "low",
        "mitigation": "Fallback parser with error recovery"
      }
    ],
    "dependencies": [],
    "assumptions": [
      "LLMs can follow JSON output schema when instructed",
      "Users will copy/paste responses into text file"
    ]
  },
  "3_current_state_analysis": {
    "existing_components": [
      "communication.json template pattern",
      "docs-mcp tool handler infrastructure",
      "Lloyd persona with planning expertise"
    ],
    "patterns_to_follow": [
      "communication.json agentic format",
      "Handler registry pattern",
      "Multi-format output (json/markdown/html)"
    ],
    "gaps_identified": [
      "No prompt generation system",
      "No LLM output parser",
      "No consolidation engine"
    ],
    "integration_points": [
      "/create-plan workflow",
      "Lloyd persona specialization"
    ]
  },
  "4_key_features": [
    {
      "feature_id": "FEAT-001",
      "name": "/llm-prompt command",
      "description": "Generate structured prompt with JSON output schema for querying multiple LLMs",
      "priority": "must-have",
      "acceptance_criteria": [
        "Generates prompt following communication.json pattern",
        "Includes task, instruction, context, output_schema, success_criteria",
        "Supports task types: code-review, architecture, security-audit, implementation, refactor"
      ]
    },
    {
      "feature_id": "FEAT-002",
      "name": "/consolidate command",
      "description": "Parse and merge LLM responses into consolidated output",
      "priority": "must-have",
      "acceptance_criteria": [
        "Parses JSON responses from multiple LLMs",
        "Merges findings, recommendations, risks",
        "Identifies unique insights (only one LLM mentioned)",
        "Flags conflicts for human decision",
        "Outputs json, markdown, and/or html formats"
      ]
    },
    {
      "feature_id": "FEAT-003",
      "name": "Lloyd integration",
      "description": "Lloyd becomes expert at using consolidation for better planning input",
      "priority": "should-have",
      "acceptance_criteria": [
        "Lloyd persona updated with consolidation expertise",
        "Workflow: prompt → collect → consolidate → feed to /create-plan"
      ]
    }
  ],
  "5_task_id_system": {
    "workorder_id": "WO-LLM-WORKFLOW-001",
    "task_prefix_map": {
      "PROMPT": "Prompt generation tasks",
      "PARSE": "Parser and consolidation tasks",
      "OUTPUT": "Output format tasks",
      "INTEGRATE": "Integration tasks"
    },
    "id_format": "PREFIX-NNN (e.g., PROMPT-001, PARSE-002)"
  },
  "6_implementation_phases": [
    {
      "phase_id": "phase_1",
      "name": "Prompt Generation",
      "description": "Create /llm-prompt command and template system",
      "tasks": [
        {
          "task_id": "PROMPT-001",
          "title": "Create prompt template schema",
          "description": "Define JSON schema for prompt templates following communication.json pattern",
          "dependencies": [],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Schema includes task, instruction, context, output_schema, success_criteria"
          ]
        },
        {
          "task_id": "PROMPT-002",
          "title": "Create task type templates",
          "description": "Create templates for code-review, architecture, security-audit, implementation, refactor",
          "dependencies": ["PROMPT-001"],
          "estimated_effort": "medium",
          "acceptance_criteria": [
            "5 task type templates created",
            "Each includes appropriate focus_areas"
          ]
        },
        {
          "task_id": "PROMPT-003",
          "title": "Create /llm-prompt slash command",
          "description": "Slash command that generates prompt from template",
          "dependencies": ["PROMPT-002"],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Command accepts task type parameter",
            "Outputs ready-to-paste prompt"
          ]
        }
      ]
    },
    {
      "phase_id": "phase_2",
      "name": "Consolidation Engine",
      "description": "Create parser and consolidation logic",
      "tasks": [
        {
          "task_id": "PARSE-001",
          "title": "Create LLM output parser",
          "description": "Parser that extracts JSON from LLM responses, handles multiple formats",
          "dependencies": [],
          "estimated_effort": "medium",
          "acceptance_criteria": [
            "Detects LLM response boundaries",
            "Extracts JSON from each response",
            "Handles malformed JSON gracefully"
          ]
        },
        {
          "task_id": "PARSE-002",
          "title": "Create consolidation engine",
          "description": "Merge findings, recommendations, risks from multiple LLMs",
          "dependencies": ["PARSE-001"],
          "estimated_effort": "medium",
          "acceptance_criteria": [
            "Merges all findings by category",
            "Identifies unique insights",
            "Flags conflicts",
            "Aggregates metrics"
          ]
        },
        {
          "task_id": "OUTPUT-001",
          "title": "Create JSON output generator",
          "description": "Generate consolidated.json for agentic consumption",
          "dependencies": ["PARSE-002"],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Valid JSON output",
            "Includes all merged data plus metadata"
          ]
        },
        {
          "task_id": "OUTPUT-002",
          "title": "Create HTML output generator",
          "description": "Generate consolidated.html for visual review",
          "dependencies": ["PARSE-002"],
          "estimated_effort": "medium",
          "acceptance_criteria": [
            "Side-by-side comparison view",
            "Styled for readability",
            "Self-contained (inline CSS)"
          ]
        },
        {
          "task_id": "OUTPUT-003",
          "title": "Create markdown output generator",
          "description": "Generate consolidated.md for documentation",
          "dependencies": ["PARSE-002"],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Clean markdown format",
            "Includes all sections"
          ]
        }
      ]
    },
    {
      "phase_id": "phase_3",
      "name": "Integration",
      "description": "Integrate with docs-mcp and Lloyd",
      "tasks": [
        {
          "task_id": "INTEGRATE-001",
          "title": "Create MCP tool handler",
          "description": "Add consolidate_llm_outputs to docs-mcp",
          "dependencies": ["OUTPUT-001", "OUTPUT-002", "OUTPUT-003"],
          "estimated_effort": "medium",
          "acceptance_criteria": [
            "Tool registered in server.py",
            "Handler follows existing patterns",
            "Supports multiple output formats"
          ]
        },
        {
          "task_id": "INTEGRATE-002",
          "title": "Create /consolidate slash command",
          "description": "Slash command wrapper for consolidate_llm_outputs",
          "dependencies": ["INTEGRATE-001"],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Command in .claude/commands/",
            "Deployed to ~/.claude/commands/"
          ]
        },
        {
          "task_id": "INTEGRATE-003",
          "title": "Update Lloyd persona",
          "description": "Add LLM consolidation expertise to Lloyd",
          "dependencies": ["INTEGRATE-002"],
          "estimated_effort": "small",
          "acceptance_criteria": [
            "Lloyd.json updated with consolidation expertise",
            "Workflow documented: prompt → collect → consolidate → plan"
          ]
        }
      ]
    }
  ],
  "7_testing_strategy": {
    "unit_tests": {
      "coverage_target": "80%",
      "frameworks": ["pytest"],
      "key_areas": [
        "Prompt template generation",
        "JSON parser",
        "Consolidation logic",
        "Output generators"
      ]
    },
    "integration_tests": {
      "scope": [
        "End-to-end: prompt → paste → consolidate",
        "Multi-format output generation",
        "/create-plan integration"
      ],
      "approach": "Test with sample LLM responses"
    },
    "manual_testing": {
      "test_cases": [
        "Generate prompt, query 3 LLMs, consolidate",
        "Test with malformed JSON responses",
        "Verify HTML output renders correctly"
      ]
    }
  },
  "8_success_criteria": {
    "functional": [
      "/llm-prompt generates valid structured prompts",
      "/consolidate parses and merges LLM responses",
      "All three output formats work correctly",
      "Unique insights are identified",
      "Conflicts are flagged"
    ],
    "non_functional": [
      "Consolidation completes in < 1 second",
      "Handles 5+ LLM responses",
      "Graceful error handling for malformed input"
    ],
    "acceptance_criteria": [
      "All tests passing",
      "Lloyd persona updated",
      "Commands deployed globally"
    ]
  },
  "9_implementation_checklist": {
    "phases": [
      {
        "phase_name": "Phase 1: Prompt Generation",
        "tasks": [
          {"task_id": "PROMPT-001", "description": "Create prompt template schema", "status": "pending"},
          {"task_id": "PROMPT-002", "description": "Create task type templates", "status": "pending"},
          {"task_id": "PROMPT-003", "description": "Create /llm-prompt slash command", "status": "pending"}
        ]
      },
      {
        "phase_name": "Phase 2: Consolidation Engine",
        "tasks": [
          {"task_id": "PARSE-001", "description": "Create LLM output parser", "status": "pending"},
          {"task_id": "PARSE-002", "description": "Create consolidation engine", "status": "pending"},
          {"task_id": "OUTPUT-001", "description": "Create JSON output generator", "status": "pending"},
          {"task_id": "OUTPUT-002", "description": "Create HTML output generator", "status": "pending"},
          {"task_id": "OUTPUT-003", "description": "Create markdown output generator", "status": "pending"}
        ]
      },
      {
        "phase_name": "Phase 3: Integration",
        "tasks": [
          {"task_id": "INTEGRATE-001", "description": "Create MCP tool handler", "status": "pending"},
          {"task_id": "INTEGRATE-002", "description": "Create /consolidate slash command", "status": "pending"},
          {"task_id": "INTEGRATE-003", "description": "Update Lloyd persona", "status": "pending"}
        ]
      }
    ]
  }
}
